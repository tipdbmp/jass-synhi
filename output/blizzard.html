<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">

    <link href="../css/reset.css" type="text/css" rel="stylesheet" />
    <link href="../css/jass.css" type="text/css" rel="stylesheet" />

    <title>blizzard.j</title>
</head>

<body>
<pre><span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Blizzard.j ( define Jass2 functions that need to be in every map script )</span>
<span class="jass-comment">//===========================================================================</span>


<span class="jass-keyword">globals</span>
    <span class="jass-comment">//-----------------------------------------------------------------------</span>
    <span class="jass-comment">// Constants</span>
    <span class="jass-comment">//</span>

    <span class="jass-comment">// Misc constants</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_PI</span>                            <span class="jass-op">=</span> <span class="jass-number">3.14159</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_E</span>                             <span class="jass-op">=</span> <span class="jass-number">2.71828</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CELLWIDTH</span>                     <span class="jass-op">=</span> <span class="jass-number">128.0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CLIFFHEIGHT</span>                   <span class="jass-op">=</span> <span class="jass-number">128.0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_UNIT_FACING</span>                   <span class="jass-op">=</span> <span class="jass-number">270.0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_RADTODEG</span>                      <span class="jass-op">=</span> <span class="jass-number">180.0</span><span class="jass-op">/</span><span class="jass-const">bj_PI</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_DEGTORAD</span>                      <span class="jass-op">=</span> <span class="jass-const">bj_PI</span><span class="jass-op">/</span><span class="jass-number">180.0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_QUEST</span>              <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_QUESTUPDATE</span>        <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_QUESTDONE</span>          <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_QUESTFAILED</span>        <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_QUESTREQUIREMENT</span>   <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_MISSIONFAILED</span>      <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_ALWAYSHINT</span>         <span class="jass-op">=</span> <span class="jass-number">12.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_HINT</span>               <span class="jass-op">=</span> <span class="jass-number">12.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_SECRET</span>             <span class="jass-op">=</span> <span class="jass-number">10.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_UNITACQUIRED</span>       <span class="jass-op">=</span> <span class="jass-number">15.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_UNITAVAILABLE</span>      <span class="jass-op">=</span> <span class="jass-number">10.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_ITEMACQUIRED</span>       <span class="jass-op">=</span> <span class="jass-number">10.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TEXT_DELAY_WARNING</span>            <span class="jass-op">=</span> <span class="jass-number">12.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_QUEUE_DELAY_QUEST</span>             <span class="jass-op">=</span>  <span class="jass-number">5.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_QUEUE_DELAY_HINT</span>              <span class="jass-op">=</span>  <span class="jass-number">5.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_QUEUE_DELAY_SECRET</span>            <span class="jass-op">=</span>  <span class="jass-number">3.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_HANDICAP_EASY</span>                 <span class="jass-op">=</span> <span class="jass-number">60.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_GAME_STARTED_THRESHOLD</span>        <span class="jass-op">=</span>  <span class="jass-number">0.01</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_WAIT_FOR_COND_MIN_INTERVAL</span>    <span class="jass-op">=</span>  <span class="jass-number">0.10</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_POLLED_WAIT_INTERVAL</span>          <span class="jass-op">=</span>  <span class="jass-number">0.10</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_POLLED_WAIT_SKIP_THRESHOLD</span>    <span class="jass-op">=</span>  <span class="jass-number">2.00</span>

    <span class="jass-comment">// Game constants</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_INVENTORY</span>                 <span class="jass-op">=</span>   <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_PLAYERS</span>                   <span class="jass-op">=</span>  <span class="jass-number">12</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_PLAYER_NEUTRAL_VICTIM</span>         <span class="jass-op">=</span>  <span class="jass-number">13</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_PLAYER_NEUTRAL_EXTRA</span>          <span class="jass-op">=</span>  <span class="jass-number">14</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>              <span class="jass-op">=</span>  <span class="jass-number">16</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_SKELETONS</span>                 <span class="jass-op">=</span>  <span class="jass-number">25</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_STOCK_ITEM_SLOTS</span>          <span class="jass-op">=</span>  <span class="jass-number">11</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_STOCK_UNIT_SLOTS</span>          <span class="jass-op">=</span>  <span class="jass-number">11</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_ITEM_LEVEL</span>                <span class="jass-op">=</span>  <span class="jass-number">10</span>

    <span class="jass-comment">// Ideally these would be looked up from Units/MiscData.txt,</span>
    <span class="jass-comment">// but there is currently no script functionality exposed to do that</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TOD_DAWN</span>                      <span class="jass-op">=</span> <span class="jass-number">6.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TOD_DUSK</span>                      <span class="jass-op">=</span> <span class="jass-number">18.00</span>

    <span class="jass-comment">// Melee game settings:</span>
    <span class="jass-comment">//   - Starting Time of Day (TOD)</span>
    <span class="jass-comment">//   - Starting Gold</span>
    <span class="jass-comment">//   - Starting Lumber</span>
    <span class="jass-comment">//   - Starting Hero Tokens (free heroes)</span>
    <span class="jass-comment">//   - Max heroes allowed per player</span>
    <span class="jass-comment">//   - Max heroes allowed per hero type</span>
    <span class="jass-comment">//   - Distance from start loc to search for nearby mines</span>
    <span class="jass-comment">//</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_MELEE_STARTING_TOD</span>            <span class="jass-op">=</span> <span class="jass-number">8.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_STARTING_GOLD_V0</span>        <span class="jass-op">=</span> <span class="jass-number">750</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_STARTING_GOLD_V1</span>        <span class="jass-op">=</span> <span class="jass-number">500</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_STARTING_LUMBER_V0</span>      <span class="jass-op">=</span> <span class="jass-number">200</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_STARTING_LUMBER_V1</span>      <span class="jass-op">=</span> <span class="jass-number">150</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_STARTING_HERO_TOKENS</span>    <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_HERO_LIMIT</span>              <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>         <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_MELEE_MINE_SEARCH_RADIUS</span>      <span class="jass-op">=</span> <span class="jass-number">2000</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_MELEE_CLEAR_UNITS_RADIUS</span>      <span class="jass-op">=</span> <span class="jass-number">1500</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_MELEE_CRIPPLE_TIMEOUT</span>         <span class="jass-op">=</span> <span class="jass-number">120.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_MELEE_CRIPPLE_MSG_DURATION</span>    <span class="jass-op">=</span> <span class="jass-number">20.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES_V0</span>   <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES_V1</span>   <span class="jass-op">=</span> <span class="jass-number">1</span>

    <span class="jass-comment">// Delay between a creep's death and the time it may drop an item.</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CREEP_ITEM_DELAY</span>              <span class="jass-op">=</span> <span class="jass-number">0.50</span>

    <span class="jass-comment">// Timing settings for Marketplace inventories.</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_STOCK_RESTOCK_INITIAL_DELAY</span>   <span class="jass-op">=</span> <span class="jass-number">120</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_STOCK_RESTOCK_INTERVAL</span>        <span class="jass-op">=</span> <span class="jass-number">30</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_STOCK_MAX_ITERATIONS</span>          <span class="jass-op">=</span> <span class="jass-number">20</span>

    <span class="jass-comment">// Max events registered by a single "dest dies in region" event.</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_DEST_IN_REGION_EVENTS</span>     <span class="jass-op">=</span> <span class="jass-number">64</span>

    <span class="jass-comment">// Camera settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_MIN_FARZ</span>               <span class="jass-op">=</span> <span class="jass-number">100</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_DEFAULT_DISTANCE</span>       <span class="jass-op">=</span> <span class="jass-number">1650</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_DEFAULT_FARZ</span>           <span class="jass-op">=</span> <span class="jass-number">5000</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_DEFAULT_AOA</span>            <span class="jass-op">=</span> <span class="jass-number">304</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_DEFAULT_FOV</span>            <span class="jass-op">=</span> <span class="jass-number">70</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_DEFAULT_ROLL</span>           <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERA_DEFAULT_ROTATION</span>       <span class="jass-op">=</span> <span class="jass-number">90</span>

    <span class="jass-comment">// Rescue</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_RESCUE_PING_TIME</span>              <span class="jass-op">=</span> <span class="jass-number">2.00</span>

    <span class="jass-comment">// Transmission behavior settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_NOTHING_SOUND_DURATION</span>        <span class="jass-op">=</span> <span class="jass-number">5.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TRANSMISSION_PING_TIME</span>        <span class="jass-op">=</span> <span class="jass-number">1.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TRANSMISSION_IND_RED</span>          <span class="jass-op">=</span> <span class="jass-number">255</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TRANSMISSION_IND_BLUE</span>         <span class="jass-op">=</span> <span class="jass-number">255</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TRANSMISSION_IND_GREEN</span>        <span class="jass-op">=</span> <span class="jass-number">255</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TRANSMISSION_IND_ALPHA</span>        <span class="jass-op">=</span> <span class="jass-number">255</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_TRANSMISSION_PORT_HANGTIME</span>    <span class="jass-op">=</span> <span class="jass-number">1.50</span>

    <span class="jass-comment">// Cinematic mode settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_INTERFACEFADE</span>        <span class="jass-op">=</span> <span class="jass-number">0.50</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">gamespeed</span> <span class="jass-const">bj_CINEMODE_GAMESPEED</span>            <span class="jass-op">=</span> <span class="jass-const">MAP_SPEED_NORMAL</span>

    <span class="jass-comment">// Cinematic mode volume levels</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_UNITMOVEMENT</span>  <span class="jass-op">=</span> <span class="jass-number">0.40</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_UNITSOUNDS</span>    <span class="jass-op">=</span> <span class="jass-number">0.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_COMBAT</span>        <span class="jass-op">=</span> <span class="jass-number">0.40</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_SPELLS</span>        <span class="jass-op">=</span> <span class="jass-number">0.40</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_UI</span>            <span class="jass-op">=</span> <span class="jass-number">0.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_MUSIC</span>         <span class="jass-op">=</span> <span class="jass-number">0.55</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_AMBIENTSOUNDS</span> <span class="jass-op">=</span> <span class="jass-number">1.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CINEMODE_VOLUME_FIRE</span>          <span class="jass-op">=</span> <span class="jass-number">0.60</span>

    <span class="jass-comment">// Speech mode volume levels</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_UNITMOVEMENT</span>    <span class="jass-op">=</span> <span class="jass-number">0.25</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_UNITSOUNDS</span>      <span class="jass-op">=</span> <span class="jass-number">0.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_COMBAT</span>          <span class="jass-op">=</span> <span class="jass-number">0.25</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_SPELLS</span>          <span class="jass-op">=</span> <span class="jass-number">0.25</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_UI</span>              <span class="jass-op">=</span> <span class="jass-number">0.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_MUSIC</span>           <span class="jass-op">=</span> <span class="jass-number">0.55</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_AMBIENTSOUNDS</span>   <span class="jass-op">=</span> <span class="jass-number">1.00</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SPEECH_VOLUME_FIRE</span>            <span class="jass-op">=</span> <span class="jass-number">0.60</span>

    <span class="jass-comment">// Smart pan settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SMARTPAN_TRESHOLD_PAN</span>         <span class="jass-op">=</span> <span class="jass-number">500</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_SMARTPAN_TRESHOLD_SNAP</span>        <span class="jass-op">=</span> <span class="jass-number">3500</span>

    <span class="jass-comment">// QueuedTriggerExecute settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MAX_QUEUED_TRIGGERS</span>           <span class="jass-op">=</span> <span class="jass-number">100</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_QUEUED_TRIGGER_TIMEOUT</span>        <span class="jass-op">=</span> <span class="jass-number">180.00</span>

    <span class="jass-comment">// Campaign indexing constants</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_T</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_H</span>        <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_U</span>        <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_O</span>        <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_N</span>        <span class="jass-op">=</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_XN</span>       <span class="jass-op">=</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_XH</span>       <span class="jass-op">=</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_XU</span>       <span class="jass-op">=</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_INDEX_XO</span>       <span class="jass-op">=</span> <span class="jass-number">8</span>

    <span class="jass-comment">// Campaign offset constants (for mission indexing)</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_T</span>       <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span>       <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span>       <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span>       <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span>       <span class="jass-op">=</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span>      <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span>      <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span>      <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMPAIGN_OFFSET_XO</span>      <span class="jass-op">=</span> <span class="jass-number">3</span>

    <span class="jass-comment">// Mission indexing constants</span>
    <span class="jass-comment">// Tutorial</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_T00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_T</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_T01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_T</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-comment">// Human</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H04</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H06</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H10</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">10</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_H11</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_H</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">11</span>
    <span class="jass-comment">// Undead</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U10</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_U11</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_U</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-comment">// Orc</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O04</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O06</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_O10</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_O</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">10</span>
    <span class="jass-comment">// Night Elf</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N04</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N06</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_N09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_N</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-comment">// Expansion Night Elf</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN04</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN06</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XN10</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">10</span>
    <span class="jass-comment">// Expansion Human</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH04</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH06</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XH09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-comment">// Expansion Undead</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU01</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU02</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU03</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU04</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU05</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU06</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU07</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU08</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU09</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">9</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU10</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">10</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU11</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">11</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU12</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">12</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XU13</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">13</span>

    <span class="jass-comment">// Expansion Orc</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MISSION_INDEX_XO00</span>       <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XO</span> <span class="jass-op">*</span> <span class="jass-number">1000</span> <span class="jass-op">+</span> <span class="jass-number">0</span>

    <span class="jass-comment">// Cinematic indexing constants</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_TOP</span>      <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_HOP</span>      <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_HED</span>      <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_OOP</span>      <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_OED</span>      <span class="jass-op">=</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_UOP</span>      <span class="jass-op">=</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_UED</span>      <span class="jass-op">=</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_NOP</span>      <span class="jass-op">=</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_NED</span>      <span class="jass-op">=</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_XOP</span>      <span class="jass-op">=</span> <span class="jass-number">9</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEMATICINDEX_XED</span>      <span class="jass-op">=</span> <span class="jass-number">10</span>

    <span class="jass-comment">// Alliance settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_UNALLIED</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_UNALLIED_VISION</span> <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_ALLIED</span>          <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_ALLIED_VISION</span>   <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_ALLIED_UNITS</span>    <span class="jass-op">=</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_ALLIED_ADVUNITS</span> <span class="jass-op">=</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_NEUTRAL</span>         <span class="jass-op">=</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ALLIANCE_NEUTRAL_VISION</span>  <span class="jass-op">=</span> <span class="jass-number">7</span>

    <span class="jass-comment">// Keyboard Event Types</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_KEYEVENTTYPE_DEPRESS</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_KEYEVENTTYPE_RELEASE</span>     <span class="jass-op">=</span> <span class="jass-number">1</span>

    <span class="jass-comment">// Keyboard Event Keys</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_KEYEVENTKEY_LEFT</span>         <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_KEYEVENTKEY_RIGHT</span>        <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_KEYEVENTKEY_DOWN</span>         <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_KEYEVENTKEY_UP</span>           <span class="jass-op">=</span> <span class="jass-number">3</span>

    <span class="jass-comment">// Transmission timing methods</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TIMETYPE_ADD</span>             <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TIMETYPE_SET</span>             <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_TIMETYPE_SUB</span>             <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Camera bounds adjustment methods</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERABOUNDS_ADJUST_ADD</span>  <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CAMERABOUNDS_ADJUST_SUB</span>  <span class="jass-op">=</span> <span class="jass-number">1</span>

    <span class="jass-comment">// Quest creation states</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTTYPE_REQ_DISCOVERED</span>   <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTTYPE_REQ_UNDISCOVERED</span> <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTTYPE_OPT_DISCOVERED</span>   <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTTYPE_OPT_UNDISCOVERED</span> <span class="jass-op">=</span> <span class="jass-number">3</span>

    <span class="jass-comment">// Quest message types</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_DISCOVERED</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_UPDATED</span>       <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_COMPLETED</span>     <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_FAILED</span>        <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_REQUIREMENT</span>   <span class="jass-op">=</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_MISSIONFAILED</span> <span class="jass-op">=</span> <span class="jass-number">5</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_ALWAYSHINT</span>    <span class="jass-op">=</span> <span class="jass-number">6</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_HINT</span>          <span class="jass-op">=</span> <span class="jass-number">7</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_SECRET</span>        <span class="jass-op">=</span> <span class="jass-number">8</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_UNITACQUIRED</span>  <span class="jass-op">=</span> <span class="jass-number">9</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_UNITAVAILABLE</span> <span class="jass-op">=</span> <span class="jass-number">10</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_ITEMACQUIRED</span>  <span class="jass-op">=</span> <span class="jass-number">11</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_QUESTMESSAGE_WARNING</span>       <span class="jass-op">=</span> <span class="jass-number">12</span>

    <span class="jass-comment">// Leaderboard sorting methods</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_SORTTYPE_SORTBYVALUE</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_SORTTYPE_SORTBYPLAYER</span>    <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_SORTTYPE_SORTBYLABEL</span>     <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Cinematic fade filter methods</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEFADETYPE_FADEIN</span>      <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEFADETYPE_FADEOUT</span>     <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CINEFADETYPE_FADEOUTIN</span>   <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Buff removal methods</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_REMOVEBUFFS_POSITIVE</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_REMOVEBUFFS_NEGATIVE</span>     <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_REMOVEBUFFS_ALL</span>          <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_REMOVEBUFFS_NONTLIFE</span>     <span class="jass-op">=</span> <span class="jass-number">3</span>

    <span class="jass-comment">// Buff properties - polarity</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_POLARITY_POSITIVE</span>   <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_POLARITY_NEGATIVE</span>   <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_POLARITY_EITHER</span>     <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Buff properties - resist type</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_RESIST_MAGIC</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_RESIST_PHYSICAL</span>     <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_RESIST_EITHER</span>       <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_BUFF_RESIST_BOTH</span>         <span class="jass-op">=</span> <span class="jass-number">3</span>

    <span class="jass-comment">// Hero stats</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_HEROSTAT_STR</span>             <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_HEROSTAT_AGI</span>             <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_HEROSTAT_INT</span>             <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Hero skill point modification methods</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MODIFYMETHOD_ADD</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MODIFYMETHOD_SUB</span>    <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MODIFYMETHOD_SET</span>    <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Unit state adjustment methods (for replaced units)</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_UNIT_STATE_METHOD_ABSOLUTE</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_UNIT_STATE_METHOD_RELATIVE</span> <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_UNIT_STATE_METHOD_DEFAULTS</span> <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_UNIT_STATE_METHOD_MAXIMUM</span>  <span class="jass-op">=</span> <span class="jass-number">3</span>

    <span class="jass-comment">// Gate operations</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GATEOPERATION_CLOSE</span>      <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GATEOPERATION_OPEN</span>       <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GATEOPERATION_DESTROY</span>    <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Game cache value types</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GAMECACHE_BOOLEAN</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GAMECACHE_INTEGER</span>        <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GAMECACHE_REAL</span>           <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GAMECACHE_UNIT</span>           <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_GAMECACHE_STRING</span>         <span class="jass-op">=</span> <span class="jass-number">4</span>

    <span class="jass-comment">// Item status types</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEM_STATUS_HIDDEN</span>       <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEM_STATUS_OWNED</span>        <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEM_STATUS_INVULNERABLE</span> <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEM_STATUS_POWERUP</span>      <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEM_STATUS_SELLABLE</span>     <span class="jass-op">=</span> <span class="jass-number">4</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEM_STATUS_PAWNABLE</span>     <span class="jass-op">=</span> <span class="jass-number">5</span>

    <span class="jass-comment">// Itemcode status types</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEMCODE_STATUS_POWERUP</span>  <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEMCODE_STATUS_SELLABLE</span> <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ITEMCODE_STATUS_PAWNABLE</span> <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Minimap ping styles</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MINIMAPPINGSTYLE_SIMPLE</span>  <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MINIMAPPINGSTYLE_FLASHY</span>  <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_MINIMAPPINGSTYLE_ATTACK</span>  <span class="jass-op">=</span> <span class="jass-number">2</span>

    <span class="jass-comment">// Corpse creation settings</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">real</span>      <span class="jass-const">bj_CORPSE_MAX_DEATH_TIME</span>    <span class="jass-op">=</span> <span class="jass-number">8.00</span>

    <span class="jass-comment">// Corpse creation styles</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CORPSETYPE_FLESH</span>         <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_CORPSETYPE_BONE</span>          <span class="jass-op">=</span> <span class="jass-number">1</span>

    <span class="jass-comment">// Elevator pathing-blocker destructable code</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_BLOCKER_CODE</span>    <span class="jass-op">=</span> <span class="jass-number">'DTep'</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_CODE01</span>          <span class="jass-op">=</span> <span class="jass-number">'DTrf'</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_CODE02</span>          <span class="jass-op">=</span> <span class="jass-number">'DTrx'</span>

    <span class="jass-comment">// Elevator wall codes</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_WALL_TYPE_ALL</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_WALL_TYPE_EAST</span>       <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_WALL_TYPE_NORTH</span>      <span class="jass-op">=</span> <span class="jass-number">2</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_WALL_TYPE_SOUTH</span>      <span class="jass-op">=</span> <span class="jass-number">3</span>
    <span class="jass-keyword">constant</span> <span class="jass-type">integer</span>   <span class="jass-const">bj_ELEVATOR_WALL_TYPE_WEST</span>       <span class="jass-op">=</span> <span class="jass-number">4</span>

    <span class="jass-comment">//-----------------------------------------------------------------------</span>
    <span class="jass-comment">// Variables</span>
    <span class="jass-comment">//</span>

    <span class="jass-comment">// Force predefs</span>
    <span class="jass-type">force</span>              <span class="jass-const">bj_FORCE_ALL_PLAYERS</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">force</span> <span class="jass-keyword">array</span>        <span class="jass-const">bj_FORCE_PLAYER</span>

    <span class="jass-type">integer</span>            <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES</span> <span class="jass-op">=</span> <span class="jass-number">0</span>

    <span class="jass-comment">// Map area rects</span>
    <span class="jass-type">rect</span>               <span class="jass-const">bj_mapInitialPlayableArea</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">rect</span>               <span class="jass-const">bj_mapInitialCameraBounds</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Utility function vars</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_forLoopAIndex</span>            <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_forLoopBIndex</span>            <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_forLoopAIndexEnd</span>         <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_forLoopBIndexEnd</span>         <span class="jass-op">=</span> <span class="jass-number">0</span>

    <span class="jass-type">boolean</span>            <span class="jass-const">bj_slotControlReady</span>         <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_slotControlUsed</span>
    <span class="jass-type">mapcontrol</span> <span class="jass-keyword">array</span>   <span class="jass-const">bj_slotControl</span>

    <span class="jass-comment">// Game started detection vars</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_gameStartedTimer</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_gameStarted</span>              <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_volumeGroupsTimer</span>        <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()

    <span class="jass-comment">// Singleplayer check</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_isSinglePlayer</span>           <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-comment">// Day/Night Cycle vars</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_dncSoundsDay</span>             <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_dncSoundsNight</span>           <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_dayAmbientSound</span>          <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_nightAmbientSound</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_dncSoundsDawn</span>            <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_dncSoundsDusk</span>            <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_dawnSound</span>                <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_duskSound</span>                <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_useDawnDuskSounds</span>        <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_dncIsDaytime</span>             <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-comment">// Triggered sounds</span>
    <span class="jass-comment">//sound              bj_pingMinimapSound         = null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_rescueSound</span>              <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questDiscoveredSound</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questUpdatedSound</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questCompletedSound</span>      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questFailedSound</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questHintSound</span>           <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questSecretSound</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questItemAcquiredSound</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_questWarningSound</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_victoryDialogSound</span>       <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_defeatDialogSound</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Marketplace vars</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_stockItemPurchased</span>       <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_stockUpdateTimer</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_stockAllowedPermanent</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_stockAllowedCharged</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_stockAllowedArtifact</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_stockPickedItemLevel</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">itemtype</span>           <span class="jass-const">bj_stockPickedItemType</span>

    <span class="jass-comment">// Melee vars</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_meleeVisibilityTrained</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_meleeVisibilityIsDay</span>     <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_meleeGrantHeroItems</span>      <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">location</span>           <span class="jass-const">bj_meleeNearestMineToLoc</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_meleeNearestMine</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_meleeNearestMineDist</span>     <span class="jass-op">=</span> <span class="jass-number">0.00</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_meleeGameOver</span>            <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_meleeDefeated</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_meleeVictoried</span>
    <span class="jass-type">unit</span> <span class="jass-keyword">array</span>         <span class="jass-const">bj_ghoul</span>
    <span class="jass-type">timer</span> <span class="jass-keyword">array</span>        <span class="jass-const">bj_crippledTimer</span>
    <span class="jass-type">timerdialog</span> <span class="jass-keyword">array</span>  <span class="jass-const">bj_crippledTimerWindows</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_playerIsCrippled</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_playerIsExposed</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_finishSoonAllExposed</span>     <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">timerdialog</span>        <span class="jass-const">bj_finishSoonTimerDialog</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_meleeTwinkedHeroes</span>

    <span class="jass-comment">// Rescue behavior vars</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_rescueUnitBehavior</span>       <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_rescueChangeColorUnit</span>    <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_rescueChangeColorBldg</span>    <span class="jass-op">=</span> <span class="jass-const">true</span>

    <span class="jass-comment">// Transmission vars</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_cineSceneEndingTimer</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_cineSceneLastSound</span>       <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_cineSceneBeingSkipped</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Cinematic mode vars</span>
    <span class="jass-type">gamespeed</span>          <span class="jass-const">bj_cineModePriorSpeed</span>       <span class="jass-op">=</span> <span class="jass-const">MAP_SPEED_NORMAL</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_cineModePriorFogSetting</span>  <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_cineModePriorMaskSetting</span> <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_cineModeAlreadyIn</span>        <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_cineModePriorDawnDusk</span>    <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_cineModeSavedSeed</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>

    <span class="jass-comment">// Cinematic fade vars</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_cineFadeFinishTimer</span>      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_cineFadeContinueTimer</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_cineFadeContinueRed</span>      <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_cineFadeContinueGreen</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_cineFadeContinueBlue</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_cineFadeContinueTrans</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_cineFadeContinueDuration</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">string</span>             <span class="jass-const">bj_cineFadeContinueTex</span>      <span class="jass-op">=</span> <span class="jass-string">""</span>

    <span class="jass-comment">// QueuedTriggerExecute vars</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_queuedExecTotal</span>          <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">trigger</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_queuedExecTriggers</span>
    <span class="jass-type">boolean</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_queuedExecUseConds</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_queuedExecTimeoutTimer</span>   <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_queuedExecTimeout</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Helper vars (for Filter and Enum funcs)</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_destInRegionDiesCount</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_destInRegionDiesTrig</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_groupCountUnits</span>          <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_forceCountPlayers</span>        <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_groupEnumTypeId</span>          <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">player</span>             <span class="jass-const">bj_groupEnumOwningPlayer</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">group</span>              <span class="jass-const">bj_groupAddGroupDest</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">group</span>              <span class="jass-const">bj_groupRemoveGroupDest</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_groupRandomConsidered</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_groupRandomCurrentPick</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">group</span>              <span class="jass-const">bj_groupLastCreatedDest</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">group</span>              <span class="jass-const">bj_randomSubGroupGroup</span>      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_randomSubGroupWant</span>       <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_randomSubGroupTotal</span>      <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_randomSubGroupChance</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_destRandomConsidered</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">destructable</span>       <span class="jass-const">bj_destRandomCurrentPick</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">destructable</span>       <span class="jass-const">bj_elevatorWallBlocker</span>      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">destructable</span>       <span class="jass-const">bj_elevatorNeighbor</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_itemRandomConsidered</span>     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">item</span>               <span class="jass-const">bj_itemRandomCurrentPick</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_forceRandomConsidered</span>    <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">player</span>             <span class="jass-const">bj_forceRandomCurrentPick</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_makeUnitRescuableUnit</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_makeUnitRescuableFlag</span>    <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_pauseAllUnitsFlag</span>        <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">location</span>           <span class="jass-const">bj_enumDestructableCenter</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_enumDestructableRadius</span>   <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">playercolor</span>        <span class="jass-const">bj_setPlayerTargetColor</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_isUnitGroupDeadResult</span>    <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_isUnitGroupEmptyResult</span>   <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_isUnitGroupInRectResult</span>  <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-type">rect</span>               <span class="jass-const">bj_isUnitGroupInRectRect</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_changeLevelShowScores</span>    <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-type">string</span>             <span class="jass-const">bj_changeLevelMapName</span>       <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">group</span>              <span class="jass-const">bj_suspendDecayFleshGroup</span>   <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-type">group</span>              <span class="jass-const">bj_suspendDecayBoneGroup</span>    <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-type">timer</span>              <span class="jass-const">bj_delayedSuspendDecayTimer</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-type">trigger</span>            <span class="jass-const">bj_delayedSuspendDecayTrig</span>  <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_livingPlayerUnitsTypeId</span>  <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">widget</span>             <span class="jass-const">bj_lastDyingWidget</span>          <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Random distribution vars</span>
    <span class="jass-type">integer</span>            <span class="jass-const">bj_randDistCount</span>            <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">integer</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_randDistID</span>
    <span class="jass-type">integer</span> <span class="jass-keyword">array</span>      <span class="jass-const">bj_randDistChance</span>

    <span class="jass-comment">// Last X'd vars</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_lastCreatedUnit</span>          <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">item</span>               <span class="jass-const">bj_lastCreatedItem</span>          <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">item</span>               <span class="jass-const">bj_lastRemovedItem</span>          <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_lastHauntedGoldMine</span>      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">destructable</span>       <span class="jass-const">bj_lastCreatedDestructable</span>  <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">group</span>              <span class="jass-const">bj_lastCreatedGroup</span>         <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-type">fogmodifier</span>        <span class="jass-const">bj_lastCreatedFogModifier</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">effect</span>             <span class="jass-const">bj_lastCreatedEffect</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">weathereffect</span>      <span class="jass-const">bj_lastCreatedWeatherEffect</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">terraindeformation</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">quest</span>              <span class="jass-const">bj_lastCreatedQuest</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">questitem</span>          <span class="jass-const">bj_lastCreatedQuestItem</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">defeatcondition</span>    <span class="jass-const">bj_lastCreatedDefeatCondition</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">timer</span>              <span class="jass-const">bj_lastStartedTimer</span>         <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-type">timerdialog</span>        <span class="jass-const">bj_lastCreatedTimerDialog</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">leaderboard</span>        <span class="jass-const">bj_lastCreatedLeaderboard</span>   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">multiboard</span>         <span class="jass-const">bj_lastCreatedMultiboard</span>    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">sound</span>              <span class="jass-const">bj_lastPlayedSound</span>          <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">string</span>             <span class="jass-const">bj_lastPlayedMusic</span>          <span class="jass-op">=</span> <span class="jass-string">""</span>
    <span class="jass-type">real</span>               <span class="jass-const">bj_lastTransmissionDuration</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-type">gamecache</span>          <span class="jass-const">bj_lastCreatedGameCache</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_lastLoadedUnit</span>           <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">button</span>             <span class="jass-const">bj_lastCreatedButton</span>        <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">unit</span>               <span class="jass-const">bj_lastReplacedUnit</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">texttag</span>            <span class="jass-const">bj_lastCreatedTextTag</span>       <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">lightning</span>          <span class="jass-const">bj_lastCreatedLightning</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">image</span>              <span class="jass-const">bj_lastCreatedImage</span>         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">ubersplat</span>          <span class="jass-const">bj_lastCreatedUbersplat</span>     <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Filter function vars</span>
    <span class="jass-type">boolexpr</span>           filterIssueHauntOrderAtLocBJ      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolexpr</span>           filterEnumDestructablesInCircleBJ <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolexpr</span>           filterGetUnitsInRectOfPlayer      <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolexpr</span>           filterGetUnitsOfTypeIdAll         <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolexpr</span>           filterGetUnitsOfPlayerAndTypeId   <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolexpr</span>           filterMeleeTrainedUnitIsHeroBJ    <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-type">boolexpr</span>           filterLivingPlayerUnitsOfTypeId   <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Memory cleanup vars</span>
    <span class="jass-type">boolean</span>            <span class="jass-const">bj_wantDestroyGroup</span>         <span class="jass-op">=</span> <span class="jass-const">false</span>
<span class="jass-keyword">endglobals</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Debugging Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">BJDebugMsg</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> msg <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> i <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">Player</span>(i),<span class="jass-number">0</span>,<span class="jass-number">0</span>,<span class="jass-number">60</span>,msg)
        <span class="jass-keyword">set</span> i <span class="jass-op">=</span> i <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> i <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Math Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RMinBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> a, <span class="jass-type">real</span> b <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&lt;</span> b) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> a
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> b
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RMaxBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> a, <span class="jass-type">real</span> b <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&lt;</span> b) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> b
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> a
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RAbsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> a <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&gt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> a
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-op">-</span>a
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RSignBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> a <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&gt;=</span> <span class="jass-number">0.0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-number">1.0</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-op">-</span><span class="jass-number">1.0</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IMinBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> a, <span class="jass-type">integer</span> b <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&lt;</span> b) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> a
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> b
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IMaxBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> a, <span class="jass-type">integer</span> b <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&lt;</span> b) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> b
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> a
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IAbsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> a <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&gt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> a
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-op">-</span>a
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ISignBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> a <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> (a <span class="jass-op">&gt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-number">1</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-op">-</span><span class="jass-number">1</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SinBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Sin</span>(degrees <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CosBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Cos</span>(degrees <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TanBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Tan</span>(degrees <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AsinBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Asin</span>(degrees) <span class="jass-op">*</span> <span class="jass-const">bj_RADTODEG</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AcosBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Acos</span>(degrees) <span class="jass-op">*</span> <span class="jass-const">bj_RADTODEG</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AtanBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Atan</span>(degrees) <span class="jass-op">*</span> <span class="jass-const">bj_RADTODEG</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">Atan2BJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> y, <span class="jass-type">real</span> x <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Atan2</span>(y, x) <span class="jass-op">*</span> <span class="jass-const">bj_RADTODEG</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AngleBetweenPoints</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> locA, <span class="jass-type">location</span> locB <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_RADTODEG</span> <span class="jass-op">*</span> <span class="jass-common-j-native">Atan2</span>(<span class="jass-common-j-native">GetLocationY</span>(locB) <span class="jass-op">-</span> <span class="jass-common-j-native">GetLocationY</span>(locA), <span class="jass-common-j-native">GetLocationX</span>(locB) <span class="jass-op">-</span> <span class="jass-common-j-native">GetLocationX</span>(locA))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DistanceBetweenPoints</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> locA, <span class="jass-type">location</span> locB <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> dx <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(locB) <span class="jass-op">-</span> <span class="jass-common-j-native">GetLocationX</span>(locA)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> dy <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(locB) <span class="jass-op">-</span> <span class="jass-common-j-native">GetLocationY</span>(locA)
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">SquareRoot</span>(dx <span class="jass-op">*</span> dx <span class="jass-op">+</span> dy <span class="jass-op">*</span> dy)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PolarProjectionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> source, <span class="jass-type">real</span> dist, <span class="jass-type">real</span> angle <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> x <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(source) <span class="jass-op">+</span> dist <span class="jass-op">*</span> <span class="jass-common-j-native">Cos</span>(angle <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> y <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(source) <span class="jass-op">+</span> dist <span class="jass-op">*</span> <span class="jass-common-j-native">Sin</span>(angle <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(x, y)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRandomDirectionDeg</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-number">0</span>, <span class="jass-number">360</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRandomPercentageBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-number">0</span>, <span class="jass-number">100</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRandomLocInRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> whichRect <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(<span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-common-j-native">GetRectMinX</span>(whichRect), <span class="jass-common-j-native">GetRectMaxX</span>(whichRect)), <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-common-j-native">GetRectMinY</span>(whichRect), <span class="jass-common-j-native">GetRectMaxY</span>(whichRect)))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Calculate the modulus/remainder of (dividend) divided by (divisor).</span>
<span class="jass-comment">// Examples:  18 mod 5 = 3.  15 mod 5 = 0.  -8 mod 5 = 2.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ModuloInteger</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> dividend, <span class="jass-type">integer</span> divisor <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> modulus <span class="jass-op">=</span> dividend <span class="jass-op">-</span> (dividend <span class="jass-op">/</span> divisor) <span class="jass-op">*</span> divisor

    <span class="jass-comment">// If the dividend was negative, the above modulus calculation will</span>
    <span class="jass-comment">// be negative, but within (-divisor..0).  We can add (divisor) to</span>
    <span class="jass-comment">// shift this result into the desired range of (0..divisor).</span>
    <span class="jass-keyword">if</span> (modulus <span class="jass-op">&lt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> modulus <span class="jass-op">=</span> modulus <span class="jass-op">+</span> divisor
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> modulus
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Calculate the modulus/remainder of (dividend) divided by (divisor).</span>
<span class="jass-comment">// Examples:  13.000 mod 2.500 = 0.500.  -6.000 mod 2.500 = 1.500.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ModuloReal</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> dividend, <span class="jass-type">real</span> divisor <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> modulus <span class="jass-op">=</span> dividend <span class="jass-op">-</span> <span class="jass-common-j-native">I2R</span>(<span class="jass-common-j-native">R2I</span>(dividend <span class="jass-op">/</span> divisor)) <span class="jass-op">*</span> divisor

    <span class="jass-comment">// If the dividend was negative, the above modulus calculation will</span>
    <span class="jass-comment">// be negative, but within (-divisor..0).  We can add (divisor) to</span>
    <span class="jass-comment">// shift this result into the desired range of (0..divisor).</span>
    <span class="jass-keyword">if</span> (modulus <span class="jass-op">&lt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> modulus <span class="jass-op">=</span> modulus <span class="jass-op">+</span> divisor
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> modulus
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">OffsetLocation</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> loc, <span class="jass-type">real</span> dx, <span class="jass-type">real</span> dy <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(<span class="jass-common-j-native">GetLocationX</span>(loc) <span class="jass-op">+</span> dx, <span class="jass-common-j-native">GetLocationY</span>(loc) <span class="jass-op">+</span> dy)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">OffsetRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">real</span> dx, <span class="jass-type">real</span> dy <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Rect</span>( <span class="jass-common-j-native">GetRectMinX</span>(r) <span class="jass-op">+</span> dx, <span class="jass-common-j-native">GetRectMinY</span>(r) <span class="jass-op">+</span> dy, <span class="jass-common-j-native">GetRectMaxX</span>(r) <span class="jass-op">+</span> dx, <span class="jass-common-j-native">GetRectMaxY</span>(r) <span class="jass-op">+</span> dy )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RectFromCenterSizeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> center, <span class="jass-type">real</span> width, <span class="jass-type">real</span> height <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> x <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>( center )
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> y <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>( center )
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Rect</span>( x <span class="jass-op">-</span> width<span class="jass-op">*</span><span class="jass-number">0.5</span>, y <span class="jass-op">-</span> height<span class="jass-op">*</span><span class="jass-number">0.5</span>, x <span class="jass-op">+</span> width<span class="jass-op">*</span><span class="jass-number">0.5</span>, y <span class="jass-op">+</span> height<span class="jass-op">*</span><span class="jass-number">0.5</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RectContainsCoords</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> (<span class="jass-common-j-native">GetRectMinX</span>(r) <span class="jass-op">&lt;=</span> x) <span class="jass-keyword">and</span> (x <span class="jass-op">&lt;=</span> <span class="jass-common-j-native">GetRectMaxX</span>(r)) <span class="jass-keyword">and</span> (<span class="jass-common-j-native">GetRectMinY</span>(r) <span class="jass-op">&lt;=</span> y) <span class="jass-keyword">and</span> (y <span class="jass-op">&lt;=</span> <span class="jass-common-j-native">GetRectMaxY</span>(r))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RectContainsLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">RectContainsCoords</span>(r, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RectContainsUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">RectContainsCoords</span>(r, <span class="jass-common-j-native">GetUnitX</span>(whichUnit), <span class="jass-common-j-native">GetUnitY</span>(whichUnit))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RectContainsItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (whichItem <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsItemOwned</span>(whichItem)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">RectContainsCoords</span>(r, <span class="jass-common-j-native">GetItemX</span>(whichItem), <span class="jass-common-j-native">GetItemY</span>(whichItem))
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Utility Constructs</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Runs the trigger's actions if the trigger's conditions evaluate to true.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ConditionalTriggerExecute</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-common-j-native">TriggerEvaluate</span>(trig) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerExecute</span>(trig)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Runs the trigger's actions if the trigger's conditions evaluate to true.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerExecuteBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">boolean</span> checkConditions <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> checkConditions <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> (<span class="jass-common-j-native">TriggerEvaluate</span>(trig)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-const">false</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerExecute</span>(trig)
    <span class="jass-keyword">return</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Arranges for a trigger to fire almost immediately, except that the calling</span>
<span class="jass-comment">// trigger is not interrupted as is the case with a TriggerExecute call.</span>
<span class="jass-comment">// Since the trigger executes normally, its conditions are still evaluated.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PostTriggerExecuteBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">boolean</span> checkConditions <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> checkConditions <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> (<span class="jass-common-j-native">TriggerEvaluate</span>(trig)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-const">false</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterTimerEvent</span>(trig, <span class="jass-number">0</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Debug - Display the contents of the trigger queue (as either null or "x"</span>
<span class="jass-comment">// for each entry).</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerCheck</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">string</span> s <span class="jass-op">=</span> <span class="jass-string">"TrigQueue Check "</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> i

    <span class="jass-keyword">set</span> i <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> i <span class="jass-op">&gt;=</span> <span class="jass-const">bj_queuedExecTotal</span>
        <span class="jass-keyword">set</span> s <span class="jass-op">=</span> s <span class="jass-op">+</span> <span class="jass-string">"q["</span> <span class="jass-op">+</span> <span class="jass-common-j-native">I2S</span>(i) <span class="jass-op">+</span> <span class="jass-string">"]="</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_queuedExecTriggers</span>[i] <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> s <span class="jass-op">=</span> s <span class="jass-op">+</span> <span class="jass-string">"null "</span>
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">set</span> s <span class="jass-op">=</span> s <span class="jass-op">+</span> <span class="jass-string">"x "</span>
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">set</span> i <span class="jass-op">=</span> i <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">set</span> s <span class="jass-op">=</span> s <span class="jass-op">+</span> <span class="jass-string">"("</span> <span class="jass-op">+</span> <span class="jass-common-j-native">I2S</span>(<span class="jass-const">bj_queuedExecTotal</span>) <span class="jass-op">+</span> <span class="jass-string">" total)"</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(),<span class="jass-number">0</span>,<span class="jass-number">0</span>,<span class="jass-number">600</span>,s)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Searches the queue for a given trigger, returning the index of the</span>
<span class="jass-comment">// trigger within the queue if it is found, or -1 if it is not found.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerGetIndex</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-comment">// Determine which, if any, of the queued triggers is being removed.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index     <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_queuedExecTotal</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_queuedExecTriggers</span>[index] <span class="jass-op">==</span> trig) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> index
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">return</span> <span class="jass-op">-</span><span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Removes a trigger from the trigger queue, shifting other triggers down</span>
<span class="jass-comment">// to fill the unused space.  If the currently running trigger is removed</span>
<span class="jass-comment">// in this manner, this function does NOT attempt to run the next trigger.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerRemoveByIndex</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> trigIndex <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-comment">// If the to-be-removed index is out of range, fail.</span>
    <span class="jass-keyword">if</span> (trigIndex <span class="jass-op">&gt;=</span> <span class="jass-const">bj_queuedExecTotal</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Shift all queue entries down to fill in the gap.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">=</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">-</span> <span class="jass-number">1</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> trigIndex
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_queuedExecTotal</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTriggers</span>[index] <span class="jass-op">=</span> <span class="jass-const">bj_queuedExecTriggers</span>[index <span class="jass-op">+</span> <span class="jass-number">1</span>]
        <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecUseConds</span>[index] <span class="jass-op">=</span> <span class="jass-const">bj_queuedExecUseConds</span>[index <span class="jass-op">+</span> <span class="jass-number">1</span>]
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">return</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Attempt to execute the first trigger in the queue.  If it fails, remove</span>
<span class="jass-comment">// it and execute the next one.  Continue this cycle until a trigger runs,</span>
<span class="jass-comment">// or until the queue is empty.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerAttemptExec</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">==</span> <span class="jass-number">0</span>

        <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">TriggerExecuteBJ</span>(<span class="jass-const">bj_queuedExecTriggers</span>[<span class="jass-number">0</span>], <span class="jass-const">bj_queuedExecUseConds</span>[<span class="jass-number">0</span>]) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Timeout the queue if it sits at the front of the queue for too long.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_queuedExecTimeoutTimer</span>, <span class="jass-const">bj_QUEUED_TRIGGER_TIMEOUT</span>, <span class="jass-const">false</span>, <span class="jass-type">null</span>)
            <span class="jass-keyword">return</span> <span class="jass-const">true</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">QueuedTriggerRemoveByIndex</span>(<span class="jass-number">0</span>)
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">return</span> <span class="jass-const">false</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Queues a trigger to be executed, assuring that such triggers are not</span>
<span class="jass-comment">// executed at the same time.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerAddBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">boolean</span> checkConditions <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-comment">// Make sure our queue isn't full.  If it is, return failure.</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">&gt;=</span> <span class="jass-const">bj_MAX_QUEUED_TRIGGERS</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Add the trigger to an array of to-be-executed triggers.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTriggers</span>[<span class="jass-const">bj_queuedExecTotal</span>] <span class="jass-op">=</span> trig
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecUseConds</span>[<span class="jass-const">bj_queuedExecTotal</span>] <span class="jass-op">=</span> checkConditions
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">=</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">+</span> <span class="jass-number">1</span>

    <span class="jass-comment">// If this is the only trigger in the queue, run it.</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">QueuedTriggerAttemptExec</span>()
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Denotes the end of a queued trigger. Be sure to call this only once per</span>
<span class="jass-comment">// queued trigger, or risk stepping on the toes of other queued triggers.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerRemoveBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> trigIndex
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> trigExecuted

    <span class="jass-comment">// Find the trigger's index.</span>
    <span class="jass-keyword">set</span> trigIndex <span class="jass-op">=</span> <span class="jass-blizzard-j-function">QueuedTriggerGetIndex</span>(trig)
    <span class="jass-keyword">if</span> (trigIndex <span class="jass-op">==</span> <span class="jass-op">-</span><span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Shuffle the other trigger entries down to fill in the gap.</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">QueuedTriggerRemoveByIndex</span>(trigIndex)

    <span class="jass-comment">// If we just axed the currently running trigger, run the next one.</span>
    <span class="jass-keyword">if</span> (trigIndex <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseTimer</span>(<span class="jass-const">bj_queuedExecTimeoutTimer</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">QueuedTriggerAttemptExec</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Denotes the end of a queued trigger. Be sure to call this only once per</span>
<span class="jass-comment">// queued trigger, lest you step on the toes of other queued triggers.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerDoneBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-comment">// Make sure there's something on the queue to remove.</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Remove the currently running trigger from the array.</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">QueuedTriggerRemoveByIndex</span>(<span class="jass-number">0</span>)

    <span class="jass-comment">// If other triggers are waiting to run, run one of them.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseTimer</span>(<span class="jass-const">bj_queuedExecTimeoutTimer</span>)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">QueuedTriggerAttemptExec</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Empty the trigger queue.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerClearBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseTimer</span>(<span class="jass-const">bj_queuedExecTimeoutTimer</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Remove all but the currently executing trigger from the trigger queue.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerClearInactiveBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">IMinBJ</span>(<span class="jass-const">bj_queuedExecTotal</span>, <span class="jass-number">1</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerCountBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_queuedExecTotal</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsTriggerQueueEmptyBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_queuedExecTotal</span> <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsTriggerQueuedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">QueuedTriggerGetIndex</span>(trig) <span class="jass-op">!=</span> <span class="jass-op">-</span><span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetForLoopIndexA</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_forLoopAIndex</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetForLoopIndexA</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> newIndex <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forLoopAIndex</span> <span class="jass-op">=</span> newIndex
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetForLoopIndexB</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_forLoopBIndex</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetForLoopIndexB</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> newIndex <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forLoopBIndex</span> <span class="jass-op">=</span> newIndex
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// We can't do game-time waits, so this simulates one by starting a timer</span>
<span class="jass-comment">// and polling until the timer expires.</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PolledWait</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">timer</span> t
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>  timeRemaining

    <span class="jass-keyword">if</span> (duration <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(t, duration, <span class="jass-const">false</span>, <span class="jass-type">null</span>)
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">set</span> timeRemaining <span class="jass-op">=</span> <span class="jass-common-j-native">TimerGetRemaining</span>(t)
            <span class="jass-keyword">exitwhen</span> timeRemaining <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>

            <span class="jass-comment">// If we have a bit of time left, skip past 10% of the remaining</span>
            <span class="jass-comment">// duration instead of checking every interval, to minimize the</span>
            <span class="jass-comment">// polling on long waits.</span>
            <span class="jass-keyword">if</span> (timeRemaining <span class="jass-op">&gt;</span> <span class="jass-const">bj_POLLED_WAIT_SKIP_THRESHOLD</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(<span class="jass-number">0.1</span> <span class="jass-op">*</span> timeRemaining)
            <span class="jass-keyword">else</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(<span class="jass-const">bj_POLLED_WAIT_INTERVAL</span>)
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(t)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IntegerTertiaryOp</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">integer</span> valueA, <span class="jass-type">integer</span> valueB <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> flag <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> valueA
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> valueB
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  General Utility Functions</span>
<span class="jass-comment">//*  These functions exist purely to make the trigger dialogs cleaner and</span>
<span class="jass-comment">//*  more comprehensible.</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DoNothing</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// This function does nothing.  WorldEdit should should eventually ignore</span>
<span class="jass-comment">// CommentString triggers during script generation, but until such a time,</span>
<span class="jass-comment">// this function will serve as a stub.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CommentString</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> commentString <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// This function returns the input string, converting it from the localized text, if necessary</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StringIdentity</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> theString <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(theString)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetBooleanAnd</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> valueA, <span class="jass-type">boolean</span> valueB <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> valueA <span class="jass-keyword">and</span> valueB
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetBooleanOr</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> valueA, <span class="jass-type">boolean</span> valueB <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> valueA <span class="jass-keyword">or</span> valueB
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Converts a percentage (real, 0..100) into a scaled integer (0..max),</span>
<span class="jass-comment">// clipping the result to 0..max in case the input is invalid.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PercentToInt</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> percentage, <span class="jass-type">integer</span> max <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> result <span class="jass-op">=</span> <span class="jass-common-j-native">R2I</span>(percentage <span class="jass-op">*</span> <span class="jass-common-j-native">I2R</span>(max) <span class="jass-op">*</span> <span class="jass-number">0.01</span>)

    <span class="jass-keyword">if</span> (result <span class="jass-op">&lt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> result <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">elseif</span> (result <span class="jass-op">&gt;</span> max) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> result <span class="jass-op">=</span> max
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> result
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PercentTo255</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> percentage <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">PercentToInt</span>(percentage, <span class="jass-number">255</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTimeOfDay</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetFloatGameState</span>(<span class="jass-const">GAME_STATE_TIME_OF_DAY</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTimeOfDay</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> whatTime <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetFloatGameState</span>(<span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, whatTime)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTimeOfDayScalePercentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> scalePercent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTimeOfDayScale</span>(scalePercent <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTimeOfDayScalePercentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTimeOfDayScale</span>() <span class="jass-op">*</span> <span class="jass-number">100</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlaySound</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> soundName <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">sound</span> soundHandle <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSound</span>(soundName, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">true</span>, <span class="jass-number">12700</span>, <span class="jass-number">12700</span>, <span class="jass-string">""</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(soundHandle)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillSoundWhenDone</span>(soundHandle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CompareLocationsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> A, <span class="jass-type">location</span> B <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocationX</span>(A) <span class="jass-op">==</span> <span class="jass-common-j-native">GetLocationX</span>(B) <span class="jass-keyword">and</span> <span class="jass-common-j-native">GetLocationY</span>(A) <span class="jass-op">==</span> <span class="jass-common-j-native">GetLocationY</span>(B)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CompareRectsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> A, <span class="jass-type">rect</span> B <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetRectMinX</span>(A) <span class="jass-op">==</span> <span class="jass-common-j-native">GetRectMinX</span>(B) <span class="jass-keyword">and</span> <span class="jass-common-j-native">GetRectMinY</span>(A) <span class="jass-op">==</span> <span class="jass-common-j-native">GetRectMinY</span>(B) <span class="jass-keyword">and</span> <span class="jass-common-j-native">GetRectMaxX</span>(A) <span class="jass-op">==</span> <span class="jass-common-j-native">GetRectMaxX</span>(B) <span class="jass-keyword">and</span> <span class="jass-common-j-native">GetRectMaxY</span>(A) <span class="jass-op">==</span> <span class="jass-common-j-native">GetRectMaxY</span>(B)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns a square rect that exactly encompasses the specified circle.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRectFromCircleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> center, <span class="jass-type">real</span> radius <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> centerX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(center)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> centerY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(center)
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Rect</span>(centerX <span class="jass-op">-</span> radius, centerY <span class="jass-op">-</span> radius, centerX <span class="jass-op">+</span> radius, centerY <span class="jass-op">+</span> radius)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Camera Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetCurrentCameraSetup</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">camerasetup</span>
    <span class="jass-keyword">local</span> <span class="jass-type">camerasetup</span> theCam <span class="jass-op">=</span> <span class="jass-common-j-native">CreateCameraSetup</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> duration <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_TARGET_DISTANCE</span>, <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_TARGET_DISTANCE</span>), duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_FARZ</span>,            <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_FARZ</span>),            duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_ZOFFSET</span>,         <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_ZOFFSET</span>),         duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_ANGLE_OF_ATTACK</span>, <span class="jass-const">bj_RADTODEG</span> <span class="jass-op">*</span> <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_ANGLE_OF_ATTACK</span>), duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_FIELD_OF_VIEW</span>,   <span class="jass-const">bj_RADTODEG</span> <span class="jass-op">*</span> <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_FIELD_OF_VIEW</span>),   duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_ROLL</span>,            <span class="jass-const">bj_RADTODEG</span> <span class="jass-op">*</span> <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_ROLL</span>),            duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetField</span>(theCam, <span class="jass-const">CAMERA_FIELD_ROTATION</span>,        <span class="jass-const">bj_RADTODEG</span> <span class="jass-op">*</span> <span class="jass-common-j-native">GetCameraField</span>(<span class="jass-const">CAMERA_FIELD_ROTATION</span>),        duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupSetDestPosition</span>(theCam, <span class="jass-common-j-native">GetCameraTargetPositionX</span>(), <span class="jass-common-j-native">GetCameraTargetPositionY</span>(), duration)
    <span class="jass-keyword">return</span> theCam
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraSetupApplyForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> doPan, <span class="jass-type">camerasetup</span> whichSetup, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetupApplyForceDuration</span>(whichSetup, doPan, duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraSetupGetFieldSwap</span> <span class="jass-keyword">takes</span> <span class="jass-type">camerafield</span> whichField, <span class="jass-type">camerasetup</span> whichSetup <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">CameraSetupGetField</span>(whichSetup, whichField)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraFieldForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">camerafield</span> whichField, <span class="jass-type">real</span> value, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraField</span>(whichField, value, duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraTargetControllerNoZForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> xoffset, <span class="jass-type">real</span> yoffset, <span class="jass-type">boolean</span> inheritOrientation <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraTargetController</span>(whichUnit, xoffset, yoffset, inheritOrientation)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraPositionForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraPosition</span>(x, y)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraPositionLocForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraPosition</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RotateCameraAroundLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> degrees, <span class="jass-type">location</span> loc, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraRotateMode</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), <span class="jass-const">bj_DEGTORAD</span> <span class="jass-op">*</span> degrees, duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PanCameraToForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraTo</span>(x, y)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PanCameraToLocForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraTo</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PanCameraToTimedForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraToTimed</span>(x, y, duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PanCameraToTimedLocForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraToTimed</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PanCameraToTimedLocWithZForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> zOffset, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraToTimedWithZ</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), zOffset, duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SmartCameraPanBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> dist
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

        <span class="jass-keyword">set</span> dist <span class="jass-op">=</span> <span class="jass-blizzard-j-function">DistanceBetweenPoints</span>(loc, <span class="jass-common-j-native">GetCameraTargetPositionLoc</span>())
        <span class="jass-keyword">if</span> (dist <span class="jass-op">&gt;=</span> <span class="jass-const">bj_SMARTPAN_TRESHOLD_SNAP</span>) <span class="jass-keyword">then</span>
            <span class="jass-comment">// If the user is too far away, snap the camera.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraToTimed</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), <span class="jass-number">0</span>)
        <span class="jass-keyword">elseif</span> (dist <span class="jass-op">&gt;=</span> <span class="jass-const">bj_SMARTPAN_TRESHOLD_PAN</span>) <span class="jass-keyword">then</span>
            <span class="jass-comment">// If the user is moderately close, pan the camera.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PanCameraToTimed</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), duration)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// User is close enough, so don't touch the camera.</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCinematicCameraForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">string</span> cameraModelFile <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCinematicCamera</span>(cameraModelFile)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ResetToGameCameraForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ResetToGameCamera</span>(duration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraSetSourceNoiseForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> magnitude, <span class="jass-type">real</span> velocity <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetSourceNoise</span>(magnitude, velocity)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraSetTargetNoiseForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> magnitude, <span class="jass-type">real</span> velocity <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetTargetNoise</span>(magnitude, velocity)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraSetEQNoiseForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> magnitude <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> richter <span class="jass-op">=</span> magnitude
    <span class="jass-keyword">if</span> (richter <span class="jass-op">&gt;</span> <span class="jass-number">5.0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> richter <span class="jass-op">=</span> <span class="jass-number">5.0</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">if</span> (richter <span class="jass-op">&lt;</span> <span class="jass-number">2.0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> richter <span class="jass-op">=</span> <span class="jass-number">2.0</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetTargetNoiseEx</span>(magnitude<span class="jass-op">*</span><span class="jass-number">2.0</span>, magnitude<span class="jass-op">*</span><span class="jass-common-j-native">Pow</span>(<span class="jass-number">10</span>,richter),<span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetSourceNoiseEx</span>(magnitude<span class="jass-op">*</span><span class="jass-number">2.0</span>, magnitude<span class="jass-op">*</span><span class="jass-common-j-native">Pow</span>(<span class="jass-number">10</span>,richter),<span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraClearNoiseForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetSourceNoise</span>(<span class="jass-number">0</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetTargetNoise</span>(<span class="jass-number">0</span>, <span class="jass-number">0</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Query the current camera bounds.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetCurrentCameraBoundsMapRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Rect</span>(<span class="jass-common-j-native">GetCameraBoundMinX</span>(), <span class="jass-common-j-native">GetCameraBoundMinY</span>(), <span class="jass-common-j-native">GetCameraBoundMaxX</span>(), <span class="jass-common-j-native">GetCameraBoundMaxY</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Query the initial camera bounds, as defined at map init.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetCameraBoundsMapRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_mapInitialCameraBounds</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Query the playable map area, as defined at map init.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayableMapRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_mapInitialPlayableArea</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Query the entire map area, as defined at map init.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetEntireMapRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">rect</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetWorldBounds</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraBoundsToRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> minX <span class="jass-op">=</span> <span class="jass-common-j-native">GetRectMinX</span>(r)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> minY <span class="jass-op">=</span> <span class="jass-common-j-native">GetRectMinY</span>(r)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> maxX <span class="jass-op">=</span> <span class="jass-common-j-native">GetRectMaxX</span>(r)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> maxY <span class="jass-op">=</span> <span class="jass-common-j-native">GetRectMaxY</span>(r)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraBounds</span>(minX, minY, minX, maxY, maxX, maxY, maxX, minY)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraBoundsToRectForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraBoundsToRect</span>(r)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AdjustCameraBoundsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> adjustMethod, <span class="jass-type">real</span> dxWest, <span class="jass-type">real</span> dxEast, <span class="jass-type">real</span> dyNorth, <span class="jass-type">real</span> dySouth <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> minX <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> minY <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> maxX <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> maxY <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> scale <span class="jass-op">=</span> <span class="jass-number">0</span>

    <span class="jass-keyword">if</span> (adjustMethod <span class="jass-op">==</span> <span class="jass-const">bj_CAMERABOUNDS_ADJUST_ADD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> scale <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">elseif</span> (adjustMethod <span class="jass-op">==</span> <span class="jass-const">bj_CAMERABOUNDS_ADJUST_SUB</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> scale <span class="jass-op">=</span> <span class="jass-op">-</span><span class="jass-number">1</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized adjustment method - ignore the request.</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Adjust the actual camera values</span>
    <span class="jass-keyword">set</span> minX <span class="jass-op">=</span> <span class="jass-common-j-native">GetCameraBoundMinX</span>() <span class="jass-op">-</span> scale <span class="jass-op">*</span> dxWest
    <span class="jass-keyword">set</span> maxX <span class="jass-op">=</span> <span class="jass-common-j-native">GetCameraBoundMaxX</span>() <span class="jass-op">+</span> scale <span class="jass-op">*</span> dxEast
    <span class="jass-keyword">set</span> minY <span class="jass-op">=</span> <span class="jass-common-j-native">GetCameraBoundMinY</span>() <span class="jass-op">-</span> scale <span class="jass-op">*</span> dySouth
    <span class="jass-keyword">set</span> maxY <span class="jass-op">=</span> <span class="jass-common-j-native">GetCameraBoundMaxY</span>() <span class="jass-op">+</span> scale <span class="jass-op">*</span> dyNorth

    <span class="jass-comment">// Make sure the camera bounds are still valid.</span>
    <span class="jass-keyword">if</span> (maxX <span class="jass-op">&lt;</span> minX) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> minX <span class="jass-op">=</span> (minX <span class="jass-op">+</span> maxX) <span class="jass-op">*</span> <span class="jass-number">0.5</span>
        <span class="jass-keyword">set</span> maxX <span class="jass-op">=</span> minX
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">if</span> (maxY <span class="jass-op">&lt;</span> minY) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> minY <span class="jass-op">=</span> (minY <span class="jass-op">+</span> maxY) <span class="jass-op">*</span> <span class="jass-number">0.5</span>
        <span class="jass-keyword">set</span> maxY <span class="jass-op">=</span> minY
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Apply the new camera values.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraBounds</span>(minX, minY, minX, maxY, maxX, maxY, maxX, minY)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AdjustCameraBoundsForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> adjustMethod, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> dxWest, <span class="jass-type">real</span> dxEast, <span class="jass-type">real</span> dyNorth, <span class="jass-type">real</span> dySouth <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AdjustCameraBoundsBJ</span>(adjustMethod, dxWest, dxEast, dyNorth, dySouth)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraQuickPosition</span>(x, y)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionLocForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraQuickPosition</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraQuickPosition</span>(<span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StopCameraForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopCamera</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCameraOrientControllerForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> xoffset, <span class="jass-type">real</span> yoffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCameraOrientController</span>(whichUnit, xoffset, yoffset)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraSetSmoothingFactorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> factor <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetSmoothingFactor</span>(factor)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CameraResetSmoothingFactorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CameraSetSmoothingFactor</span>(<span class="jass-number">0</span>)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Text Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DisplayTextToForce</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> toForce, <span class="jass-type">string</span> message <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), toForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, message)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DisplayTimedTextToForce</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> toForce, <span class="jass-type">real</span> duration, <span class="jass-type">string</span> message <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), toForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, duration, message)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ClearTextMessagesBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> toForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), toForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearTextMessages</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// The parameters for the API Substring function are unintuitive, so this</span>
<span class="jass-comment">// merely performs a translation for the starting index.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SubStringBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> source, <span class="jass-type">integer</span> start, <span class="jass-type">integer</span> end <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">SubString</span>(source, start<span class="jass-op">-</span><span class="jass-number">1</span>, end)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Event Registration Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterTimerEventPeriodic</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">real</span> timeout <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterTimerEvent</span>(trig, timeout, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterTimerEventSingle</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">real</span> timeout <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterTimerEvent</span>(trig, timeout, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterTimerExpireEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">timer</span> t <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterTimerExpireEvent</span>(trig, t)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerUnitEventSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playerunitevent</span> whichEvent <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, whichPlayer, whichEvent, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterAnyUnitEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">playerunitevent</span> whichEvent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, <span class="jass-common-j-native">Player</span>(index), whichEvent, <span class="jass-type">null</span>)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerSelectionEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> selected <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">if</span> selected <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_UNIT_SELECTED</span>, <span class="jass-type">null</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_UNIT_DESELECTED</span>, <span class="jass-type">null</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerKeyEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">integer</span> keType, <span class="jass-type">integer</span> keKey <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">if</span> (keType <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTTYPE_DEPRESS</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Depress event - find out what key</span>
        <span class="jass-keyword">if</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_LEFT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_LEFT_DOWN</span>)
        <span class="jass-keyword">elseif</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_RIGHT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_RIGHT_DOWN</span>)
        <span class="jass-keyword">elseif</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_DOWN</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_DOWN_DOWN</span>)
        <span class="jass-keyword">elseif</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_UP</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_UP_DOWN</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized key - ignore the request and return failure.</span>
            <span class="jass-keyword">return</span> <span class="jass-type">null</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">elseif</span> (keType <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTTYPE_RELEASE</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Release event - find out what key</span>
        <span class="jass-keyword">if</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_LEFT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_LEFT_UP</span>)
        <span class="jass-keyword">elseif</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_RIGHT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_RIGHT_UP</span>)
        <span class="jass-keyword">elseif</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_DOWN</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_DOWN_UP</span>)
        <span class="jass-keyword">elseif</span> (keKey <span class="jass-op">==</span> <span class="jass-const">bj_KEYEVENTKEY_UP</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ARROW_UP_UP</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized key - ignore the request and return failure.</span>
            <span class="jass-keyword">return</span> <span class="jass-type">null</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized type - ignore the request and return failure.</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerEventVictory</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_VICTORY</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerEventDefeat</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_DEFEAT</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerEventLeave</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_LEAVE</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerEventAllianceChanged</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_ALLIANCE_CHANGED</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterPlayerEventEndCinematic</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, whichPlayer, <span class="jass-const">EVENT_PLAYER_END_CINEMATIC</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterGameStateEventTimeOfDay</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">limitop</span> opcode, <span class="jass-type">real</span> limitval <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(trig, <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, opcode, limitval)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterEnterRegionSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">region</span> whichRegion <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterEnterRegion</span>(trig, whichRegion, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterLeaveRegionSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">region</span> whichRegion <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterLeaveRegion</span>(trig, whichRegion, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterEnterRectSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">local</span> <span class="jass-type">region</span> rectRegion <span class="jass-op">=</span> <span class="jass-common-j-native">CreateRegion</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RegionAddRect</span>(rectRegion, r)
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterEnterRegion</span>(trig, rectRegion, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterLeaveRectSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">local</span> <span class="jass-type">region</span> rectRegion <span class="jass-op">=</span> <span class="jass-common-j-native">CreateRegion</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RegionAddRect</span>(rectRegion, r)
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterLeaveRegion</span>(trig, rectRegion, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterDistanceBetweenUnits</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolexpr</span> condition, <span class="jass-type">real</span> range <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterUnitInRange</span>(trig, whichUnit, range, condition)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterUnitInRangeSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">real</span> range, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterUnitInRange</span>(trig, whichUnit, range, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterUnitLifeEvent</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">limitop</span> opcode, <span class="jass-type">real</span> limitval <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterUnitStateEvent</span>(trig, whichUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, opcode, limitval)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterUnitManaEvent</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">limitop</span> opcode, <span class="jass-type">real</span> limitval <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterUnitStateEvent</span>(trig, whichUnit, <span class="jass-const">UNIT_STATE_MANA</span>, opcode, limitval)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterDialogEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">dialog</span> whichDialog <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterDialogEvent</span>(trig, whichDialog)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterShowSkillEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterGameEvent</span>(trig, <span class="jass-const">EVENT_GAME_SHOW_SKILL</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterBuildSubmenuEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterGameEvent</span>(trig, <span class="jass-const">EVENT_GAME_BUILD_SUBMENU</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterGameLoadedEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterGameEvent</span>(trig, <span class="jass-const">EVENT_GAME_LOADED</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterGameSavedEventBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">TriggerRegisterGameEvent</span>(trig, <span class="jass-const">EVENT_GAME_SAVE</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RegisterDestDeathInRegionEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_destInRegionDiesCount</span> <span class="jass-op">=</span> <span class="jass-const">bj_destInRegionDiesCount</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_destInRegionDiesCount</span> <span class="jass-op">&lt;=</span> <span class="jass-const">bj_MAX_DEST_IN_REGION_EVENTS</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDeathEvent</span>(<span class="jass-const">bj_destInRegionDiesTrig</span>, <span class="jass-common-j-native">GetEnumDestructable</span>())
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerRegisterDestDeathInRegionEvent</span> <span class="jass-keyword">takes</span> <span class="jass-type">trigger</span> trig, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">event</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_destInRegionDiesTrig</span> <span class="jass-op">=</span> trig
    <span class="jass-keyword">set</span> <span class="jass-const">bj_destInRegionDiesCount</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumDestructablesInRect</span>(r, <span class="jass-type">null</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RegisterDestDeathInRegionEnum</span>)
    <span class="jass-keyword">return</span> trig
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Environment Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddWeatherEffectSaveLast</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> where, <span class="jass-type">integer</span> effectID <span class="jass-keyword">returns</span> <span class="jass-type">weathereffect</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedWeatherEffect</span> <span class="jass-op">=</span> <span class="jass-common-j-native">AddWeatherEffect</span>(where, effectID)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedWeatherEffect</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedWeatherEffect</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">weathereffect</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedWeatherEffect</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemoveWeatherEffectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">weathereffect</span> whichWeatherEffect <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveWeatherEffect</span>(whichWeatherEffect)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TerrainDeformationCraterBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">boolean</span> permanent, <span class="jass-type">location</span> where, <span class="jass-type">real</span> radius, <span class="jass-type">real</span> depth <span class="jass-keyword">returns</span> <span class="jass-type">terraindeformation</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span> <span class="jass-op">=</span> <span class="jass-common-j-native">TerrainDeformCrater</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), radius, depth, <span class="jass-common-j-native">R2I</span>(duration <span class="jass-op">*</span> <span class="jass-number">1000</span>), permanent)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TerrainDeformationRippleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">boolean</span> limitNeg, <span class="jass-type">location</span> where, <span class="jass-type">real</span> startRadius, <span class="jass-type">real</span> endRadius, <span class="jass-type">real</span> depth, <span class="jass-type">real</span> wavePeriod, <span class="jass-type">real</span> waveWidth <span class="jass-keyword">returns</span> <span class="jass-type">terraindeformation</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> spaceWave
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> timeWave
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> radiusRatio

    <span class="jass-keyword">if</span> (endRadius <span class="jass-op">&lt;=</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> waveWidth <span class="jass-op">&lt;=</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> wavePeriod <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> timeWave <span class="jass-op">=</span> <span class="jass-number">2.0</span> <span class="jass-op">*</span> duration <span class="jass-op">/</span> wavePeriod
    <span class="jass-keyword">set</span> spaceWave <span class="jass-op">=</span> <span class="jass-number">2.0</span> <span class="jass-op">*</span> endRadius <span class="jass-op">/</span> waveWidth
    <span class="jass-keyword">set</span> radiusRatio <span class="jass-op">=</span> startRadius <span class="jass-op">/</span> endRadius

    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span> <span class="jass-op">=</span> <span class="jass-common-j-native">TerrainDeformRipple</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), endRadius, depth, <span class="jass-common-j-native">R2I</span>(duration <span class="jass-op">*</span> <span class="jass-number">1000</span>), <span class="jass-number">1</span>, spaceWave, timeWave, radiusRatio, limitNeg)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TerrainDeformationWaveBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">location</span> source, <span class="jass-type">location</span> target, <span class="jass-type">real</span> radius, <span class="jass-type">real</span> depth, <span class="jass-type">real</span> trailDelay <span class="jass-keyword">returns</span> <span class="jass-type">terraindeformation</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> distance
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> dirX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> dirY
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> speed

    <span class="jass-keyword">set</span> distance <span class="jass-op">=</span> <span class="jass-blizzard-j-function">DistanceBetweenPoints</span>(source, target)
    <span class="jass-keyword">if</span> (distance <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> duration <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> dirX <span class="jass-op">=</span> (<span class="jass-common-j-native">GetLocationX</span>(target) <span class="jass-op">-</span> <span class="jass-common-j-native">GetLocationX</span>(source)) <span class="jass-op">/</span> distance
    <span class="jass-keyword">set</span> dirY <span class="jass-op">=</span> (<span class="jass-common-j-native">GetLocationY</span>(target) <span class="jass-op">-</span> <span class="jass-common-j-native">GetLocationY</span>(source)) <span class="jass-op">/</span> distance
    <span class="jass-keyword">set</span> speed <span class="jass-op">=</span> distance <span class="jass-op">/</span> duration

    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span> <span class="jass-op">=</span> <span class="jass-common-j-native">TerrainDeformWave</span>(<span class="jass-common-j-native">GetLocationX</span>(source), <span class="jass-common-j-native">GetLocationY</span>(source), dirX, dirY, distance, speed, radius, depth, <span class="jass-common-j-native">R2I</span>(trailDelay <span class="jass-op">*</span> <span class="jass-number">1000</span>), <span class="jass-number">1</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TerrainDeformationRandomBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">location</span> where, <span class="jass-type">real</span> radius, <span class="jass-type">real</span> minDelta, <span class="jass-type">real</span> maxDelta, <span class="jass-type">real</span> updateInterval <span class="jass-keyword">returns</span> <span class="jass-type">terraindeformation</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span> <span class="jass-op">=</span> <span class="jass-common-j-native">TerrainDeformRandom</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), radius, minDelta, maxDelta, <span class="jass-common-j-native">R2I</span>(duration <span class="jass-op">*</span> <span class="jass-number">1000</span>), <span class="jass-common-j-native">R2I</span>(updateInterval <span class="jass-op">*</span> <span class="jass-number">1000</span>))
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TerrainDeformationStopBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">terraindeformation</span> deformation, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TerrainDeformStop</span>(deformation, <span class="jass-common-j-native">R2I</span>(duration <span class="jass-op">*</span> <span class="jass-number">1000</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedTerrainDeformation</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">terraindeformation</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTerrainDeformation</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddLightningLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> codeName, <span class="jass-type">location</span> where1, <span class="jass-type">location</span> where2 <span class="jass-keyword">returns</span> <span class="jass-type">lightning</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedLightning</span> <span class="jass-op">=</span> <span class="jass-common-j-native">AddLightningEx</span>(codeName, <span class="jass-const">true</span>, <span class="jass-common-j-native">GetLocationX</span>(where1), <span class="jass-common-j-native">GetLocationY</span>(where1), <span class="jass-common-j-native">GetLocationZ</span>(where1), <span class="jass-common-j-native">GetLocationX</span>(where2), <span class="jass-common-j-native">GetLocationY</span>(where2), <span class="jass-common-j-native">GetLocationZ</span>(where2))
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedLightning</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyLightningBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">DestroyLightning</span>(whichBolt)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MoveLightningLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt, <span class="jass-type">location</span> where1, <span class="jass-type">location</span> where2 <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">MoveLightningEx</span>(whichBolt, <span class="jass-const">true</span>, <span class="jass-common-j-native">GetLocationX</span>(where1), <span class="jass-common-j-native">GetLocationY</span>(where1), <span class="jass-common-j-native">GetLocationZ</span>(where1), <span class="jass-common-j-native">GetLocationX</span>(where2), <span class="jass-common-j-native">GetLocationY</span>(where2), <span class="jass-common-j-native">GetLocationZ</span>(where2))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLightningColorABJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLightningColorA</span>(whichBolt)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLightningColorRBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLightningColorR</span>(whichBolt)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLightningColorGBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLightningColorG</span>(whichBolt)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLightningColorBBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLightningColorB</span>(whichBolt)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetLightningColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">lightning</span> whichBolt, <span class="jass-type">real</span> r, <span class="jass-type">real</span> g, <span class="jass-type">real</span> b, <span class="jass-type">real</span> a <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">SetLightningColor</span>(whichBolt, r, g, b, a)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedLightningBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">lightning</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedLightning</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetAbilityEffectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode, <span class="jass-type">effecttype</span> t, <span class="jass-type">integer</span> index <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetAbilityEffectById</span>(abilcode, t, index)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetAbilitySoundBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode, <span class="jass-type">soundtype</span> t <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetAbilitySoundById</span>(abilcode, t)
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTerrainCliffLevelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTerrainCliffLevel</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTerrainTypeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTerrainType</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTerrainVarianceBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTerrainVariance</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTerrainTypeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where, <span class="jass-type">integer</span> terrainType, <span class="jass-type">integer</span> variation, <span class="jass-type">integer</span> area, <span class="jass-type">integer</span> shape <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTerrainType</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), terrainType, variation, area, shape)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsTerrainPathableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where, <span class="jass-type">pathingtype</span> t <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsTerrainPathable</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), t)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTerrainPathableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where, <span class="jass-type">pathingtype</span> t, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTerrainPathable</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), t, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetWaterBaseColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetWaterBaseColor</span>(<span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateFogModifierRectSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">fogstate</span> whichFogState, <span class="jass-type">rect</span> r, <span class="jass-type">boolean</span> afterUnits <span class="jass-keyword">returns</span> <span class="jass-type">fogmodifier</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedFogModifier</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateFogModifierRect</span>(whichPlayer, whichFogState, r, <span class="jass-const">true</span>, afterUnits)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedFogModifier</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateFogModifierRadiusLocSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">fogstate</span> whichFogState, <span class="jass-type">location</span> center, <span class="jass-type">real</span> radius, <span class="jass-type">boolean</span> afterUnits <span class="jass-keyword">returns</span> <span class="jass-type">fogmodifier</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedFogModifier</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateFogModifierRadiusLoc</span>(whichPlayer, whichFogState, center, radius, <span class="jass-const">true</span>, afterUnits)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedFogModifier</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Version of CreateFogModifierRect that assumes use of sharedVision and</span>
<span class="jass-comment">// gives the option of immediately enabling the modifier, so that triggers</span>
<span class="jass-comment">// can default to modifiers that are immediately enabled.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateFogModifierRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enabled, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">fogstate</span> whichFogState, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">fogmodifier</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedFogModifier</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateFogModifierRect</span>(whichPlayer, whichFogState, r, <span class="jass-const">true</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">if</span> enabled <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogModifierStart</span>(<span class="jass-const">bj_lastCreatedFogModifier</span>)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedFogModifier</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Version of CreateFogModifierRadius that assumes use of sharedVision and</span>
<span class="jass-comment">// gives the option of immediately enabling the modifier, so that triggers</span>
<span class="jass-comment">// can default to modifiers that are immediately enabled.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateFogModifierRadiusLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enabled, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">fogstate</span> whichFogState, <span class="jass-type">location</span> center, <span class="jass-type">real</span> radius <span class="jass-keyword">returns</span> <span class="jass-type">fogmodifier</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedFogModifier</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateFogModifierRadiusLoc</span>(whichPlayer, whichFogState, center, radius, <span class="jass-const">true</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">if</span> enabled <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogModifierStart</span>(<span class="jass-const">bj_lastCreatedFogModifier</span>)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedFogModifier</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedFogModifier</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">fogmodifier</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedFogModifier</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FogEnableOn</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogEnable</span>(<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FogEnableOff</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogEnable</span>(<span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FogMaskEnableOn</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogMaskEnable</span>(<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FogMaskEnableOff</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogMaskEnable</span>(<span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UseTimeOfDayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SuspendTimeOfDay</span>(<span class="jass-keyword">not</span> flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTerrainFogExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> style, <span class="jass-type">real</span> zstart, <span class="jass-type">real</span> zend, <span class="jass-type">real</span> density, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTerrainFogEx</span>(style, zstart, zend, density, red <span class="jass-op">*</span> <span class="jass-number">0.01</span>, green <span class="jass-op">*</span> <span class="jass-number">0.01</span>, blue <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ResetTerrainFogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ResetTerrainFog</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDoodadAnimationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> animName, <span class="jass-type">integer</span> doodadID, <span class="jass-type">real</span> radius, <span class="jass-type">location</span> center <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDoodadAnimation</span>(<span class="jass-common-j-native">GetLocationX</span>(center), <span class="jass-common-j-native">GetLocationY</span>(center), radius, doodadID, <span class="jass-const">false</span>, animName, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDoodadAnimationRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> animName, <span class="jass-type">integer</span> doodadID, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDoodadAnimationRect</span>(r, doodadID, animName, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddUnitAnimationPropertiesBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> add, <span class="jass-type">string</span> animProperties, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddUnitAnimationProperties</span>(whichUnit, animProperties, add)
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateImageBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> file, <span class="jass-type">real</span> size, <span class="jass-type">location</span> where, <span class="jass-type">real</span> zOffset, <span class="jass-type">integer</span> imageType <span class="jass-keyword">returns</span> <span class="jass-type">image</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedImage</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateImage</span>(file, size, size, size, <span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), zOffset, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">0</span>, imageType)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedImage</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowImageBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">image</span> whichImage <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowImage</span>(whichImage, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetImagePositionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">image</span> whichImage, <span class="jass-type">location</span> where, <span class="jass-type">real</span> zOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetImagePosition</span>(whichImage, <span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), zOffset)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetImageColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">image</span> whichImage, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> alpha <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetImageColor</span>(whichImage, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>alpha))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedImage</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">image</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedImage</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateUbersplatBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where, <span class="jass-type">string</span> name, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> alpha, <span class="jass-type">boolean</span> forcePaused, <span class="jass-type">boolean</span> noBirthTime <span class="jass-keyword">returns</span> <span class="jass-type">ubersplat</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedUbersplat</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUbersplat</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where), name, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>alpha), forcePaused, noBirthTime)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedUbersplat</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowUbersplatBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">ubersplat</span> whichSplat <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowUbersplat</span>(whichSplat, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//============================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedUbersplat</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">ubersplat</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedUbersplat</span>
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Sound Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlaySoundBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastPlayedSound</span> <span class="jass-op">=</span> soundHandle
    <span class="jass-keyword">if</span> (soundHandle <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(soundHandle)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StopSoundBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">boolean</span> fadeOut <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopSound</span>(soundHandle, <span class="jass-const">false</span>, fadeOut)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSoundVolumeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> volumePercent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundVolume</span>(soundHandle, <span class="jass-blizzard-j-function">PercentToInt</span>(volumePercent, <span class="jass-number">127</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSoundOffsetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> newOffset, <span class="jass-type">sound</span> soundHandle <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundPlayPosition</span>(soundHandle, <span class="jass-common-j-native">R2I</span>(newOffset <span class="jass-op">*</span> <span class="jass-number">1000</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSoundDistanceCutoffBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> cutoff <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundDistanceCutoff</span>(soundHandle, cutoff)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSoundPitchBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> pitch <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundPitch</span>(soundHandle, pitch)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSoundPositionLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> z <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundPosition</span>(soundHandle, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), z)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AttachSoundToUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AttachSoundToUnit</span>(soundHandle, whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSoundConeAnglesBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> inside, <span class="jass-type">real</span> outside, <span class="jass-type">real</span> outsideVolumePercent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundConeAngles</span>(soundHandle, inside, outside, <span class="jass-blizzard-j-function">PercentToInt</span>(outsideVolumePercent, <span class="jass-number">127</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">KillSoundWhenDoneBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillSoundWhenDone</span>(soundHandle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlaySoundAtPointBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> volumePercent, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> z <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetSoundPositionLocBJ</span>(soundHandle, loc, z)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetSoundVolumeBJ</span>(soundHandle, volumePercent)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PlaySoundBJ</span>(soundHandle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlaySoundOnUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> volumePercent, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AttachSoundToUnitBJ</span>(soundHandle, whichUnit)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetSoundVolumeBJ</span>(soundHandle, volumePercent)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PlaySoundBJ</span>(soundHandle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlaySoundFromOffsetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> volumePercent, <span class="jass-type">real</span> startingOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetSoundVolumeBJ</span>(soundHandle, volumePercent)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PlaySoundBJ</span>(soundHandle)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetSoundOffsetBJ</span>(startingOffset, soundHandle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlayMusicBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicFileName <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastPlayedMusic</span> <span class="jass-op">=</span> musicFileName
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayMusic</span>(musicFileName)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlayMusicExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicFileName, <span class="jass-type">real</span> startingOffset, <span class="jass-type">real</span> fadeInTime <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastPlayedMusic</span> <span class="jass-op">=</span> musicFileName
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayMusicEx</span>(musicFileName, <span class="jass-common-j-native">R2I</span>(startingOffset <span class="jass-op">*</span> <span class="jass-number">1000</span>), <span class="jass-common-j-native">R2I</span>(fadeInTime <span class="jass-op">*</span> <span class="jass-number">1000</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetMusicOffsetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> newOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMusicPlayPosition</span>(<span class="jass-common-j-native">R2I</span>(newOffset <span class="jass-op">*</span> <span class="jass-number">1000</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlayThematicMusicBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicName <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayThematicMusic</span>(musicName)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlayThematicMusicExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicName, <span class="jass-type">real</span> startingOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayThematicMusicEx</span>(musicName, <span class="jass-common-j-native">R2I</span>(startingOffset <span class="jass-op">*</span> <span class="jass-number">1000</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetThematicMusicOffsetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> newOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetThematicMusicPlayPosition</span>(<span class="jass-common-j-native">R2I</span>(newOffset <span class="jass-op">*</span> <span class="jass-number">1000</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EndThematicMusicBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndThematicMusic</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StopMusicBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> fadeOut <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopMusic</span>(fadeOut)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ResumeMusicBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ResumeMusic</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetMusicVolumeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> volumePercent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMusicVolume</span>(<span class="jass-blizzard-j-function">PercentToInt</span>(volumePercent, <span class="jass-number">127</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetSoundDurationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">if</span> (soundHandle <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">bj_NOTHING_SOUND_DURATION</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">I2R</span>(<span class="jass-common-j-native">GetSoundDuration</span>(soundHandle)) <span class="jass-op">*</span> <span class="jass-number">0.001</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetSoundFileDurationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicFileName <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">I2R</span>(<span class="jass-common-j-native">GetSoundFileDuration</span>(musicFileName)) <span class="jass-op">*</span> <span class="jass-number">0.001</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastPlayedSound</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">sound</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastPlayedSound</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastPlayedMusic</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastPlayedMusic</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">VolumeGroupSetVolumeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">volumegroup</span> vgroup, <span class="jass-type">real</span> percent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(vgroup, percent <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCineModeVolumeGroupsImmediateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_UNITMOVEMENT</span>,  <span class="jass-const">bj_CINEMODE_VOLUME_UNITMOVEMENT</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_UNITSOUNDS</span>,    <span class="jass-const">bj_CINEMODE_VOLUME_UNITSOUNDS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_COMBAT</span>,        <span class="jass-const">bj_CINEMODE_VOLUME_COMBAT</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_SPELLS</span>,        <span class="jass-const">bj_CINEMODE_VOLUME_SPELLS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_UI</span>,            <span class="jass-const">bj_CINEMODE_VOLUME_UI</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_MUSIC</span>,         <span class="jass-const">bj_CINEMODE_VOLUME_MUSIC</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_AMBIENTSOUNDS</span>, <span class="jass-const">bj_CINEMODE_VOLUME_AMBIENTSOUNDS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_FIRE</span>,          <span class="jass-const">bj_CINEMODE_VOLUME_FIRE</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCineModeVolumeGroupsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Delay the request if it occurs at map init.</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_gameStarted</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCineModeVolumeGroupsImmediateBJ</span>()
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_volumeGroupsTimer</span>, <span class="jass-const">bj_GAME_STARTED_THRESHOLD</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCineModeVolumeGroupsImmediateBJ</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSpeechVolumeGroupsImmediateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_UNITMOVEMENT</span>,  <span class="jass-const">bj_SPEECH_VOLUME_UNITMOVEMENT</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_UNITSOUNDS</span>,    <span class="jass-const">bj_SPEECH_VOLUME_UNITSOUNDS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_COMBAT</span>,        <span class="jass-const">bj_SPEECH_VOLUME_COMBAT</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_SPELLS</span>,        <span class="jass-const">bj_SPEECH_VOLUME_SPELLS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_UI</span>,            <span class="jass-const">bj_SPEECH_VOLUME_UI</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_MUSIC</span>,         <span class="jass-const">bj_SPEECH_VOLUME_MUSIC</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_AMBIENTSOUNDS</span>, <span class="jass-const">bj_SPEECH_VOLUME_AMBIENTSOUNDS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(<span class="jass-const">SOUND_VOLUMEGROUP_FIRE</span>,          <span class="jass-const">bj_SPEECH_VOLUME_FIRE</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSpeechVolumeGroupsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Delay the request if it occurs at map init.</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_gameStarted</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetSpeechVolumeGroupsImmediateBJ</span>()
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_volumeGroupsTimer</span>, <span class="jass-const">bj_GAME_STARTED_THRESHOLD</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetSpeechVolumeGroupsImmediateBJ</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">VolumeGroupResetImmediateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupReset</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">VolumeGroupResetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Delay the request if it occurs at map init.</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_gameStarted</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">VolumeGroupResetImmediateBJ</span>()
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_volumeGroupsTimer</span>, <span class="jass-const">bj_GAME_STARTED_THRESHOLD</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">VolumeGroupResetImmediateBJ</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetSoundIsPlayingBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetSoundIsLoading</span>(soundHandle) <span class="jass-keyword">or</span> <span class="jass-common-j-native">GetSoundIsPlaying</span>(soundHandle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WaitForSoundBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">real</span> offset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerWaitForSound</span>( soundHandle, offset )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetMapMusicIndexedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicName, <span class="jass-type">integer</span> index <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMapMusic</span>(musicName, <span class="jass-const">false</span>, index)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetMapMusicRandomBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> musicName <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMapMusic</span>(musicName, <span class="jass-const">true</span>, <span class="jass-number">0</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ClearMapMusicBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearMapMusic</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetStackedSoundBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> add, <span class="jass-type">sound</span> soundHandle, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> width <span class="jass-op">=</span> <span class="jass-common-j-native">GetRectMaxX</span>(r) <span class="jass-op">-</span> <span class="jass-common-j-native">GetRectMinX</span>(r)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> height <span class="jass-op">=</span> <span class="jass-common-j-native">GetRectMaxY</span>(r) <span class="jass-op">-</span> <span class="jass-common-j-native">GetRectMinY</span>(r)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetSoundPosition</span>(soundHandle, <span class="jass-common-j-native">GetRectCenterX</span>(r), <span class="jass-common-j-native">GetRectCenterY</span>(r), <span class="jass-number">0</span>)
    <span class="jass-keyword">if</span> add <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RegisterStackedSound</span>(soundHandle, <span class="jass-const">true</span>, width, height)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnregisterStackedSound</span>(soundHandle, <span class="jass-const">true</span>, width, height)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StartSoundForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">sound</span> soundHandle <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (whichPlayer <span class="jass-op">==</span> <span class="jass-common-j-native">GetLocalPlayer</span>()) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(soundHandle)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">VolumeGroupSetVolumeForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">volumegroup</span> vgroup, <span class="jass-type">real</span> scale <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupSetVolume</span>(vgroup, scale)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnableDawnDusk</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_useDawnDuskSounds</span> <span class="jass-op">=</span> flag
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsDawnDuskEnabled</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_useDawnDuskSounds</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Day/Night ambient sounds</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetAmbientDaySound</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> inLabel <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> ToD

    <span class="jass-comment">// Stop old sound, if necessary</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_dayAmbientSound</span> <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopSound</span>(<span class="jass-const">bj_dayAmbientSound</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Create new sound</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_dayAmbientSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateMIDISound</span>(inLabel, <span class="jass-number">20</span>, <span class="jass-number">20</span>)

    <span class="jass-comment">// Start the sound if necessary, based on current time</span>
    <span class="jass-keyword">set</span> ToD <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetTimeOfDay</span>()
    <span class="jass-keyword">if</span> (ToD <span class="jass-op">&gt;=</span> <span class="jass-const">bj_TOD_DAWN</span> <span class="jass-keyword">and</span> ToD <span class="jass-op">&lt;</span> <span class="jass-const">bj_TOD_DUSK</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_dayAmbientSound</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetAmbientNightSound</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> inLabel <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> ToD

    <span class="jass-comment">// Stop old sound, if necessary</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_nightAmbientSound</span> <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopSound</span>(<span class="jass-const">bj_nightAmbientSound</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Create new sound</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_nightAmbientSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateMIDISound</span>(inLabel, <span class="jass-number">20</span>, <span class="jass-number">20</span>)

    <span class="jass-comment">// Start the sound if necessary, based on current time</span>
    <span class="jass-keyword">set</span> ToD <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetTimeOfDay</span>()
    <span class="jass-keyword">if</span> (ToD <span class="jass-op">&lt;</span> <span class="jass-const">bj_TOD_DAWN</span> <span class="jass-keyword">or</span> ToD <span class="jass-op">&gt;=</span> <span class="jass-const">bj_TOD_DUSK</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_nightAmbientSound</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Special Effect Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddSpecialEffectLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where, <span class="jass-type">string</span> modelName <span class="jass-keyword">returns</span> <span class="jass-type">effect</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedEffect</span> <span class="jass-op">=</span> <span class="jass-common-j-native">AddSpecialEffectLoc</span>(modelName, where)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedEffect</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddSpecialEffectTargetUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> attachPointName, <span class="jass-type">widget</span> targetWidget, <span class="jass-type">string</span> modelName <span class="jass-keyword">returns</span> <span class="jass-type">effect</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedEffect</span> <span class="jass-op">=</span> <span class="jass-common-j-native">AddSpecialEffectTarget</span>(modelName, targetWidget, attachPointName)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedEffect</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Two distinct trigger actions can't share the same function name, so this</span>
<span class="jass-comment">// dummy function simply mimics the behavior of an existing call.</span>
<span class="jass-comment">//</span>
<span class="jass-comment">// Commented out - Destructibles have no attachment points.</span>
<span class="jass-comment">//</span>
<span class="jass-comment">//function AddSpecialEffectTargetDestructableBJ takes string attachPointName, widget targetWidget, string modelName returns effect</span>
<span class="jass-comment">//    return AddSpecialEffectTargetUnitBJ(attachPointName, targetWidget, modelName)</span>
<span class="jass-comment">//endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Two distinct trigger actions can't share the same function name, so this</span>
<span class="jass-comment">// dummy function simply mimics the behavior of an existing call.</span>
<span class="jass-comment">//</span>
<span class="jass-comment">// Commented out - Items have no attachment points.</span>
<span class="jass-comment">//</span>
<span class="jass-comment">//function AddSpecialEffectTargetItemBJ takes string attachPointName, widget targetWidget, string modelName returns effect</span>
<span class="jass-comment">//    return AddSpecialEffectTargetUnitBJ(attachPointName, targetWidget, modelName)</span>
<span class="jass-comment">//endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyEffectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">effect</span> whichEffect <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyEffect</span>(whichEffect)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedEffectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">effect</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedEffect</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Hero and Item Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetItemLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(<span class="jass-common-j-native">GetItemX</span>(whichItem), <span class="jass-common-j-native">GetItemY</span>(whichItem))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetItemLifeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">widget</span> whichWidget <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetWidgetLife</span>(whichWidget)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemLifeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">widget</span> whichWidget, <span class="jass-type">real</span> life <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetWidgetLife</span>(whichWidget, life)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddHeroXPSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> xpToAdd, <span class="jass-type">unit</span> whichHero, <span class="jass-type">boolean</span> showEyeCandy <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddHeroXP</span>(whichHero, xpToAdd, showEyeCandy)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetHeroLevelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichHero, <span class="jass-type">integer</span> newLevel, <span class="jass-type">boolean</span> showEyeCandy <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> oldLevel <span class="jass-op">=</span> <span class="jass-common-j-native">GetHeroLevel</span>(whichHero)

    <span class="jass-keyword">if</span> (newLevel <span class="jass-op">&gt;</span> oldLevel) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetHeroLevel</span>(whichHero, newLevel, showEyeCandy)
    <span class="jass-keyword">elseif</span> (newLevel <span class="jass-op">&lt;</span> oldLevel) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitStripHeroLevel</span>(whichHero, oldLevel <span class="jass-op">-</span> newLevel)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// No change in level - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DecUnitAbilityLevelSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">DecUnitAbilityLevel</span>(whichUnit, abilcode)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IncUnitAbilityLevelSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IncUnitAbilityLevel</span>(whichUnit, abilcode)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitAbilityLevelSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> level <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">SetUnitAbilityLevel</span>(whichUnit, abilcode, level)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitAbilityLevelSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitAbilityLevel</span>(whichUnit, abilcode)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitHasBuffBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> buffcode <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> (<span class="jass-common-j-native">GetUnitAbilityLevel</span>(whichUnit, buffcode) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveBuffBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> buffcode, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitRemoveAbility</span>(whichUnit, buffcode)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitAddItemSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">unit</span> whichHero <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitAddItem</span>(whichHero, whichItem)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitAddItemByIdSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> itemId, <span class="jass-type">unit</span> whichHero <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-comment">// Create the item at the hero's feet first, and then give it to him.</span>
    <span class="jass-comment">// This is to ensure that the item will be left at the hero's feet if</span>
    <span class="jass-comment">// his inventory is full.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedItem</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateItem</span>(itemId, <span class="jass-common-j-native">GetUnitX</span>(whichHero), <span class="jass-common-j-native">GetUnitY</span>(whichHero))
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitAddItem</span>(whichHero, <span class="jass-const">bj_lastCreatedItem</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveItemSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">unit</span> whichHero <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastRemovedItem</span> <span class="jass-op">=</span> whichItem
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveItem</span>(whichHero, whichItem)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Translates 0-based slot indices to 1-based slot indices.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveItemFromSlotSwapped</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> itemSlot, <span class="jass-type">unit</span> whichHero <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastRemovedItem</span> <span class="jass-op">=</span> <span class="jass-common-j-native">UnitRemoveItemFromSlot</span>(whichHero, itemSlot<span class="jass-op">-</span><span class="jass-number">1</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastRemovedItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateItemLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> itemId, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedItem</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateItem</span>(itemId, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastRemovedItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastRemovedItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemPositionLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemPosition</span>(whichItem, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLearnedSkillBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLearnedSkill</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SuspendHeroXPBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">unit</span> whichHero <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SuspendHeroXP</span>(whichHero, <span class="jass-keyword">not</span> flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerHandicapXPBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> handicapPercent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerHandicapXP</span>(whichPlayer, handicapPercent <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerHandicapXPBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerHandicapXP</span>(whichPlayer) <span class="jass-op">*</span> <span class="jass-number">100</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerHandicapBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> handicapPercent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerHandicap</span>(whichPlayer, handicapPercent <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerHandicapBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerHandicap</span>(whichPlayer) <span class="jass-op">*</span> <span class="jass-number">100</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetHeroStatBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> whichStat, <span class="jass-type">unit</span> whichHero, <span class="jass-type">boolean</span> includeBonuses <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> (whichStat <span class="jass-op">==</span> <span class="jass-const">bj_HEROSTAT_STR</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetHeroStr</span>(whichHero, includeBonuses)
    <span class="jass-keyword">elseif</span> (whichStat <span class="jass-op">==</span> <span class="jass-const">bj_HEROSTAT_AGI</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetHeroAgi</span>(whichHero, includeBonuses)
    <span class="jass-keyword">elseif</span> (whichStat <span class="jass-op">==</span> <span class="jass-const">bj_HEROSTAT_INT</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetHeroInt</span>(whichHero, includeBonuses)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized hero stat - return 0</span>
        <span class="jass-keyword">return</span> <span class="jass-number">0</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetHeroStat</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichHero, <span class="jass-type">integer</span> whichStat, <span class="jass-type">integer</span> value <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Ignore requests for negative hero stats.</span>
    <span class="jass-keyword">if</span> (value <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (whichStat <span class="jass-op">==</span> <span class="jass-const">bj_HEROSTAT_STR</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetHeroStr</span>(whichHero, value, <span class="jass-const">true</span>)
    <span class="jass-keyword">elseif</span> (whichStat <span class="jass-op">==</span> <span class="jass-const">bj_HEROSTAT_AGI</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetHeroAgi</span>(whichHero, value, <span class="jass-const">true</span>)
    <span class="jass-keyword">elseif</span> (whichStat <span class="jass-op">==</span> <span class="jass-const">bj_HEROSTAT_INT</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetHeroInt</span>(whichHero, value, <span class="jass-const">true</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized hero stat - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ModifyHeroStat</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> whichStat, <span class="jass-type">unit</span> whichHero, <span class="jass-type">integer</span> modifyMethod, <span class="jass-type">integer</span> value <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (modifyMethod <span class="jass-op">==</span> <span class="jass-const">bj_MODIFYMETHOD_ADD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetHeroStat</span>(whichHero, whichStat, <span class="jass-blizzard-j-function">GetHeroStatBJ</span>(whichStat, whichHero, <span class="jass-const">false</span>) <span class="jass-op">+</span> value)
    <span class="jass-keyword">elseif</span> (modifyMethod <span class="jass-op">==</span> <span class="jass-const">bj_MODIFYMETHOD_SUB</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetHeroStat</span>(whichHero, whichStat, <span class="jass-blizzard-j-function">GetHeroStatBJ</span>(whichStat, whichHero, <span class="jass-const">false</span>) <span class="jass-op">-</span> value)
    <span class="jass-keyword">elseif</span> (modifyMethod <span class="jass-op">==</span> <span class="jass-const">bj_MODIFYMETHOD_SET</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetHeroStat</span>(whichHero, whichStat, value)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized modification method - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ModifyHeroSkillPoints</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichHero, <span class="jass-type">integer</span> modifyMethod, <span class="jass-type">integer</span> value <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (modifyMethod <span class="jass-op">==</span> <span class="jass-const">bj_MODIFYMETHOD_ADD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitModifySkillPoints</span>(whichHero, value)
    <span class="jass-keyword">elseif</span> (modifyMethod <span class="jass-op">==</span> <span class="jass-const">bj_MODIFYMETHOD_SUB</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitModifySkillPoints</span>(whichHero, <span class="jass-op">-</span>value)
    <span class="jass-keyword">elseif</span> (modifyMethod <span class="jass-op">==</span> <span class="jass-const">bj_MODIFYMETHOD_SET</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitModifySkillPoints</span>(whichHero, value <span class="jass-op">-</span> <span class="jass-common-j-native">GetHeroSkillPoints</span>(whichHero))
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized modification method - ignore the request and return failure.</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDropItemPointBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">item</span> whichItem, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitDropItemPoint</span>(whichUnit, whichItem, x, y)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDropItemPointLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">item</span> whichItem, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitDropItemPoint</span>(whichUnit, whichItem, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDropItemSlotBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">item</span> whichItem, <span class="jass-type">integer</span> slot <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitDropItemSlot</span>(whichUnit, whichItem, slot<span class="jass-op">-</span><span class="jass-number">1</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDropItemTargetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">item</span> whichItem, <span class="jass-type">widget</span> target <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitDropItemTarget</span>(whichUnit, whichItem, target)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Two distinct trigger actions can't share the same function name, so this</span>
<span class="jass-comment">// dummy function simply mimics the behavior of an existing call.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitUseItemDestructable</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">item</span> whichItem, <span class="jass-type">widget</span> target <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitUseItemTarget</span>(whichUnit, whichItem, target)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitUseItemPointLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">item</span> whichItem, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitUseItemPoint</span>(whichUnit, whichItem, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Translates 0-based slot indices to 1-based slot indices.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitItemInSlotBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> itemSlot <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitItemInSlot</span>(whichUnit, itemSlot<span class="jass-op">-</span><span class="jass-number">1</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Translates 0-based slot indices to 1-based slot indices.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetInventoryIndexOfItemTypeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> itemId <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">item</span>    indexItem

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexItem <span class="jass-op">=</span> <span class="jass-common-j-native">UnitItemInSlot</span>(whichUnit, index)
        <span class="jass-keyword">if</span> (indexItem <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">and</span> (<span class="jass-common-j-native">GetItemTypeId</span>(indexItem) <span class="jass-op">==</span> itemId) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_MAX_INVENTORY</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">return</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetItemOfTypeFromUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> itemId <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetInventoryIndexOfItemTypeBJ</span>(whichUnit, itemId)

    <span class="jass-keyword">if</span> (index <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitItemInSlot</span>(whichUnit, index <span class="jass-op">-</span> <span class="jass-number">1</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitHasItemOfTypeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> itemId <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">GetInventoryIndexOfItemTypeBJ</span>(whichUnit, itemId) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitInventoryCount</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> count <span class="jass-op">=</span> <span class="jass-number">0</span>

    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">UnitItemInSlot</span>(whichUnit, index) <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> count <span class="jass-op">=</span> count <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_MAX_INVENTORY</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> count
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitInventorySizeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitInventorySize</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemInvulnerableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemInvulnerable</span>(whichItem, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemDropOnDeathBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemDropOnDeath</span>(whichItem, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemDroppableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemDroppable</span>(whichItem, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> changeColor <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemPlayer</span>(whichItem, whichPlayer, changeColor)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetItemVisibleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">item</span> whichItem <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemVisible</span>(whichItem, show)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsItemHiddenBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-common-j-native">IsItemVisible</span>(whichItem)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChooseRandomItemBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> level <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">ChooseRandomItem</span>(level)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChooseRandomItemExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> level, <span class="jass-type">itemtype</span> whichType <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">ChooseRandomItemEx</span>(whichType, level)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChooseRandomNPBuildingBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">ChooseRandomNPBuilding</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChooseRandomCreepBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> level <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">ChooseRandomCreep</span>(level)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnumItemsInRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">code</span> actionFunc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumItemsInRect</span>(r, <span class="jass-type">null</span>, actionFunc)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// See GroupPickRandomUnitEnum for the details of this algorithm.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomItemInRectBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_itemRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-const">bj_itemRandomConsidered</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>, <span class="jass-const">bj_itemRandomConsidered</span>) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_itemRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumItem</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Picks a random item from within a rect, matching a condition</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomItemInRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">boolexpr</span> filter <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_itemRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_itemRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumItemsInRect</span>(r, filter, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomItemInRectBJEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(filter)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_itemRandomCurrentPick</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Picks a random item from within a rect</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomItemInRectSimpleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">RandomItemInRectBJ</span>(r, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CheckItemStatus</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">integer</span> status <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEM_STATUS_HIDDEN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-common-j-native">IsItemVisible</span>(whichItem)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEM_STATUS_OWNED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemOwned</span>(whichItem)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEM_STATUS_INVULNERABLE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemInvulnerable</span>(whichItem)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEM_STATUS_POWERUP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemPowerup</span>(whichItem)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEM_STATUS_SELLABLE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemSellable</span>(whichItem)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEM_STATUS_PAWNABLE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemPawnable</span>(whichItem)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized status - return false</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CheckItemcodeStatus</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> itemId, <span class="jass-type">integer</span> status <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEMCODE_STATUS_POWERUP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemIdPowerup</span>(itemId)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEMCODE_STATUS_SELLABLE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemIdSellable</span>(itemId)
    <span class="jass-keyword">elseif</span> (status <span class="jass-op">==</span> <span class="jass-const">bj_ITEMCODE_STATUS_PAWNABLE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsItemIdPawnable</span>(itemId)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized status - return false</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Unit Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitId2OrderIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> unitId
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">String2UnitIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> unitIdString <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitId</span>(unitIdString)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitId2StringBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">local</span> <span class="jass-type">string</span> unitString <span class="jass-op">=</span> <span class="jass-common-j-native">UnitId2String</span>(unitId)

    <span class="jass-keyword">if</span> (unitString <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> unitString
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// The unitId was not recognized - return an empty string.</span>
    <span class="jass-keyword">return</span> <span class="jass-string">""</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">String2OrderIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> orderIdString <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> orderId

    <span class="jass-comment">// Check to see if it's a generic order.</span>
    <span class="jass-keyword">set</span> orderId <span class="jass-op">=</span> <span class="jass-common-j-native">OrderId</span>(orderIdString)
    <span class="jass-keyword">if</span> (orderId <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> orderId
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Check to see if it's a (train) unit order.</span>
    <span class="jass-keyword">set</span> orderId <span class="jass-op">=</span> <span class="jass-common-j-native">UnitId</span>(orderIdString)
    <span class="jass-keyword">if</span> (orderId <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> orderId
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Unrecognized - return 0</span>
    <span class="jass-keyword">return</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">OrderId2StringBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> orderId <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">local</span> <span class="jass-type">string</span> orderString

    <span class="jass-comment">// Check to see if it's a generic order.</span>
    <span class="jass-keyword">set</span> orderString <span class="jass-op">=</span> <span class="jass-common-j-native">OrderId2String</span>(orderId)
    <span class="jass-keyword">if</span> (orderString <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> orderString
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Check to see if it's a (train) unit order.</span>
    <span class="jass-keyword">set</span> orderString <span class="jass-op">=</span> <span class="jass-common-j-native">UnitId2String</span>(orderId)
    <span class="jass-keyword">if</span> (orderString <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> orderString
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Unrecognized - return an empty string.</span>
    <span class="jass-keyword">return</span> <span class="jass-string">""</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetIssuedOrderIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetIssuedOrderId</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetKillingUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetKillingUnit</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateUnitAtLocSaveLast</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> id, <span class="jass-type">integer</span> unitid, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> face <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">if</span> (unitid <span class="jass-op">==</span> <span class="jass-number">'ugol'</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedUnit</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateBlightedGoldmine</span>(id, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), face)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedUnit</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(id, unitid, loc, face)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateNUnitsAtLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> count, <span class="jass-type">integer</span> unitId, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> face <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupClear</span>(<span class="jass-const">bj_lastCreatedGroup</span>)
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> count <span class="jass-op">=</span> count <span class="jass-op">-</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> count <span class="jass-op">&lt;</span> <span class="jass-number">0</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CreateUnitAtLocSaveLast</span>(whichPlayer, unitId, loc, face)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_lastCreatedGroup</span>, <span class="jass-const">bj_lastCreatedUnit</span>)
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedGroup</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateNUnitsAtLocFacingLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> count, <span class="jass-type">integer</span> unitId, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">location</span> lookAt <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">CreateNUnitsAtLoc</span>(count, unitId, whichPlayer, loc, <span class="jass-blizzard-j-function">AngleBetweenPoints</span>(loc, lookAt))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedGroupEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_groupLastCreatedDest</span>, <span class="jass-common-j-native">GetEnumUnit</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedGroup</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupLastCreatedDest</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(<span class="jass-const">bj_lastCreatedGroup</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedGroupEnum</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_groupLastCreatedDest</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateCorpseLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitid, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedUnit</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateCorpse</span>(whichPlayer, unitid, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-number">0</span>, <span class="jass-number">360</span>))
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitSuspendDecayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> suspend, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitSuspendDecay</span>(whichUnit, suspend)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayStopAnimEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> enumUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitState</span>(enumUnit, <span class="jass-const">UNIT_STATE_LIFE</span>) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitTimeScale</span>(enumUnit, <span class="jass-number">0.0001</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayBoneEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> enumUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitState</span>(enumUnit, <span class="jass-const">UNIT_STATE_LIFE</span>) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitSuspendDecay</span>(enumUnit, <span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitTimeScale</span>(enumUnit, <span class="jass-number">0.0001</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Game code explicitly sets the animation back to "decay bone" after the</span>
<span class="jass-comment">// initial corpse fades away, so we reset it now.  It's best not to show</span>
<span class="jass-comment">// off corpses thus created until after this grace period has passed.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayFleshEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> enumUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitState</span>(enumUnit, <span class="jass-const">UNIT_STATE_LIFE</span>) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitSuspendDecay</span>(enumUnit, <span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitTimeScale</span>(enumUnit, <span class="jass-number">10.0</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitAnimation</span>(enumUnit, <span class="jass-string">"decay flesh"</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Waits a short period of time to ensure that the corpse is decaying, and</span>
<span class="jass-comment">// then suspend the animation and corpse decay.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecay</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> boneGroup
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> fleshGroup

    <span class="jass-comment">// Switch the global unit groups over to local variables and recreate</span>
    <span class="jass-comment">// the global versions, so that this function can handle overlapping</span>
    <span class="jass-comment">// calls.</span>
    <span class="jass-keyword">set</span> boneGroup <span class="jass-op">=</span> <span class="jass-const">bj_suspendDecayBoneGroup</span>
    <span class="jass-keyword">set</span> fleshGroup <span class="jass-op">=</span> <span class="jass-const">bj_suspendDecayFleshGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_suspendDecayBoneGroup</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_suspendDecayFleshGroup</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(fleshGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayStopAnimEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(boneGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayStopAnimEnum</span>)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(<span class="jass-const">bj_CORPSE_MAX_DEATH_TIME</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(fleshGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayFleshEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(boneGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayBoneEnum</span>)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(<span class="jass-number">0.05</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(fleshGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayStopAnimEnum</span>)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(boneGroup)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(fleshGroup)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayCreate</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_delayedSuspendDecayTrig</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterTimerExpireEvent</span>(<span class="jass-const">bj_delayedSuspendDecayTrig</span>, <span class="jass-const">bj_delayedSuspendDecayTimer</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_delayedSuspendDecayTrig</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DelayedSuspendDecay</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreatePermanentCorpseLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> style, <span class="jass-type">integer</span> unitid, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> facing <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedUnit</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateCorpse</span>(whichPlayer, unitid, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), facing)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitBlendTime</span>(<span class="jass-const">bj_lastCreatedUnit</span>, <span class="jass-number">0</span>)

    <span class="jass-keyword">if</span> (style <span class="jass-op">==</span> <span class="jass-const">bj_CORPSETYPE_FLESH</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitAnimation</span>(<span class="jass-const">bj_lastCreatedUnit</span>, <span class="jass-string">"decay flesh"</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_suspendDecayFleshGroup</span>, <span class="jass-const">bj_lastCreatedUnit</span>)
    <span class="jass-keyword">elseif</span> (style <span class="jass-op">==</span> <span class="jass-const">bj_CORPSETYPE_BONE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitAnimation</span>(<span class="jass-const">bj_lastCreatedUnit</span>, <span class="jass-string">"decay bone"</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_suspendDecayBoneGroup</span>, <span class="jass-const">bj_lastCreatedUnit</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unknown decay style - treat as skeletal.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitAnimation</span>(<span class="jass-const">bj_lastCreatedUnit</span>, <span class="jass-string">"decay bone"</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_suspendDecayBoneGroup</span>, <span class="jass-const">bj_lastCreatedUnit</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_delayedSuspendDecayTimer</span>, <span class="jass-number">0.05</span>, <span class="jass-const">false</span>, <span class="jass-type">null</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitStateSwap</span> <span class="jass-keyword">takes</span> <span class="jass-type">unitstate</span> whichState, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitState</span>(whichUnit, whichState)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitStatePercent</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">unitstate</span> whichState, <span class="jass-type">unitstate</span> whichMaxState <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> value    <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitState</span>(whichUnit, whichState)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> maxValue <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitState</span>(whichUnit, whichMaxState)

    <span class="jass-comment">// Return 0 for null units.</span>
    <span class="jass-keyword">if</span> (whichUnit <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">or</span> (maxValue <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-number">0.0</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> value <span class="jass-op">/</span> maxValue <span class="jass-op">*</span> <span class="jass-number">100.0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitLifePercent</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">GetUnitStatePercent</span>(whichUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, <span class="jass-const">UNIT_STATE_MAX_LIFE</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitManaPercent</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">GetUnitStatePercent</span>(whichUnit, <span class="jass-const">UNIT_STATE_MANA</span>, <span class="jass-const">UNIT_STATE_MAX_MANA</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectUnitSingle</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearSelection</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>(whichUnit, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectGroupBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>( <span class="jass-common-j-native">GetEnumUnit</span>(), <span class="jass-const">true</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectGroupBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearSelection</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>( g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectGroupBJEnum</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectUnitAdd</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>(whichUnit, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectUnitRemove</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>(whichUnit, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ClearSelectionForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearSelection</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectUnitForPlayerSingle</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearSelection</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>(whichUnit, <span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectGroupForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearSelection</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>( g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectGroupBJEnum</span> )
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectUnitAddForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>(whichUnit, <span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SelectUnitRemoveForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SelectUnit</span>(whichUnit, <span class="jass-const">false</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitLifeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> newValue <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, <span class="jass-blizzard-j-function">RMaxBJ</span>(<span class="jass-number">0</span>,newValue))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitManaBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> newValue <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_MANA</span>, <span class="jass-blizzard-j-function">RMaxBJ</span>(<span class="jass-number">0</span>,newValue))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitLifePercentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> percent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, <span class="jass-common-j-native">GetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_MAX_LIFE</span>) <span class="jass-op">*</span> <span class="jass-blizzard-j-function">RMaxBJ</span>(<span class="jass-number">0</span>,percent) <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitManaPercentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> percent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_MANA</span>, <span class="jass-common-j-native">GetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>) <span class="jass-op">*</span> <span class="jass-blizzard-j-function">RMaxBJ</span>(<span class="jass-number">0</span>,percent) <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitDeadBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitState</span>(whichUnit, <span class="jass-const">UNIT_STATE_LIFE</span>) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitAliveBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">IsUnitDeadBJ</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupDeadBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">IsUnitDeadBJ</span>(<span class="jass-common-j-native">GetEnumUnit</span>()) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupDeadResult</span> <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns true if every unit of the group is dead.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupDeadBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupDeadResult</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupDeadBJEnum</span>)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_isUnitGroupDeadResult</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupEmptyBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupEmptyResult</span> <span class="jass-op">=</span> <span class="jass-const">false</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns true if the group contains no units.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupEmptyBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupEmptyResult</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupEmptyBJEnum</span>)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_isUnitGroupEmptyResult</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupInRectBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">RectContainsUnit</span>(<span class="jass-const">bj_isUnitGroupInRectRect</span>, <span class="jass-common-j-native">GetEnumUnit</span>()) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupInRectResult</span> <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns true if every unit of the group is within the given rect.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupInRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupInRectResult</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_isUnitGroupInRectRect</span> <span class="jass-op">=</span> r
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitGroupInRectBJEnum</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_isUnitGroupInRectResult</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitHiddenBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsUnitHidden</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowUnitHide</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowUnit</span>(whichUnit, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowUnitShow</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Prevent dead heroes from being unhidden.</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsUnitType</span>(whichUnit, <span class="jass-const">UNIT_TYPE_HERO</span>) <span class="jass-keyword">and</span> <span class="jass-blizzard-j-function">IsUnitDeadBJ</span>(whichUnit)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowUnit</span>(whichUnit, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueHauntOrderAtLocBJFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitTypeId</span>(<span class="jass-common-j-native">GetFilterUnit</span>()) <span class="jass-op">==</span> <span class="jass-number">'ngol'</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueHauntOrderAtLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichPeon, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> goldMine <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Search for a gold mine within a 1-cell radius of the specified location.</span>
    <span class="jass-keyword">set</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRangeOfLoc</span>(g, loc, <span class="jass-number">2</span><span class="jass-op">*</span><span class="jass-const">bj_CELLWIDTH</span>, filterIssueHauntOrderAtLocBJ)
    <span class="jass-keyword">set</span> goldMine <span class="jass-op">=</span> <span class="jass-common-j-native">FirstOfGroup</span>(g)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)

    <span class="jass-comment">// If no mine was found, abort the request.</span>
    <span class="jass-keyword">if</span> (goldMine <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Issue the Haunt Gold Mine order.</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueTargetOrderById</span>(whichPeon, <span class="jass-number">'ugol'</span>, goldMine)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueBuildOrderByIdLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichPeon, <span class="jass-type">integer</span> unitId, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (unitId <span class="jass-op">==</span> <span class="jass-number">'ugol'</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">IssueHauntOrderAtLocBJ</span>(whichPeon, loc)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueBuildOrderById</span>(whichPeon, unitId, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueTrainOrderByIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> unitId <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueImmediateOrderById</span>(whichUnit, unitId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupTrainOrderByIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g, <span class="jass-type">integer</span> unitId <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GroupImmediateOrderById</span>(g, unitId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueUpgradeOrderByIdBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> techId <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueImmediateOrderById</span>(whichUnit, techId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetAttackedUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTriggerUnit</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitFlyHeightBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> newHeight, <span class="jass-type">real</span> rate <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitFlyHeight</span>(whichUnit, newHeight, rate)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitTurnSpeedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> turnSpeed <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitTurnSpeed</span>(whichUnit, turnSpeed)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitPropWindowBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> propWindow <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> angle <span class="jass-op">=</span> propWindow
    <span class="jass-keyword">if</span> (angle <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> angle <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">elseif</span> (angle <span class="jass-op">&gt;=</span> <span class="jass-number">360</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> angle <span class="jass-op">=</span> <span class="jass-number">359</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">set</span> angle <span class="jass-op">=</span> angle <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitPropWindow</span>(whichUnit, angle)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitPropWindowBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitPropWindow</span>(whichUnit) <span class="jass-op">*</span> <span class="jass-const">bj_RADTODEG</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitDefaultPropWindowBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitDefaultPropWindow</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitBlendTimeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> blendTime <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitBlendTime</span>(whichUnit, blendTime)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitAcquireRangeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> acquireRange <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitAcquireRange</span>(whichUnit, acquireRange)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitSetCanSleepBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolean</span> canSleep <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitAddSleep</span>(whichUnit, canSleep)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitCanSleepBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitCanSleep</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitWakeUpBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitWakeUp</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitIsSleepingBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitIsSleeping</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WakePlayerUnitsEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitWakeUp</span>(<span class="jass-common-j-native">GetEnumUnit</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WakePlayerUnits</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(g, whichPlayer, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WakePlayerUnitsEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnableCreepSleepBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enable <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(<span class="jass-common-j-native">Player</span>(<span class="jass-const">PLAYER_NEUTRAL_AGGRESSIVE</span>), <span class="jass-const">PLAYER_STATE_NO_CREEP_SLEEP</span>, <span class="jass-blizzard-j-function">IntegerTertiaryOp</span>(enable, <span class="jass-number">0</span>, <span class="jass-number">1</span>))

    <span class="jass-comment">// If we're disabling, attempt to wake any already-sleeping creeps.</span>
    <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> enable) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">WakePlayerUnits</span>(<span class="jass-common-j-native">Player</span>(<span class="jass-const">PLAYER_NEUTRAL_AGGRESSIVE</span>))
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitGenerateAlarms</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolean</span> generate <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitIgnoreAlarm</span>(whichUnit, <span class="jass-keyword">not</span> generate)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DoesUnitGenerateAlarms</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-common-j-native">UnitIgnoreAlarmToggled</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseAllUnitsBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseUnit</span>( <span class="jass-common-j-native">GetEnumUnit</span>(), <span class="jass-const">bj_pauseAllUnitsFlag</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Pause all units</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseAllUnitsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> pause <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">group</span>   g

    <span class="jass-keyword">set</span> <span class="jass-const">bj_pauseAllUnitsFlag</span> <span class="jass-op">=</span> pause
    <span class="jass-keyword">set</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>( index )

        <span class="jass-comment">// If this is a computer slot, pause/resume the AI.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>( indexPlayer ) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_COMPUTER</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseCompAI</span>( indexPlayer, pause )
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// Enumerate and unpause every unit owned by the player.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>( g, indexPlayer, <span class="jass-type">null</span> )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>( g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseAllUnitsBJEnum</span> )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupClear</span>( g )

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> pause, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseUnit</span>(whichUnit, pause)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitPausedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsUnitPaused</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitPauseTimedLifeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitPauseTimedLife</span>(whichUnit, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitApplyTimedLifeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">integer</span> buffId, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitApplyTimedLife</span>(whichUnit, buffId, duration)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitShareVisionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> share, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitShareVision</span>(whichUnit, whichPlayer, share)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveBuffsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> buffType, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (buffType <span class="jass-op">==</span> <span class="jass-const">bj_REMOVEBUFFS_POSITIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveBuffs</span>(whichUnit, <span class="jass-const">true</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">elseif</span> (buffType <span class="jass-op">==</span> <span class="jass-const">bj_REMOVEBUFFS_NEGATIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveBuffs</span>(whichUnit, <span class="jass-const">false</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">elseif</span> (buffType <span class="jass-op">==</span> <span class="jass-const">bj_REMOVEBUFFS_ALL</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveBuffs</span>(whichUnit, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">elseif</span> (buffType <span class="jass-op">==</span> <span class="jass-const">bj_REMOVEBUFFS_NONTLIFE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveBuffsEx</span>(whichUnit, <span class="jass-const">true</span>, <span class="jass-const">true</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">true</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized dispel type - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveBuffsExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> polarity, <span class="jass-type">integer</span> resist, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolean</span> bTLife, <span class="jass-type">boolean</span> bAura <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bPos   <span class="jass-op">=</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_EITHER</span>) <span class="jass-keyword">or</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_POSITIVE</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bNeg   <span class="jass-op">=</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_EITHER</span>) <span class="jass-keyword">or</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_NEGATIVE</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bMagic <span class="jass-op">=</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_BOTH</span>) <span class="jass-keyword">or</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_MAGIC</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bPhys  <span class="jass-op">=</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_BOTH</span>) <span class="jass-keyword">or</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_PHYSICAL</span>)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveBuffsEx</span>(whichUnit, bPos, bNeg, bMagic, bPhys, bTLife, bAura, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitCountBuffsExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> polarity, <span class="jass-type">integer</span> resist, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolean</span> bTLife, <span class="jass-type">boolean</span> bAura <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bPos   <span class="jass-op">=</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_EITHER</span>) <span class="jass-keyword">or</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_POSITIVE</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bNeg   <span class="jass-op">=</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_EITHER</span>) <span class="jass-keyword">or</span> (polarity <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_POLARITY_NEGATIVE</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bMagic <span class="jass-op">=</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_BOTH</span>) <span class="jass-keyword">or</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_MAGIC</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> bPhys  <span class="jass-op">=</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_BOTH</span>) <span class="jass-keyword">or</span> (resist <span class="jass-op">==</span> <span class="jass-const">bj_BUFF_RESIST_PHYSICAL</span>)

    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitCountBuffsEx</span>(whichUnit, bPos, bNeg, bMagic, bPhys, bTLife, bAura, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveAbilityBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilityId, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitRemoveAbility</span>(whichUnit, abilityId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitAddAbilityBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilityId, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitAddAbility</span>(whichUnit, abilityId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitRemoveTypeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unittype</span> whichType, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitRemoveType</span>(whichUnit, whichType)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitAddTypeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unittype</span> whichType, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitAddType</span>(whichUnit, whichType)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitMakeAbilityPermanentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> permanent, <span class="jass-type">integer</span> abilityId, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitMakeAbilityPermanent</span>(whichUnit, permanent, abilityId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitExplodedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolean</span> exploded <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitExploded</span>(whichUnit, exploded)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ExplodeUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitExploded</span>(whichUnit, <span class="jass-const">true</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillUnit</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTransportUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTransportUnit</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLoadedUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLoadedUnit</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitInTransportBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">unit</span> whichTransport <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsUnitInTransport</span>(whichUnit, whichTransport)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitLoadedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsUnitLoaded</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsUnitIllusionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsUnitIllusion</span>(whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// This attempts to replace a unit with a new unit type by creating a new</span>
<span class="jass-comment">// unit of the desired type using the old unit's location, facing, etc.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ReplaceUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> newUnitId, <span class="jass-type">integer</span> unitStateMethod <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>    oldUnit <span class="jass-op">=</span> whichUnit
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>    newUnit
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wasHidden
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">item</span>    indexItem
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>    oldRatio

    <span class="jass-comment">// If we have bogus data, don't attempt the replace.</span>
    <span class="jass-keyword">if</span> (oldUnit <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_lastReplacedUnit</span> <span class="jass-op">=</span> oldUnit
        <span class="jass-keyword">return</span> oldUnit
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Hide the original unit.</span>
    <span class="jass-keyword">set</span> wasHidden <span class="jass-op">=</span> <span class="jass-common-j-native">IsUnitHidden</span>(oldUnit)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowUnit</span>(oldUnit, <span class="jass-const">false</span>)

    <span class="jass-comment">// Create the replacement unit.</span>
    <span class="jass-keyword">if</span> (newUnitId <span class="jass-op">==</span> <span class="jass-number">'ugol'</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> newUnit <span class="jass-op">=</span> <span class="jass-common-j-native">CreateBlightedGoldmine</span>(<span class="jass-common-j-native">GetOwningPlayer</span>(oldUnit), <span class="jass-common-j-native">GetUnitX</span>(oldUnit), <span class="jass-common-j-native">GetUnitY</span>(oldUnit), <span class="jass-common-j-native">GetUnitFacing</span>(oldUnit))
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> newUnit <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnit</span>(<span class="jass-common-j-native">GetOwningPlayer</span>(oldUnit), newUnitId, <span class="jass-common-j-native">GetUnitX</span>(oldUnit), <span class="jass-common-j-native">GetUnitY</span>(oldUnit), <span class="jass-common-j-native">GetUnitFacing</span>(oldUnit))
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Set the unit's life and mana according to the requested method.</span>
    <span class="jass-keyword">if</span> (unitStateMethod <span class="jass-op">==</span> <span class="jass-const">bj_UNIT_STATE_METHOD_RELATIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Set the replacement's current/max life ratio to that of the old unit.</span>
        <span class="jass-comment">// If both units have mana, do the same for mana.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_MAX_LIFE</span>) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> oldRatio <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_LIFE</span>) <span class="jass-op">/</span> <span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_MAX_LIFE</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, oldRatio <span class="jass-op">*</span> <span class="jass-common-j-native">GetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MAX_LIFE</span>))
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">and</span> (<span class="jass-common-j-native">GetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> oldRatio <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_MANA</span>) <span class="jass-op">/</span> <span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MANA</span>, oldRatio <span class="jass-op">*</span> <span class="jass-common-j-native">GetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>))
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">elseif</span> (unitStateMethod <span class="jass-op">==</span> <span class="jass-const">bj_UNIT_STATE_METHOD_ABSOLUTE</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Set the replacement's current life to that of the old unit.</span>
        <span class="jass-comment">// If the new unit has mana, do the same for mana.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, <span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_LIFE</span>))
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MANA</span>, <span class="jass-common-j-native">GetUnitState</span>(oldUnit, <span class="jass-const">UNIT_STATE_MANA</span>))
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">elseif</span> (unitStateMethod <span class="jass-op">==</span> <span class="jass-const">bj_UNIT_STATE_METHOD_DEFAULTS</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// The newly created unit should already have default life and mana.</span>
    <span class="jass-keyword">elseif</span> (unitStateMethod <span class="jass-op">==</span> <span class="jass-const">bj_UNIT_STATE_METHOD_MAXIMUM</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use max life and mana.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_LIFE</span>, <span class="jass-common-j-native">GetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MAX_LIFE</span>))
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MANA</span>, <span class="jass-common-j-native">GetUnitState</span>(newUnit, <span class="jass-const">UNIT_STATE_MAX_MANA</span>))
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized unit state method - ignore the request.</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Mirror properties of the old unit onto the new unit.</span>
    <span class="jass-comment">//call PauseUnit(newUnit, IsUnitPaused(oldUnit))</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetResourceAmount</span>(newUnit, <span class="jass-common-j-native">GetResourceAmount</span>(oldUnit))

    <span class="jass-comment">// If both the old and new units are heroes, handle their hero info.</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsUnitType</span>(oldUnit, <span class="jass-const">UNIT_TYPE_HERO</span>) <span class="jass-keyword">and</span> <span class="jass-common-j-native">IsUnitType</span>(newUnit, <span class="jass-const">UNIT_TYPE_HERO</span>)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetHeroXP</span>(newUnit, <span class="jass-common-j-native">GetHeroXP</span>(oldUnit), <span class="jass-const">false</span>)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">set</span> indexItem <span class="jass-op">=</span> <span class="jass-common-j-native">UnitItemInSlot</span>(oldUnit, index)
            <span class="jass-keyword">if</span> (indexItem <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitRemoveItem</span>(oldUnit, indexItem)
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitAddItem</span>(newUnit, indexItem)
            <span class="jass-keyword">endif</span>

            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_MAX_INVENTORY</span>
        <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Remove or kill the original unit.  It is sometimes unsafe to remove</span>
    <span class="jass-comment">// hidden units, so kill the original unit if it was previously hidden.</span>
    <span class="jass-keyword">if</span> wasHidden <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillUnit</span>(oldUnit)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveUnit</span>(oldUnit)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveUnit</span>(oldUnit)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastReplacedUnit</span> <span class="jass-op">=</span> newUnit
    <span class="jass-keyword">return</span> newUnit
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastReplacedUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastReplacedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitPositionLocFacingBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> facing <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitPositionLoc</span>(whichUnit, loc)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitFacing</span>(whichUnit, facing)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitPositionLocFacingLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">location</span> loc, <span class="jass-type">location</span> lookAt <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitPositionLoc</span>(whichUnit, loc)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitFacing</span>(whichUnit, <span class="jass-blizzard-j-function">AngleBetweenPoints</span>(loc, lookAt))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddItemToStockBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> itemId, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> currentStock, <span class="jass-type">integer</span> stockMax <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddItemToStock</span>(whichUnit, itemId, currentStock, stockMax)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddUnitToStockBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">integer</span> currentStock, <span class="jass-type">integer</span> stockMax <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddUnitToStock</span>(whichUnit, unitId, currentStock, stockMax)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemoveItemFromStockBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> itemId, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveItemFromStock</span>(whichUnit, itemId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemoveUnitFromStockBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveUnitFromStock</span>(whichUnit, unitId)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitUseFoodBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enable, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitUseFood</span>(whichUnit, enable)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDamagePointLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> delay, <span class="jass-type">real</span> radius, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> amount, <span class="jass-type">attacktype</span> whichAttack, <span class="jass-type">damagetype</span> whichDamage <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitDamagePoint</span>(whichUnit, delay, radius, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), amount, <span class="jass-const">true</span>, <span class="jass-const">false</span>, whichAttack, whichDamage, <span class="jass-const">WEAPON_TYPE_WHOKNOWS</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDamageTargetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">unit</span> target, <span class="jass-type">real</span> amount, <span class="jass-type">attacktype</span> whichAttack, <span class="jass-type">damagetype</span> whichDamage <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">UnitDamageTarget</span>(whichUnit, target, amount, <span class="jass-const">true</span>, <span class="jass-const">false</span>, whichAttack, whichDamage, <span class="jass-const">WEAPON_TYPE_WHOKNOWS</span>)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Destructable Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateDestructableLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> objectid, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> facing, <span class="jass-type">real</span> scale, <span class="jass-type">integer</span> variation <span class="jass-keyword">returns</span> <span class="jass-type">destructable</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedDestructable</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateDestructable</span>(objectid, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), facing, scale, variation)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedDestructable</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateDeadDestructableLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> objectid, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> facing, <span class="jass-type">real</span> scale, <span class="jass-type">integer</span> variation <span class="jass-keyword">returns</span> <span class="jass-type">destructable</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedDestructable</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateDeadDestructable</span>(objectid, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), facing, scale, variation)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedDestructable</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedDestructable</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">destructable</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedDestructable</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowDestructableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowDestructable</span>(d, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDestructableInvulnerableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableInvulnerable</span>(d, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsDestructableInvulnerableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsDestructableInvulnerable</span>(d)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetDestructableLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> whichDestructable <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(<span class="jass-common-j-native">GetDestructableX</span>(whichDestructable), <span class="jass-common-j-native">GetDestructableY</span>(whichDestructable))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnumDestructablesInRectAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">code</span> actionFunc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumDestructablesInRect</span>(r, <span class="jass-type">null</span>, actionFunc)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnumDestructablesInCircleBJFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> destLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetDestructableLoc</span>(<span class="jass-common-j-native">GetFilterDestructable</span>())
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> result

    <span class="jass-keyword">set</span> result <span class="jass-op">=</span> <span class="jass-blizzard-j-function">DistanceBetweenPoints</span>(destLoc, <span class="jass-const">bj_enumDestructableCenter</span>) <span class="jass-op">&lt;=</span> <span class="jass-const">bj_enumDestructableRadius</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveLocation</span>(destLoc)
    <span class="jass-keyword">return</span> result
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsDestructableDeadBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetDestructableLife</span>(d) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsDestructableAliveBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">IsDestructableDeadBJ</span>(d)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// See GroupPickRandomUnitEnum for the details of this algorithm.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDestructableInRectBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_destRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-const">bj_destRandomConsidered</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-const">bj_destRandomConsidered</span>) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_destRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumDestructable</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Picks a random destructable from within a rect, matching a condition</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDestructableInRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">boolexpr</span> filter <span class="jass-keyword">returns</span> <span class="jass-type">destructable</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_destRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_destRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumDestructablesInRect</span>(r, filter, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDestructableInRectBJEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(filter)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_destRandomCurrentPick</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Picks a random destructable from within a rect</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDestructableInRectSimpleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">destructable</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">RandomDestructableInRectBJ</span>(r, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Enumerates within a rect, with a filter to narrow the enumeration down</span>
<span class="jass-comment">// objects within a circular area.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnumDestructablesInCircleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> radius, <span class="jass-type">location</span> loc, <span class="jass-type">code</span> actionFunc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">rect</span> r

    <span class="jass-keyword">if</span> (radius <span class="jass-op">&gt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_enumDestructableCenter</span> <span class="jass-op">=</span> loc
        <span class="jass-keyword">set</span> <span class="jass-const">bj_enumDestructableRadius</span> <span class="jass-op">=</span> radius
        <span class="jass-keyword">set</span> r <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetRectFromCircleBJ</span>(loc, radius)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumDestructablesInRect</span>(r, filterEnumDestructablesInCircleBJ, actionFunc)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveRect</span>(r)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDestructableLifePercentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">real</span> percent <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableLife</span>(d, <span class="jass-common-j-native">GetDestructableMaxLife</span>(d) <span class="jass-op">*</span> percent <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDestructableMaxLifeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">real</span> max <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableMaxLife</span>(d, max)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ModifyGateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> gateOperation, <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (gateOperation <span class="jass-op">==</span> <span class="jass-const">bj_GATEOPERATION_CLOSE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetDestructableLife</span>(d) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestructableRestoreLife</span>(d, <span class="jass-common-j-native">GetDestructableMaxLife</span>(d), <span class="jass-const">true</span>)
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"stand"</span>)
    <span class="jass-keyword">elseif</span> (gateOperation <span class="jass-op">==</span> <span class="jass-const">bj_GATEOPERATION_OPEN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetDestructableLife</span>(d) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillDestructable</span>(d)
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"death alternate"</span>)
    <span class="jass-keyword">elseif</span> (gateOperation <span class="jass-op">==</span> <span class="jass-const">bj_GATEOPERATION_DESTROY</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetDestructableLife</span>(d) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillDestructable</span>(d)
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"death"</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized gate state - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Determine the elevator's height from its occlusion height.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetElevatorHeight</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> height

    <span class="jass-keyword">set</span> height <span class="jass-op">=</span> <span class="jass-number">1</span> <span class="jass-op">+</span> <span class="jass-common-j-native">R2I</span>(<span class="jass-common-j-native">GetDestructableOccluderHeight</span>(d) <span class="jass-op">/</span> <span class="jass-const">bj_CLIFFHEIGHT</span>)
    <span class="jass-keyword">if</span> (height <span class="jass-op">&lt;</span> <span class="jass-number">1</span>) <span class="jass-keyword">or</span> (height <span class="jass-op">&gt;</span> <span class="jass-number">3</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> height <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> height
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// To properly animate an elevator, we must know not only what height we</span>
<span class="jass-comment">// want to change to, but also what height we are currently at.  This code</span>
<span class="jass-comment">// determines the elevator's current height from its occlusion height.</span>
<span class="jass-comment">// Arbitrarily changing an elevator's occlusion height is thus inadvisable.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChangeElevatorHeight</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">integer</span> newHeight <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> oldHeight

    <span class="jass-comment">// Cap the new height within the supported range.</span>
    <span class="jass-keyword">set</span> newHeight <span class="jass-op">=</span> <span class="jass-blizzard-j-function">IMaxBJ</span>(<span class="jass-number">1</span>, newHeight)
    <span class="jass-keyword">set</span> newHeight <span class="jass-op">=</span> <span class="jass-blizzard-j-function">IMinBJ</span>(<span class="jass-number">3</span>, newHeight)

    <span class="jass-comment">// Find out what height the elevator is already at.</span>
    <span class="jass-keyword">set</span> oldHeight <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetElevatorHeight</span>(d)

    <span class="jass-comment">// Set the elevator's occlusion height.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableOccluderHeight</span>(d, <span class="jass-const">bj_CLIFFHEIGHT</span><span class="jass-op">*</span>(newHeight<span class="jass-op">-</span><span class="jass-number">1</span>))

    <span class="jass-keyword">if</span> (newHeight <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (oldHeight <span class="jass-op">==</span> <span class="jass-number">2</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"birth"</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, <span class="jass-string">"stand"</span>)
        <span class="jass-keyword">elseif</span> (oldHeight <span class="jass-op">==</span> <span class="jass-number">3</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"birth third"</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, <span class="jass-string">"stand"</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized old height - snap to new height.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"stand"</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">elseif</span> (newHeight <span class="jass-op">==</span> <span class="jass-number">2</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (oldHeight <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"death"</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, <span class="jass-string">"stand second"</span>)
        <span class="jass-keyword">elseif</span> (oldHeight <span class="jass-op">==</span> <span class="jass-number">3</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"birth second"</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, <span class="jass-string">"stand second"</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized old height - snap to new height.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"stand second"</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">elseif</span> (newHeight <span class="jass-op">==</span> <span class="jass-number">3</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (oldHeight <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"death third"</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, <span class="jass-string">"stand third"</span>)
        <span class="jass-keyword">elseif</span> (oldHeight <span class="jass-op">==</span> <span class="jass-number">2</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"death second"</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, <span class="jass-string">"stand third"</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized old height - snap to new height.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, <span class="jass-string">"stand third"</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized new height - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Grab the unit and throw his own coords in his face, forcing him to push</span>
<span class="jass-comment">// and shove until he finds a spot where noone will bother him.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NudgeUnitsInRectEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> nudgee <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitPosition</span>(nudgee, <span class="jass-common-j-native">GetUnitX</span>(nudgee), <span class="jass-common-j-native">GetUnitY</span>(nudgee))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NudgeItemsInRectEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">item</span> nudgee <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumItem</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemPosition</span>(nudgee, <span class="jass-common-j-native">GetItemX</span>(nudgee), <span class="jass-common-j-native">GetItemY</span>(nudgee))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Nudge the items and units within a given rect ever so gently, so as to</span>
<span class="jass-comment">// encourage them to find locations where they can peacefully coexist with</span>
<span class="jass-comment">// pathing restrictions and live happy, fruitful lives.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NudgeObjectsInRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> nudgeArea <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span>        g

    <span class="jass-keyword">set</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRect</span>(g, nudgeArea, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NudgeUnitsInRectEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumItemsInRect</span>(nudgeArea, <span class="jass-type">null</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NudgeItemsInRectEnum</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NearbyElevatorExistsEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">destructable</span> d     <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumDestructable</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>      dType <span class="jass-op">=</span> <span class="jass-common-j-native">GetDestructableTypeId</span>(d)

    <span class="jass-keyword">if</span> (dType <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_CODE01</span>) <span class="jass-keyword">or</span> (dType <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_CODE02</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_elevatorNeighbor</span> <span class="jass-op">=</span> d
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NearbyElevatorExists</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> x, <span class="jass-type">real</span> y <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> findThreshold <span class="jass-op">=</span> <span class="jass-number">32</span>
    <span class="jass-keyword">local</span> <span class="jass-type">rect</span> r

    <span class="jass-comment">// If another elevator is overlapping this one, ignore the wall.</span>
    <span class="jass-keyword">set</span> r <span class="jass-op">=</span> <span class="jass-common-j-native">Rect</span>(x <span class="jass-op">-</span> findThreshold, y <span class="jass-op">-</span> findThreshold, x <span class="jass-op">+</span> findThreshold, y <span class="jass-op">+</span> findThreshold)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_elevatorNeighbor</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumDestructablesInRect</span>(r, <span class="jass-type">null</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">NearbyElevatorExistsEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveRect</span>(r)

    <span class="jass-keyword">return</span> <span class="jass-const">bj_elevatorNeighbor</span> <span class="jass-op">!=</span> <span class="jass-type">null</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FindElevatorWallBlockerEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_elevatorWallBlocker</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumDestructable</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// This toggles pathing on or off for one wall of an elevator by killing</span>
<span class="jass-comment">// or reviving a pathing blocker at the appropriate location (and creating</span>
<span class="jass-comment">// the pathing blocker in the first place, if it does not yet exist).</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChangeElevatorWallBlocker</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">real</span> facing, <span class="jass-type">boolean</span> open <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">destructable</span> blocker <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>         findThreshold <span class="jass-op">=</span> <span class="jass-number">32</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>         nudgeLength   <span class="jass-op">=</span> <span class="jass-number">4.25</span> <span class="jass-op">*</span> <span class="jass-const">bj_CELLWIDTH</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>         nudgeWidth    <span class="jass-op">=</span> <span class="jass-number">1.25</span> <span class="jass-op">*</span> <span class="jass-const">bj_CELLWIDTH</span>
    <span class="jass-keyword">local</span> <span class="jass-type">rect</span>         r

    <span class="jass-comment">// Search for the pathing blocker within the general area.</span>
    <span class="jass-keyword">set</span> r <span class="jass-op">=</span> <span class="jass-common-j-native">Rect</span>(x <span class="jass-op">-</span> findThreshold, y <span class="jass-op">-</span> findThreshold, x <span class="jass-op">+</span> findThreshold, y <span class="jass-op">+</span> findThreshold)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_elevatorWallBlocker</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnumDestructablesInRect</span>(r, <span class="jass-type">null</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FindElevatorWallBlockerEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveRect</span>(r)
    <span class="jass-keyword">set</span> blocker <span class="jass-op">=</span> <span class="jass-const">bj_elevatorWallBlocker</span>

    <span class="jass-comment">// Ensure that the blocker exists.</span>
    <span class="jass-keyword">if</span> (blocker <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> blocker <span class="jass-op">=</span> <span class="jass-common-j-native">CreateDeadDestructable</span>(<span class="jass-const">bj_ELEVATOR_BLOCKER_CODE</span>, x, y, facing, <span class="jass-number">1</span>, <span class="jass-number">0</span>)
    <span class="jass-keyword">elseif</span> (<span class="jass-common-j-native">GetDestructableTypeId</span>(blocker) <span class="jass-op">!=</span> <span class="jass-const">bj_ELEVATOR_BLOCKER_CODE</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If a different destructible exists in the blocker's spot, ignore</span>
        <span class="jass-comment">// the request.  (Two destructibles cannot occupy the same location</span>
        <span class="jass-comment">// on the map, so we cannot create an elevator blocker here.)</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (open) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Ensure that the blocker is dead.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetDestructableLife</span>(blocker) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">KillDestructable</span>(blocker)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Ensure that the blocker is alive.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetDestructableLife</span>(blocker) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestructableRestoreLife</span>(blocker, <span class="jass-common-j-native">GetDestructableMaxLife</span>(blocker), <span class="jass-const">false</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// Nudge any objects standing in the blocker's way.</span>
        <span class="jass-keyword">if</span> (facing <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> r <span class="jass-op">=</span> <span class="jass-common-j-native">Rect</span>(x <span class="jass-op">-</span> nudgeWidth<span class="jass-op">/</span><span class="jass-number">2</span>, y <span class="jass-op">-</span> nudgeLength<span class="jass-op">/</span><span class="jass-number">2</span>, x <span class="jass-op">+</span> nudgeWidth<span class="jass-op">/</span><span class="jass-number">2</span>, y <span class="jass-op">+</span> nudgeLength<span class="jass-op">/</span><span class="jass-number">2</span>)
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">NudgeObjectsInRect</span>(r)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveRect</span>(r)
        <span class="jass-keyword">elseif</span> (facing <span class="jass-op">==</span> <span class="jass-number">90</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> r <span class="jass-op">=</span> <span class="jass-common-j-native">Rect</span>(x <span class="jass-op">-</span> nudgeLength<span class="jass-op">/</span><span class="jass-number">2</span>, y <span class="jass-op">-</span> nudgeWidth<span class="jass-op">/</span><span class="jass-number">2</span>, x <span class="jass-op">+</span> nudgeLength<span class="jass-op">/</span><span class="jass-number">2</span>, y <span class="jass-op">+</span> nudgeWidth<span class="jass-op">/</span><span class="jass-number">2</span>)
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">NudgeObjectsInRect</span>(r)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveRect</span>(r)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized blocker angle - don't nudge anything.</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ChangeElevatorWalls</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> open, <span class="jass-type">integer</span> walls, <span class="jass-type">destructable</span> d <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> x <span class="jass-op">=</span> <span class="jass-common-j-native">GetDestructableX</span>(d)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> y <span class="jass-op">=</span> <span class="jass-common-j-native">GetDestructableY</span>(d)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> distToBlocker <span class="jass-op">=</span> <span class="jass-number">192</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> distToNeighbor <span class="jass-op">=</span> <span class="jass-number">256</span>

    <span class="jass-keyword">if</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_ALL</span>) <span class="jass-keyword">or</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_EAST</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">NearbyElevatorExists</span>(x <span class="jass-op">+</span> distToNeighbor, y)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ChangeElevatorWallBlocker</span>(x <span class="jass-op">+</span> distToBlocker, y, <span class="jass-number">0</span>, open)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_ALL</span>) <span class="jass-keyword">or</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_NORTH</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">NearbyElevatorExists</span>(x, y <span class="jass-op">+</span> distToNeighbor)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ChangeElevatorWallBlocker</span>(x, y <span class="jass-op">+</span> distToBlocker, <span class="jass-number">90</span>, open)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_ALL</span>) <span class="jass-keyword">or</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_SOUTH</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">NearbyElevatorExists</span>(x, y <span class="jass-op">-</span> distToNeighbor)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ChangeElevatorWallBlocker</span>(x, y <span class="jass-op">-</span> distToBlocker, <span class="jass-number">90</span>, open)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_ALL</span>) <span class="jass-keyword">or</span> (walls <span class="jass-op">==</span> <span class="jass-const">bj_ELEVATOR_WALL_TYPE_WEST</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">NearbyElevatorExists</span>(x <span class="jass-op">-</span> distToNeighbor, y)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ChangeElevatorWallBlocker</span>(x <span class="jass-op">-</span> distToBlocker, y, <span class="jass-number">0</span>, open)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Neutral Building Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WaygateActivateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> activate, <span class="jass-type">unit</span> waygate <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">WaygateActivate</span>(waygate, activate)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WaygateIsActiveBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> waygate <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">WaygateIsActive</span>(waygate)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WaygateSetDestinationLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> waygate, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">WaygateSetDestination</span>(waygate, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WaygateGetDestinationLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> waygate <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(<span class="jass-common-j-native">WaygateGetDestinationX</span>(waygate), <span class="jass-common-j-native">WaygateGetDestinationY</span>(waygate))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitSetUsesAltIconBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitSetUsesAltIcon</span>(whichUnit, flag)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  UI Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForceUIKeyBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">string</span> key <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceUIKey</span>(key)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForceUICancelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceUICancel</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Group and Force Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForGroupBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup, <span class="jass-type">code</span> callback <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(whichGroup, callback)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(whichGroup)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupAddUnitSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">group</span> whichGroup <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(whichGroup, whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupRemoveUnitSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">group</span> whichGroup <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupRemoveUnit</span>(whichGroup, whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupAddGroupEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_groupAddGroupDest</span>, <span class="jass-common-j-native">GetEnumUnit</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupAddGroup</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> sourceGroup, <span class="jass-type">group</span> destGroup <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupAddGroupDest</span> <span class="jass-op">=</span> destGroup
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(sourceGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupAddGroupEnum</span>)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(sourceGroup)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupRemoveGroupEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupRemoveUnit</span>(<span class="jass-const">bj_groupRemoveGroupDest</span>, <span class="jass-common-j-native">GetEnumUnit</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupRemoveGroup</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> sourceGroup, <span class="jass-type">group</span> destGroup <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupRemoveGroupDest</span> <span class="jass-op">=</span> destGroup
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(sourceGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupRemoveGroupEnum</span>)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(sourceGroup)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForceAddPlayerSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(whichForce, whichPlayer)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForceRemovePlayerSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceRemovePlayer</span>(whichForce, whichPlayer)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Consider each unit, one at a time, keeping a "current pick".   Once all units</span>
<span class="jass-comment">// are considered, this "current pick" will be the resulting random unit.</span>
<span class="jass-comment">//</span>
<span class="jass-comment">// The chance of picking a given unit over the "current pick" is 1/N, where N is</span>
<span class="jass-comment">// the number of units considered thusfar (including the current consideration).</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupPickRandomUnitEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-const">bj_groupRandomConsidered</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-const">bj_groupRandomConsidered</span>) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_groupRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Picks a random unit from a group.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupPickRandomUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(whichGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupPickRandomUnitEnum</span>)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(whichGroup)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_groupRandomCurrentPick</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// See GroupPickRandomUnitEnum for the details of this algorithm.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForcePickRandomPlayerEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forceRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-const">bj_forceRandomConsidered</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-const">bj_forceRandomConsidered</span>) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_forceRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumPlayer</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Picks a random player from a force.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForcePickRandomPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">player</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forceRandomConsidered</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forceRandomCurrentPick</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(whichForce, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForcePickRandomPlayerEnum</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_forceRandomCurrentPick</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnumUnitsSelected</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolexpr</span> enumFilter, <span class="jass-type">code</span> enumAction <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SyncSelections</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsSelected</span>(g, whichPlayer, enumFilter)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(enumFilter)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, enumAction)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRectMatching</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">boolexpr</span> filter <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRect</span>(g, r, filter)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(filter)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRectAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">GetUnitsInRectMatching</span>(r, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRectOfPlayerFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetOwningPlayer</span>(<span class="jass-common-j-native">GetFilterUnit</span>()) <span class="jass-op">==</span> <span class="jass-const">bj_groupEnumOwningPlayer</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRectOfPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupEnumOwningPlayer</span> <span class="jass-op">=</span> whichPlayer
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRect</span>(g, r, filterGetUnitsInRectOfPlayer)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRangeOfLocMatching</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> radius, <span class="jass-type">location</span> whichLocation, <span class="jass-type">boolexpr</span> filter <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRangeOfLoc</span>(g, whichLocation, radius, filter)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(filter)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRangeOfLocAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> radius, <span class="jass-type">location</span> whichLocation <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">GetUnitsInRangeOfLocMatching</span>(radius, whichLocation, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfTypeIdAllFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitTypeId</span>(<span class="jass-common-j-native">GetFilterUnit</span>()) <span class="jass-op">==</span> <span class="jass-const">bj_groupEnumTypeId</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfTypeIdAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitid <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span>   result <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">group</span>   g      <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_groupEnumTypeId</span> <span class="jass-op">=</span> unitid
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupClear</span>(g)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(g, <span class="jass-common-j-native">Player</span>(index), filterGetUnitsOfTypeIdAll)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">GroupAddGroup</span>(g, result)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)

    <span class="jass-keyword">return</span> result
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfPlayerMatching</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolexpr</span> filter <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(g, whichPlayer, filter)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(filter)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfPlayerAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">GetUnitsOfPlayerMatching</span>(whichPlayer, <span class="jass-type">null</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfPlayerAndTypeIdFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetUnitTypeId</span>(<span class="jass-common-j-native">GetFilterUnit</span>()) <span class="jass-op">==</span> <span class="jass-const">bj_groupEnumTypeId</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfPlayerAndTypeId</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">integer</span> unitid <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupEnumTypeId</span> <span class="jass-op">=</span> unitid
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(g, whichPlayer, filterGetUnitsOfPlayerAndTypeId)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsSelectedAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SyncSelections</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsSelected</span>(g, whichPlayer, <span class="jass-type">null</span>)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetForceOfPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">local</span> <span class="jass-type">force</span> f <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(f, whichPlayer)
    <span class="jass-keyword">return</span> f
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayersAll</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_FORCE_ALL_PLAYERS</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayersByMapControl</span> <span class="jass-keyword">takes</span> <span class="jass-type">mapcontrol</span> whichControl <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">local</span> <span class="jass-type">force</span> f <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetPlayerController</span>(indexPlayer) <span class="jass-op">==</span> whichControl <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(f, indexPlayer)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> f
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayersAllies</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">local</span> <span class="jass-type">force</span> f <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceEnumAllies</span>(f, whichPlayer, <span class="jass-type">null</span>)
    <span class="jass-keyword">return</span> f
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayersEnemies</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">local</span> <span class="jass-type">force</span> f <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceEnumEnemies</span>(f, whichPlayer, <span class="jass-type">null</span>)
    <span class="jass-keyword">return</span> f
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayersMatching</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolexpr</span> filter <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">local</span> <span class="jass-type">force</span> f <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceEnumPlayers</span>(f, filter)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyBoolExpr</span>(filter)
    <span class="jass-keyword">return</span> f
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountUnitsInGroupEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupCountUnits</span> <span class="jass-op">=</span> <span class="jass-const">bj_groupCountUnits</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountUnitsInGroup</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> g <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-comment">// If the user wants the group destroyed, remember that fact and clear</span>
    <span class="jass-comment">// the flag, in case it is used again in the callback.</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> wantDestroy <span class="jass-op">=</span> <span class="jass-const">bj_wantDestroyGroup</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_wantDestroyGroup</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_groupCountUnits</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountUnitsInGroupEnum</span>)

    <span class="jass-comment">// If the user wants the group destroyed, do so now.</span>
    <span class="jass-keyword">if</span> (wantDestroy) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_groupCountUnits</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountPlayersInForceEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forceCountPlayers</span> <span class="jass-op">=</span> <span class="jass-const">bj_forceCountPlayers</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountPlayersInForceBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> f <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_forceCountPlayers</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(f, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountPlayersInForceEnum</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_forceCountPlayers</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRandomSubGroupEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_randomSubGroupWant</span> <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_randomSubGroupWant</span> <span class="jass-op">&gt;=</span> <span class="jass-const">bj_randomSubGroupTotal</span>) <span class="jass-keyword">or</span> (<span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-number">0</span>,<span class="jass-number">1</span>) <span class="jass-op">&lt;</span> <span class="jass-const">bj_randomSubGroupChance</span>) <span class="jass-keyword">then</span>
            <span class="jass-comment">// We either need every remaining unit, or the unit passed its chance check.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupAddUnit</span>(<span class="jass-const">bj_randomSubGroupGroup</span>, <span class="jass-common-j-native">GetEnumUnit</span>())
            <span class="jass-keyword">set</span> <span class="jass-const">bj_randomSubGroupWant</span> <span class="jass-op">=</span> <span class="jass-const">bj_randomSubGroupWant</span> <span class="jass-op">-</span> <span class="jass-number">1</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randomSubGroupTotal</span> <span class="jass-op">=</span> <span class="jass-const">bj_randomSubGroupTotal</span> <span class="jass-op">-</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRandomSubGroup</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> count, <span class="jass-type">group</span> sourceGroup <span class="jass-keyword">returns</span> <span class="jass-type">group</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()

    <span class="jass-keyword">set</span> <span class="jass-const">bj_randomSubGroupGroup</span> <span class="jass-op">=</span> g
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randomSubGroupWant</span>  <span class="jass-op">=</span> count
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randomSubGroupTotal</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">CountUnitsInGroup</span>(sourceGroup)

    <span class="jass-keyword">if</span> (<span class="jass-const">bj_randomSubGroupWant</span> <span class="jass-op">&lt;=</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> <span class="jass-const">bj_randomSubGroupTotal</span> <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> g
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_randomSubGroupChance</span> <span class="jass-op">=</span> <span class="jass-common-j-native">I2R</span>(<span class="jass-const">bj_randomSubGroupWant</span>) <span class="jass-op">/</span> <span class="jass-common-j-native">I2R</span>(<span class="jass-const">bj_randomSubGroupTotal</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(sourceGroup, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRandomSubGroupEnum</span>)
    <span class="jass-keyword">return</span> g
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LivingPlayerUnitsOfTypeIdFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> filterUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetFilterUnit</span>()
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">IsUnitAliveBJ</span>(filterUnit) <span class="jass-keyword">and</span> <span class="jass-common-j-native">GetUnitTypeId</span>(filterUnit) <span class="jass-op">==</span> <span class="jass-const">bj_livingPlayerUnitsTypeId</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CountLivingPlayerUnitsOfTypeId</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> matchedCount

    <span class="jass-keyword">set</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_livingPlayerUnitsTypeId</span> <span class="jass-op">=</span> unitId
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(g, whichPlayer, filterLivingPlayerUnitsOfTypeId)
    <span class="jass-keyword">set</span> matchedCount <span class="jass-op">=</span> <span class="jass-blizzard-j-function">CountUnitsInGroup</span>(g)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)

    <span class="jass-keyword">return</span> matchedCount
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Animation Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ResetUnitAnimation</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitAnimation</span>(whichUnit, <span class="jass-string">"stand"</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitTimeScalePercent</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> percentScale <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitTimeScale</span>(whichUnit, percentScale <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitScalePercent</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> percentScaleX, <span class="jass-type">real</span> percentScaleY, <span class="jass-type">real</span> percentScaleZ <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitScale</span>(whichUnit, percentScaleX <span class="jass-op">*</span> <span class="jass-number">0.01</span>, percentScaleY <span class="jass-op">*</span> <span class="jass-number">0.01</span>, percentScaleZ <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// This version differs from the common.j interface in that the alpha value</span>
<span class="jass-comment">// is reversed so as to be displayed as transparency, and all four parameters</span>
<span class="jass-comment">// are treated as percentages rather than bytes.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitVertexColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitVertexColor</span>(whichUnit, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitAddIndicatorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddIndicator</span>(whichUnit, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestructableAddIndicatorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> whichDestructable, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddIndicator</span>(whichDestructable, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ItemAddIndicatorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddIndicator</span>(whichItem, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Sets a unit's facing to point directly at a location.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitFacingToFaceLocTimed</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">location</span> target, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> unitLoc <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitLoc</span>(whichUnit)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitFacingTimed</span>(whichUnit, <span class="jass-blizzard-j-function">AngleBetweenPoints</span>(unitLoc, target), duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveLocation</span>(unitLoc)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Sets a unit's facing to point directly at another unit.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitFacingToFaceUnitTimed</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">unit</span> target, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> unitLoc <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitLoc</span>(target)

    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetUnitFacingToFaceLocTimed</span>(whichUnit, unitLoc, duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveLocation</span>(unitLoc)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueueUnitAnimationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> whichAnimation <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueUnitAnimation</span>(whichUnit, whichAnimation)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDestructableAnimationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">string</span> whichAnimation <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimation</span>(d, whichAnimation)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueueDestructableAnimationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">string</span> whichAnimation <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QueueDestructableAnimation</span>(d, whichAnimation)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDestAnimationSpeedPercent</span> <span class="jass-keyword">takes</span> <span class="jass-type">destructable</span> d, <span class="jass-type">real</span> percentScale <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetDestructableAnimationSpeed</span>(d, percentScale <span class="jass-op">*</span> <span class="jass-number">0.01</span>)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Dialog Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DialogDisplayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">dialog</span> whichDialog, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogDisplay</span>(whichPlayer, whichDialog, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DialogSetMessageBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">dialog</span> whichDialog, <span class="jass-type">string</span> message <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogSetMessage</span>(whichDialog, message)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DialogAddButtonBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">dialog</span> whichDialog, <span class="jass-type">string</span> buttonText <span class="jass-keyword">returns</span> <span class="jass-type">button</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedButton</span> <span class="jass-op">=</span> <span class="jass-common-j-native">DialogAddButton</span>(whichDialog, buttonText,<span class="jass-number">0</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedButton</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DialogAddButtonWithHotkeyBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">dialog</span> whichDialog, <span class="jass-type">string</span> buttonText, <span class="jass-type">integer</span> hotkey <span class="jass-keyword">returns</span> <span class="jass-type">button</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedButton</span> <span class="jass-op">=</span> <span class="jass-common-j-native">DialogAddButton</span>(whichDialog, buttonText,hotkey)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedButton</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DialogClearBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">dialog</span> whichDialog <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogClear</span>(whichDialog)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedButtonBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">button</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedButton</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetClickedButtonBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">button</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetClickedButton</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetClickedDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">dialog</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetClickedDialog</span>()
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Alliance Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAllianceBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">alliancetype</span> whichAllianceSetting, <span class="jass-type">boolean</span> value, <span class="jass-type">player</span> otherPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Prevent players from attempting to ally with themselves.</span>
    <span class="jass-keyword">if</span> (sourcePlayer <span class="jass-op">==</span> otherPlayer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, whichAllianceSetting, value)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Set all flags used by the in-game "Ally" checkbox.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>,       flag)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_HELP_REQUEST</span>,  flag)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_HELP_RESPONSE</span>, flag)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_SHARED_XP</span>,     flag)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_SHARED_SPELLS</span>, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Set all flags used by the in-game "Shared Vision" checkbox.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_SHARED_VISION</span>, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Set all flags used by the in-game "Shared Units" checkbox.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_SHARED_CONTROL</span>, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Set all flags used by the in-game "Shared Units" checkbox with the Full</span>
<span class="jass-comment">// Shared Unit Control feature enabled.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_SHARED_ADVANCED_CONTROL</span>, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer, <span class="jass-type">integer</span> allianceState <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Prevent players from attempting to ally with themselves.</span>
    <span class="jass-keyword">if</span> (sourcePlayer <span class="jass-op">==</span> otherPlayer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_UNALLIED</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_UNALLIED_VISION</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_ALLIED</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_ALLIED_VISION</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_ALLIED_UNITS</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_ALLIED_ADVUNITS</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_NEUTRAL</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>( sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>, <span class="jass-const">true</span> )
    <span class="jass-keyword">elseif</span> allianceState <span class="jass-op">==</span> <span class="jass-const">bj_ALLIANCE_NEUTRAL_VISION</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateAllyBJ</span>(        sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateVisionBJ</span>(      sourcePlayer, otherPlayer, <span class="jass-const">true</span>  )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateControlBJ</span>(     sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateFullControlBJ</span>( sourcePlayer, otherPlayer, <span class="jass-const">false</span> )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>( sourcePlayer, otherPlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>, <span class="jass-const">true</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized alliance state - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Set the alliance states for an entire force towards another force.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetForceAllianceStateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> sourceForce, <span class="jass-type">force</span> targetForce, <span class="jass-type">integer</span> allianceState <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> sourceIndex
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> targetIndex

    <span class="jass-keyword">set</span> sourceIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>

        <span class="jass-keyword">if</span> (sourceForce<span class="jass-op">==</span><span class="jass-const">bj_FORCE_ALL_PLAYERS</span> <span class="jass-keyword">or</span> <span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">Player</span>(sourceIndex), sourceForce)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> targetIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">if</span> (targetForce<span class="jass-op">==</span><span class="jass-const">bj_FORCE_ALL_PLAYERS</span> <span class="jass-keyword">or</span> <span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">Player</span>(targetIndex), targetForce)) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerAllianceStateBJ</span>(<span class="jass-common-j-native">Player</span>(sourceIndex), <span class="jass-common-j-native">Player</span>(targetIndex), allianceState)
                <span class="jass-keyword">endif</span>

                <span class="jass-keyword">set</span> targetIndex <span class="jass-op">=</span> targetIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> targetIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> sourceIndex <span class="jass-op">=</span> sourceIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> sourceIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Test to see if two players are co-allied (allied with each other).</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlayersAreCoAllied</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> playerA, <span class="jass-type">player</span> playerB <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-comment">// Players are considered to be allied with themselves.</span>
    <span class="jass-keyword">if</span> (playerA <span class="jass-op">==</span> playerB) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">true</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Co-allies are both allied with each other.</span>
    <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetPlayerAlliance</span>(playerA, playerB, <span class="jass-const">ALLIANCE_PASSIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetPlayerAlliance</span>(playerB, playerA, <span class="jass-const">ALLIANCE_PASSIVE</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> <span class="jass-const">true</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">false</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Force (whichPlayer) AI player to share vision and advanced unit control</span>
<span class="jass-comment">// with all AI players of its allies.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShareEverythingWithTeamAI</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer) <span class="jass-keyword">and</span> whichPlayer <span class="jass-op">!=</span> indexPlayer) <span class="jass-keyword">then</span>
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_COMPUTER</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(whichPlayer, indexPlayer, <span class="jass-const">ALLIANCE_SHARED_VISION</span>, <span class="jass-const">true</span>)
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(whichPlayer, indexPlayer, <span class="jass-const">ALLIANCE_SHARED_CONTROL</span>, <span class="jass-const">true</span>)
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(whichPlayer, indexPlayer, <span class="jass-const">ALLIANCE_SHARED_ADVANCED_CONTROL</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Force (whichPlayer) to share vision and advanced unit control with all of his/her allies.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShareEverythingWithTeam</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer) <span class="jass-keyword">and</span> whichPlayer <span class="jass-op">!=</span> indexPlayer) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(whichPlayer, indexPlayer, <span class="jass-const">ALLIANCE_SHARED_VISION</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(whichPlayer, indexPlayer, <span class="jass-const">ALLIANCE_SHARED_CONTROL</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(indexPlayer, whichPlayer, <span class="jass-const">ALLIANCE_SHARED_CONTROL</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(whichPlayer, indexPlayer, <span class="jass-const">ALLIANCE_SHARED_ADVANCED_CONTROL</span>, <span class="jass-const">true</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Creates a 'Neutral Victim' player slot.  This slot is passive towards all</span>
<span class="jass-comment">// other players, but all other players are aggressive towards him/her.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ConfigureNeutralVictim</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> neutralVictim <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(<span class="jass-const">bj_PLAYER_NEUTRAL_VICTIM</span>)

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)

        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(neutralVictim, indexPlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>, <span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(indexPlayer, neutralVictim, <span class="jass-const">ALLIANCE_PASSIVE</span>, <span class="jass-const">false</span>)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Neutral Victim and Neutral Aggressive should not fight each other.</span>
    <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(<span class="jass-const">PLAYER_NEUTRAL_AGGRESSIVE</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(neutralVictim, indexPlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAlliance</span>(indexPlayer, neutralVictim, <span class="jass-const">ALLIANCE_PASSIVE</span>, <span class="jass-const">true</span>)

    <span class="jass-comment">// Neutral Victim does not give bounties.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(neutralVictim, <span class="jass-const">PLAYER_STATE_GIVES_BOUNTY</span>, <span class="jass-number">0</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForPlayerEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitOwner</span>(<span class="jass-common-j-native">GetEnumUnit</span>(), <span class="jass-common-j-native">Player</span>(<span class="jass-const">bj_PLAYER_NEUTRAL_VICTIM</span>), <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Change ownership for every unit of (whichPlayer)'s team to neutral passive.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span>   playerUnits <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CachePlayerHeroData</span>(whichPlayer)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(playerUnits, whichPlayer, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(playerUnits, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForPlayerEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(playerUnits)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Change ownership for every unit of (whichPlayer)'s team to neutral passive.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForTeam</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForPlayer</span>(indexPlayer)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Determine whether or not victory/defeat is disabled via cheat codes.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AllowVictoryDefeat</span> <span class="jass-keyword">takes</span> <span class="jass-type">playergameresult</span> gameResult <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (gameResult <span class="jass-op">==</span> <span class="jass-const">PLAYER_GAME_RESULT_VICTORY</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-common-j-native">IsNoVictoryCheat</span>()
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">if</span> (gameResult <span class="jass-op">==</span> <span class="jass-const">PLAYER_GAME_RESULT_DEFEAT</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-keyword">not</span> <span class="jass-common-j-native">IsNoDefeatCheat</span>()
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">if</span> (gameResult <span class="jass-op">==</span> <span class="jass-const">PLAYER_GAME_RESULT_NEUTRAL</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> (<span class="jass-keyword">not</span> <span class="jass-common-j-native">IsNoVictoryCheat</span>()) <span class="jass-keyword">and</span> (<span class="jass-keyword">not</span> <span class="jass-common-j-native">IsNoDefeatCheat</span>())
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EndGameBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndGame</span>( <span class="jass-const">true</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeVictoryDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> leftGame <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">dialog</span>  d <span class="jass-op">=</span> <span class="jass-common-j-native">DialogCreate</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">string</span> formatString

    <span class="jass-comment">// Display "player was victorious" or "player has left the game" message</span>
    <span class="jass-keyword">if</span> (leftGame) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> formatString <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_LEFT_GAME"</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> formatString <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_VICTORIOUS"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextFromPlayer</span>(whichPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">60</span>, formatString)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogSetMessage</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_VICTORY_MSG"</span> ) )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_CONTINUE_GAME"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_CONTINUE_GAME"</span>) )

    <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddQuitButton</span>( d, <span class="jass-const">true</span>, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_QUIT_GAME"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_QUIT_GAME"</span>) ) )

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogDisplay</span>( whichPlayer, d, <span class="jass-const">true</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">StartSoundForPlayerBJ</span>( whichPlayer, <span class="jass-const">bj_victoryDialogSound</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDefeatDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> leftGame <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">dialog</span>  d <span class="jass-op">=</span> <span class="jass-common-j-native">DialogCreate</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">string</span> formatString

    <span class="jass-comment">// Display "player was defeated" or "player has left the game" message</span>
    <span class="jass-keyword">if</span> (leftGame) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> formatString <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_LEFT_GAME"</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> formatString <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_DEFEATED"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextFromPlayer</span>(whichPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">60</span>, formatString)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogSetMessage</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_DEFEAT_MSG"</span> ) )

    <span class="jass-comment">// Only show the continue button if the game is not over and observers on death are allowed</span>
    <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_meleeGameOver</span> <span class="jass-keyword">and</span> <span class="jass-common-j-native">IsMapFlagSet</span>(<span class="jass-const">MAP_OBSERVERS_ON_DEATH</span>)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_CONTINUE_OBSERVING"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_CONTINUE_OBSERVING"</span>) )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddQuitButton</span>( d, <span class="jass-const">true</span>, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_QUIT_GAME"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_QUIT_GAME"</span>) ) )

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogDisplay</span>( whichPlayer, d, <span class="jass-const">true</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">StartSoundForPlayerBJ</span>( whichPlayer, <span class="jass-const">bj_defeatDialogSound</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GameOverDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> leftGame <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">dialog</span>  d <span class="jass-op">=</span> <span class="jass-common-j-native">DialogCreate</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">string</span>  s

    <span class="jass-comment">// Display "player left the game" message</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextFromPlayer</span>(whichPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">60</span>, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_LEFT_GAME"</span> ))

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetIntegerGameState</span>(<span class="jass-const">GAME_STATE_DISCONNECTED</span>) <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> s <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_DISCONNECTED"</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> s <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_GAME_OVER"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogSetMessage</span>( d, s )

    <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddQuitButton</span>( d, <span class="jass-const">true</span>, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_OK"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_OK"</span>) ) )

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogDisplay</span>( whichPlayer, d, <span class="jass-const">true</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">StartSoundForPlayerBJ</span>( whichPlayer, <span class="jass-const">bj_defeatDialogSound</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playergameresult</span> gameResult, <span class="jass-type">boolean</span> leftGame <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">AllowVictoryDefeat</span>(gameResult) <span class="jass-keyword">then</span>

        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemovePlayer</span>(whichPlayer, gameResult)

        <span class="jass-keyword">if</span>( gameResult <span class="jass-op">==</span> <span class="jass-const">PLAYER_GAME_RESULT_VICTORY</span> ) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeVictoryDialogBJ</span>( whichPlayer, leftGame )
            <span class="jass-keyword">return</span>
        <span class="jass-keyword">elseif</span>( gameResult <span class="jass-op">==</span> <span class="jass-const">PLAYER_GAME_RESULT_DEFEAT</span> ) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeDefeatDialogBJ</span>( whichPlayer, leftGame )
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">GameOverDialogBJ</span>( whichPlayer, leftGame )
        <span class="jass-keyword">endif</span>

    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictoryOkBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">false</span> )
        <span class="jass-comment">// Bump the difficulty back up to the default.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameDifficulty</span>(<span class="jass-common-j-native">GetDefaultDifficulty</span>())
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (<span class="jass-const">bj_changeLevelMapName</span> <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndGame</span>( <span class="jass-const">bj_changeLevelShowScores</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ChangeLevel</span>( <span class="jass-const">bj_changeLevelMapName</span>, <span class="jass-const">bj_changeLevelShowScores</span> )
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictoryQuitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">false</span> )
        <span class="jass-comment">// Bump the difficulty back up to the default.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameDifficulty</span>(<span class="jass-common-j-native">GetDefaultDifficulty</span>())
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndGame</span>( <span class="jass-const">bj_changeLevelShowScores</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictoryDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">dialog</span>  d <span class="jass-op">=</span> <span class="jass-common-j-native">DialogCreate</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogSetMessage</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_VICTORY_MSG"</span> ) )

    <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_CONTINUE"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_CONTINUE"</span>) ) )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>( t, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictoryOkBJ</span> )

    <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_QUIT_MISSION"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_QUIT_MISSION"</span>) ) )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>( t, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictoryQuitBJ</span> )

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserControl</span>( <span class="jass-const">true</span> )
        <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">true</span> )
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserUI</span>(<span class="jass-const">false</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogDisplay</span>( whichPlayer, d, <span class="jass-const">true</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">VolumeGroupSetVolumeForPlayerBJ</span>( whichPlayer, <span class="jass-const">SOUND_VOLUMEGROUP_UI</span>, <span class="jass-number">1.0</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">StartSoundForPlayerBJ</span>( whichPlayer, <span class="jass-const">bj_victoryDialogSound</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictorySkipBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
            <span class="jass-comment">// Bump the difficulty back up to the default.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameDifficulty</span>(<span class="jass-common-j-native">GetDefaultDifficulty</span>())
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">if</span> (<span class="jass-const">bj_changeLevelMapName</span> <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndGame</span>( <span class="jass-const">bj_changeLevelShowScores</span> )
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ChangeLevel</span>( <span class="jass-const">bj_changeLevelMapName</span>, <span class="jass-const">bj_changeLevelShowScores</span> )
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomVictoryBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> showDialog, <span class="jass-type">boolean</span> showScores <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">AllowVictoryDefeat</span>( <span class="jass-const">PLAYER_GAME_RESULT_VICTORY</span> ) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemovePlayer</span>( whichPlayer, <span class="jass-const">PLAYER_GAME_RESULT_VICTORY</span> )

        <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextFromPlayer</span>(whichPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">60</span>, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_VICTORIOUS"</span> ) )
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// UI only needs to be displayed to users.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(whichPlayer) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_USER</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_changeLevelShowScores</span> <span class="jass-op">=</span> showScores
            <span class="jass-keyword">if</span> showDialog <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CustomVictoryDialogBJ</span>( whichPlayer )
            <span class="jass-keyword">else</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CustomVictorySkipBJ</span>( whichPlayer )
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatRestartBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">false</span> )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RestartGame</span>( <span class="jass-const">true</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatReduceDifficultyBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">gamedifficulty</span> diff <span class="jass-op">=</span> <span class="jass-common-j-native">GetGameDifficulty</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">false</span> )

    <span class="jass-comment">// Knock the difficulty down, if possible.</span>
    <span class="jass-keyword">if</span> (diff <span class="jass-op">==</span> <span class="jass-const">MAP_DIFFICULTY_EASY</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Sorry, but it doesn't get any easier than this.</span>
    <span class="jass-keyword">elseif</span> (diff <span class="jass-op">==</span> <span class="jass-const">MAP_DIFFICULTY_NORMAL</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameDifficulty</span>(<span class="jass-const">MAP_DIFFICULTY_EASY</span>)
    <span class="jass-keyword">elseif</span> (diff <span class="jass-op">==</span> <span class="jass-const">MAP_DIFFICULTY_HARD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameDifficulty</span>(<span class="jass-const">MAP_DIFFICULTY_NORMAL</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized difficulty</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RestartGame</span>( <span class="jass-const">true</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatLoadBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">false</span> )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayLoadDialog</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatQuitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">false</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Bump the difficulty back up to the default.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameDifficulty</span>(<span class="jass-common-j-native">GetDefaultDifficulty</span>())
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndGame</span>( <span class="jass-const">true</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">string</span> message <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">dialog</span>  d <span class="jass-op">=</span> <span class="jass-common-j-native">DialogCreate</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogSetMessage</span>( d, message )

    <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_RESTART"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_RESTART"</span>) ) )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>( t, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatRestartBJ</span> )

        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetGameDifficulty</span>() <span class="jass-op">!=</span> <span class="jass-const">MAP_DIFFICULTY_EASY</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_REDUCE_DIFFICULTY"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_REDUCE_DIFFICULTY"</span>) ) )
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>( t, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatReduceDifficultyBJ</span> )
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_LOAD"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_LOAD"</span>) ) )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>( t, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatLoadBJ</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> t <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterDialogButtonEvent</span>( t, <span class="jass-common-j-native">DialogAddButton</span>( d, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"GAMEOVER_QUIT_MISSION"</span> ), <span class="jass-common-j-native">GetLocalizedHotkey</span>(<span class="jass-string">"GAMEOVER_QUIT_MISSION"</span>) ) )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>( t, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatQuitBJ</span> )

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserControl</span>( <span class="jass-const">true</span> )
        <span class="jass-keyword">if</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>( <span class="jass-const">true</span> )
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserUI</span>(<span class="jass-const">false</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DialogDisplay</span>( whichPlayer, d, <span class="jass-const">true</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">VolumeGroupSetVolumeForPlayerBJ</span>( whichPlayer, <span class="jass-const">SOUND_VOLUMEGROUP_UI</span>, <span class="jass-number">1.0</span> )
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">StartSoundForPlayerBJ</span>( whichPlayer, <span class="jass-const">bj_defeatDialogSound</span> )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CustomDefeatBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">string</span> message <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">AllowVictoryDefeat</span>( <span class="jass-const">PLAYER_GAME_RESULT_DEFEAT</span> ) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemovePlayer</span>( whichPlayer, <span class="jass-const">PLAYER_GAME_RESULT_DEFEAT</span> )

        <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextFromPlayer</span>(whichPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">60</span>, <span class="jass-common-j-native">GetLocalizedString</span>( <span class="jass-string">"PLAYER_DEFEATED"</span> ) )
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// UI only needs to be displayed to users.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(whichPlayer) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_USER</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CustomDefeatDialogBJ</span>( whichPlayer, message )
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetNextLevelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> nextLevel <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (nextLevel <span class="jass-op">==</span> <span class="jass-string">""</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_changeLevelMapName</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_changeLevelMapName</span> <span class="jass-op">=</span> nextLevel
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerOnScoreScreenBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerOnScoreScreen</span>(whichPlayer, flag)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Quest Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateQuestBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> questType, <span class="jass-type">string</span> title, <span class="jass-type">string</span> description, <span class="jass-type">string</span> iconPath <span class="jass-keyword">returns</span> <span class="jass-type">quest</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> required   <span class="jass-op">=</span> (questType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTTYPE_REQ_DISCOVERED</span>) <span class="jass-keyword">or</span> (questType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTTYPE_REQ_UNDISCOVERED</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> discovered <span class="jass-op">=</span> (questType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTTYPE_REQ_DISCOVERED</span>) <span class="jass-keyword">or</span> (questType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTTYPE_OPT_DISCOVERED</span>)

    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedQuest</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateQuest</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetTitle</span>(<span class="jass-const">bj_lastCreatedQuest</span>, title)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetDescription</span>(<span class="jass-const">bj_lastCreatedQuest</span>, description)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetIconPath</span>(<span class="jass-const">bj_lastCreatedQuest</span>, iconPath)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetRequired</span>(<span class="jass-const">bj_lastCreatedQuest</span>, required)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetDiscovered</span>(<span class="jass-const">bj_lastCreatedQuest</span>, discovered)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetCompleted</span>(<span class="jass-const">bj_lastCreatedQuest</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedQuest</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyQuestBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyQuest</span>(whichQuest)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestSetEnabledBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enabled, <span class="jass-type">quest</span> whichQuest <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetEnabled</span>(whichQuest, enabled)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestSetTitleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest, <span class="jass-type">string</span> title <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetTitle</span>(whichQuest, title)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestSetDescriptionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest, <span class="jass-type">string</span> description <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetDescription</span>(whichQuest, description)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestSetCompletedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest, <span class="jass-type">boolean</span> completed <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetCompleted</span>(whichQuest, completed)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestSetFailedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest, <span class="jass-type">boolean</span> failed <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetFailed</span>(whichQuest, failed)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestSetDiscoveredBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest, <span class="jass-type">boolean</span> discovered <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestSetDiscovered</span>(whichQuest, discovered)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedQuestBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">quest</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedQuest</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateQuestItemBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">quest</span> whichQuest, <span class="jass-type">string</span> description <span class="jass-keyword">returns</span> <span class="jass-type">questitem</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedQuestItem</span> <span class="jass-op">=</span> <span class="jass-common-j-native">QuestCreateItem</span>(whichQuest)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestItemSetDescription</span>(<span class="jass-const">bj_lastCreatedQuestItem</span>, description)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestItemSetCompleted</span>(<span class="jass-const">bj_lastCreatedQuestItem</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedQuestItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestItemSetDescriptionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">questitem</span> whichQuestItem, <span class="jass-type">string</span> description <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestItemSetDescription</span>(whichQuestItem, description)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestItemSetCompletedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">questitem</span> whichQuestItem, <span class="jass-type">boolean</span> completed <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">QuestItemSetCompleted</span>(whichQuestItem, completed)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedQuestItemBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">questitem</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedQuestItem</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateDefeatConditionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> description <span class="jass-keyword">returns</span> <span class="jass-type">defeatcondition</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedDefeatCondition</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateDefeatCondition</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DefeatConditionSetDescription</span>(<span class="jass-const">bj_lastCreatedDefeatCondition</span>, description)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedDefeatCondition</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyDefeatConditionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">defeatcondition</span> whichCondition <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyDefeatCondition</span>(whichCondition)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DefeatConditionSetDescriptionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">defeatcondition</span> whichCondition, <span class="jass-type">string</span> description <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DefeatConditionSetDescription</span>(whichCondition, description)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedDefeatConditionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">defeatcondition</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedDefeatCondition</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FlashQuestDialogButtonBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlashQuestDialogButton</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QuestMessageBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> f, <span class="jass-type">integer</span> messageType, <span class="jass-type">string</span> message <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), f)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

        <span class="jass-keyword">if</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_DISCOVERED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUEST</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUEST</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questDiscoveredSound</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlashQuestDialogButton</span>()

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_UPDATED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTUPDATE</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTUPDATE</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questUpdatedSound</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlashQuestDialogButton</span>()

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_COMPLETED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTDONE</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTDONE</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questCompletedSound</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlashQuestDialogButton</span>()

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_FAILED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTFAILED</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTFAILED</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questFailedSound</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlashQuestDialogButton</span>()

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_REQUIREMENT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_QUESTREQUIREMENT</span>, message)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_MISSIONFAILED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_MISSIONFAILED</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_MISSIONFAILED</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questFailedSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_HINT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_HINT</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_HINT</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questHintSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_ALWAYSHINT</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_ALWAYSHINT</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_ALWAYSHINT</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questHintSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_SECRET</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_SECRET</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_SECRET</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questSecretSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_UNITACQUIRED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_UNITACQUIRED</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_UNITACQUIRED</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questHintSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_UNITAVAILABLE</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_UNITAVAILABLE</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_UNITAVAILABLE</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questHintSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_ITEMACQUIRED</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_ITEMACQUIRED</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_ITEMACQUIRED</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questItemAcquiredSound</span>)

        <span class="jass-keyword">elseif</span> (messageType <span class="jass-op">==</span> <span class="jass-const">bj_QUESTMESSAGE_WARNING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_WARNING</span>, <span class="jass-string">" "</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_TEXT_DELAY_WARNING</span>, message)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_questWarningSound</span>)

        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized message type - ignore the request.</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Timer Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StartTimerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timer</span> t, <span class="jass-type">boolean</span> periodic, <span class="jass-type">real</span> timeout <span class="jass-keyword">returns</span> <span class="jass-type">timer</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastStartedTimer</span> <span class="jass-op">=</span> t
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(t, timeout, periodic, <span class="jass-type">null</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastStartedTimer</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateTimerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> periodic, <span class="jass-type">real</span> timeout <span class="jass-keyword">returns</span> <span class="jass-type">timer</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastStartedTimer</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_lastStartedTimer</span>, timeout, periodic, <span class="jass-type">null</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastStartedTimer</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyTimerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timer</span> whichTimer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(whichTimer)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseTimerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> pause, <span class="jass-type">timer</span> whichTimer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> pause <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseTimer</span>(whichTimer)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ResumeTimer</span>(whichTimer)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedTimerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">timer</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastStartedTimer</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateTimerDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timer</span> t, <span class="jass-type">string</span> title <span class="jass-keyword">returns</span> <span class="jass-type">timerdialog</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTimerDialog</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimerDialog</span>(t)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetTitle</span>(<span class="jass-const">bj_lastCreatedTimerDialog</span>, title)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(<span class="jass-const">bj_lastCreatedTimerDialog</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTimerDialog</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyTimerDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timerdialog</span> td <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimerDialog</span>(td)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TimerDialogSetTitleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timerdialog</span> td, <span class="jass-type">string</span> title <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetTitle</span>(td, title)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TimerDialogSetTitleColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timerdialog</span> td, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetTitleColor</span>(td, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TimerDialogSetTimeColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timerdialog</span> td, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetTimeColor</span>(td, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TimerDialogSetSpeedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">timerdialog</span> td, <span class="jass-type">real</span> speedMultFactor <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetSpeed</span>(td, speedMultFactor)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TimerDialogDisplayForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">timerdialog</span> td, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(td, show)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TimerDialogDisplayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">timerdialog</span> td <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(td, show)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedTimerDialogBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">timerdialog</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTimerDialog</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Leaderboard Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardResizeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> size <span class="jass-op">=</span> <span class="jass-common-j-native">LeaderboardGetItemCount</span>(lb)

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">LeaderboardGetLabelText</span>(lb) <span class="jass-op">==</span> <span class="jass-string">""</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> size <span class="jass-op">=</span> size <span class="jass-op">-</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetSizeByItemCount</span>(lb, size)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetPlayerItemValueBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb, <span class="jass-type">integer</span> val <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetItemValue</span>(lb, <span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, whichPlayer), val)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetPlayerItemLabelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb, <span class="jass-type">string</span> val <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetItemLabel</span>(lb, <span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, whichPlayer), val)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetPlayerItemStyleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb, <span class="jass-type">boolean</span> showLabel, <span class="jass-type">boolean</span> showValue, <span class="jass-type">boolean</span> showIcon <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetItemStyle</span>(lb, <span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, whichPlayer), showLabel, showValue, showIcon)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetPlayerItemLabelColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetItemLabelColor</span>(lb, <span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, whichPlayer), <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetPlayerItemValueColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetItemValueColor</span>(lb, <span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, whichPlayer), <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetLabelColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetLabelColor</span>(lb, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetValueColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetValueColor</span>(lb, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetLabelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">string</span> label <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetLabel</span>(lb, label)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">LeaderboardResizeBJ</span>(lb)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSetStyleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">boolean</span> showLabel, <span class="jass-type">boolean</span> showNames, <span class="jass-type">boolean</span> showValues, <span class="jass-type">boolean</span> showIcons <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetStyle</span>(lb, showLabel, showNames, showValues, showIcons)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardGetItemCountBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">LeaderboardGetItemCount</span>(lb)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardHasPlayerItemBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">LeaderboardHasPlayerItem</span>(lb, whichPlayer)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForceSetLeaderboardBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">force</span> toForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
        <span class="jass-keyword">if</span> <span class="jass-common-j-native">IsPlayerInForce</span>(indexPlayer, toForce) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayerSetLeaderboard</span>(indexPlayer, lb)
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateLeaderboardBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> toForce, <span class="jass-type">string</span> label <span class="jass-keyword">returns</span> <span class="jass-type">leaderboard</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedLeaderboard</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateLeaderboard</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSetLabel</span>(<span class="jass-const">bj_lastCreatedLeaderboard</span>, label)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ForceSetLeaderboardBJ</span>(<span class="jass-const">bj_lastCreatedLeaderboard</span>, toForce)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardDisplay</span>(<span class="jass-const">bj_lastCreatedLeaderboard</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedLeaderboard</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyLeaderboardBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyLeaderboard</span>(lb)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardDisplayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardDisplay</span>(lb, show)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardAddItemBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb, <span class="jass-type">string</span> label, <span class="jass-type">integer</span> value <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">LeaderboardHasPlayerItem</span>(lb, whichPlayer)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardRemovePlayerItem</span>(lb, whichPlayer)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardAddItem</span>(lb, label, value, whichPlayer)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">LeaderboardResizeBJ</span>(lb)
    <span class="jass-comment">//call LeaderboardSetSizeByItemCount(lb, LeaderboardGetItemCount(lb))</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardRemovePlayerItemBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardRemovePlayerItem</span>(lb, whichPlayer)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">LeaderboardResizeBJ</span>(lb)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSortItemsBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">integer</span> sortType, <span class="jass-type">boolean</span> ascending <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (sortType <span class="jass-op">==</span> <span class="jass-const">bj_SORTTYPE_SORTBYVALUE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSortItemsByValue</span>(lb, ascending)
    <span class="jass-keyword">elseif</span> (sortType <span class="jass-op">==</span> <span class="jass-const">bj_SORTTYPE_SORTBYPLAYER</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSortItemsByPlayer</span>(lb, ascending)
    <span class="jass-keyword">elseif</span> (sortType <span class="jass-op">==</span> <span class="jass-const">bj_SORTTYPE_SORTBYLABEL</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSortItemsByLabel</span>(lb, ascending)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized sort type - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSortItemsByPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">boolean</span> ascending <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSortItemsByPlayer</span>(lb, ascending)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardSortItemsByLabelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">leaderboard</span> lb, <span class="jass-type">boolean</span> ascending <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LeaderboardSortItemsByLabel</span>(lb, ascending)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardGetPlayerIndexBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, whichPlayer) <span class="jass-op">+</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns the player who is occupying a specified position in a leaderboard.</span>
<span class="jass-comment">// The position parameter is expected in the range of 1..16.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LeaderboardGetIndexedPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> position, <span class="jass-type">leaderboard</span> lb <span class="jass-keyword">returns</span> <span class="jass-type">player</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">LeaderboardGetPlayerIndex</span>(lb, indexPlayer) <span class="jass-op">==</span> position <span class="jass-op">-</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span> indexPlayer
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Player</span>(<span class="jass-const">PLAYER_NEUTRAL_PASSIVE</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PlayerGetLeaderboardBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">leaderboard</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">PlayerGetLeaderboard</span>(whichPlayer)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedLeaderboard</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">leaderboard</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedLeaderboard</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Multiboard Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateMultiboardBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> cols, <span class="jass-type">integer</span> rows, <span class="jass-type">string</span> title <span class="jass-keyword">returns</span> <span class="jass-type">multiboard</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedMultiboard</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateMultiboard</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetRowCount</span>(<span class="jass-const">bj_lastCreatedMultiboard</span>, rows)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetColumnCount</span>(<span class="jass-const">bj_lastCreatedMultiboard</span>, cols)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetTitleText</span>(<span class="jass-const">bj_lastCreatedMultiboard</span>, title)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardDisplay</span>(<span class="jass-const">bj_lastCreatedMultiboard</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedMultiboard</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyMultiboardBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyMultiboard</span>(mb)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedMultiboard</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">multiboard</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedMultiboard</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardDisplayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">multiboard</span> mb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardDisplay</span>(mb, show)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardMinimizeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> minimize, <span class="jass-type">multiboard</span> mb <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardMinimize</span>(mb, minimize)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardSetTitleTextColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetTitleTextColor</span>(mb, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardAllowDisplayBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSuppressDisplay</span>(<span class="jass-keyword">not</span> flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardSetItemStyleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb, <span class="jass-type">integer</span> col, <span class="jass-type">integer</span> row, <span class="jass-type">boolean</span> showValue, <span class="jass-type">boolean</span> showIcon <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curRow <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numRows <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetRowCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numCols <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetColumnCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">multiboarditem</span> mbitem <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Loop over rows, using 1-based index</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> curRow <span class="jass-op">=</span> curRow <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> curRow <span class="jass-op">&gt;</span> numRows

        <span class="jass-comment">// Apply setting to the requested row, or all rows (if row is 0)</span>
        <span class="jass-keyword">if</span> (row <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> row <span class="jass-op">==</span> curRow) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Loop over columns, using 1-based index</span>
            <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> curCol <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> curCol <span class="jass-op">&gt;</span> numCols

                <span class="jass-comment">// Apply setting to the requested column, or all columns (if col is 0)</span>
                <span class="jass-keyword">if</span> (col <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> col <span class="jass-op">==</span> curCol) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> mbitem <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetItem</span>(mb, curRow <span class="jass-op">-</span> <span class="jass-number">1</span>, curCol <span class="jass-op">-</span> <span class="jass-number">1</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetItemStyle</span>(mbitem, showValue, showIcon)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardReleaseItem</span>(mbitem)
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardSetItemValueBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb, <span class="jass-type">integer</span> col, <span class="jass-type">integer</span> row, <span class="jass-type">string</span> val <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curRow <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numRows <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetRowCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numCols <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetColumnCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">multiboarditem</span> mbitem <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Loop over rows, using 1-based index</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> curRow <span class="jass-op">=</span> curRow <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> curRow <span class="jass-op">&gt;</span> numRows

        <span class="jass-comment">// Apply setting to the requested row, or all rows (if row is 0)</span>
        <span class="jass-keyword">if</span> (row <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> row <span class="jass-op">==</span> curRow) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Loop over columns, using 1-based index</span>
            <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> curCol <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> curCol <span class="jass-op">&gt;</span> numCols

                <span class="jass-comment">// Apply setting to the requested column, or all columns (if col is 0)</span>
                <span class="jass-keyword">if</span> (col <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> col <span class="jass-op">==</span> curCol) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> mbitem <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetItem</span>(mb, curRow <span class="jass-op">-</span> <span class="jass-number">1</span>, curCol <span class="jass-op">-</span> <span class="jass-number">1</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetItemValue</span>(mbitem, val)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardReleaseItem</span>(mbitem)
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardSetItemColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb, <span class="jass-type">integer</span> col, <span class="jass-type">integer</span> row, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curRow <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numRows <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetRowCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numCols <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetColumnCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">multiboarditem</span> mbitem <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Loop over rows, using 1-based index</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> curRow <span class="jass-op">=</span> curRow <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> curRow <span class="jass-op">&gt;</span> numRows

        <span class="jass-comment">// Apply setting to the requested row, or all rows (if row is 0)</span>
        <span class="jass-keyword">if</span> (row <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> row <span class="jass-op">==</span> curRow) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Loop over columns, using 1-based index</span>
            <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> curCol <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> curCol <span class="jass-op">&gt;</span> numCols

                <span class="jass-comment">// Apply setting to the requested column, or all columns (if col is 0)</span>
                <span class="jass-keyword">if</span> (col <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> col <span class="jass-op">==</span> curCol) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> mbitem <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetItem</span>(mb, curRow <span class="jass-op">-</span> <span class="jass-number">1</span>, curCol <span class="jass-op">-</span> <span class="jass-number">1</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetItemValueColor</span>(mbitem, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardReleaseItem</span>(mbitem)
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardSetItemWidthBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb, <span class="jass-type">integer</span> col, <span class="jass-type">integer</span> row, <span class="jass-type">real</span> width <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curRow <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numRows <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetRowCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numCols <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetColumnCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">multiboarditem</span> mbitem <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Loop over rows, using 1-based index</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> curRow <span class="jass-op">=</span> curRow <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> curRow <span class="jass-op">&gt;</span> numRows

        <span class="jass-comment">// Apply setting to the requested row, or all rows (if row is 0)</span>
        <span class="jass-keyword">if</span> (row <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> row <span class="jass-op">==</span> curRow) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Loop over columns, using 1-based index</span>
            <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> curCol <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> curCol <span class="jass-op">&gt;</span> numCols

                <span class="jass-comment">// Apply setting to the requested column, or all columns (if col is 0)</span>
                <span class="jass-keyword">if</span> (col <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> col <span class="jass-op">==</span> curCol) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> mbitem <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetItem</span>(mb, curRow <span class="jass-op">-</span> <span class="jass-number">1</span>, curCol <span class="jass-op">-</span> <span class="jass-number">1</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetItemWidth</span>(mbitem, width<span class="jass-op">/</span><span class="jass-number">100.0</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardReleaseItem</span>(mbitem)
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MultiboardSetItemIconBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">multiboard</span> mb, <span class="jass-type">integer</span> col, <span class="jass-type">integer</span> row, <span class="jass-type">string</span> iconFileName <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curRow <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numRows <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetRowCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> numCols <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetColumnCount</span>(mb)
    <span class="jass-keyword">local</span> <span class="jass-type">multiboarditem</span> mbitem <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-comment">// Loop over rows, using 1-based index</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> curRow <span class="jass-op">=</span> curRow <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> curRow <span class="jass-op">&gt;</span> numRows

        <span class="jass-comment">// Apply setting to the requested row, or all rows (if row is 0)</span>
        <span class="jass-keyword">if</span> (row <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> row <span class="jass-op">==</span> curRow) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Loop over columns, using 1-based index</span>
            <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">set</span> curCol <span class="jass-op">=</span> curCol <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> curCol <span class="jass-op">&gt;</span> numCols

                <span class="jass-comment">// Apply setting to the requested column, or all columns (if col is 0)</span>
                <span class="jass-keyword">if</span> (col <span class="jass-op">==</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> col <span class="jass-op">==</span> curCol) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> mbitem <span class="jass-op">=</span> <span class="jass-common-j-native">MultiboardGetItem</span>(mb, curRow <span class="jass-op">-</span> <span class="jass-number">1</span>, curCol <span class="jass-op">-</span> <span class="jass-number">1</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardSetItemIcon</span>(mbitem, iconFileName)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">MultiboardReleaseItem</span>(mbitem)
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Text Tag Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Scale the font size linearly such that size 10 equates to height 0.023.</span>
<span class="jass-comment">// Screen-relative font heights are harder to grasp and than font sizes.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TextTagSize2Height</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> size <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> size <span class="jass-op">*</span> <span class="jass-number">0.023</span> <span class="jass-op">/</span> <span class="jass-number">10</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Scale the speed linearly such that speed 128 equates to 0.071.</span>
<span class="jass-comment">// Screen-relative speeds are hard to grasp.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TextTagSpeed2Velocity</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> speed <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> speed <span class="jass-op">*</span> <span class="jass-number">0.071</span> <span class="jass-op">/</span> <span class="jass-number">128</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagColor</span>(tt, <span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100.0</span><span class="jass-op">-</span>transparency))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagVelocityBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">real</span> speed, <span class="jass-type">real</span> angle <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> vel <span class="jass-op">=</span> <span class="jass-blizzard-j-function">TextTagSpeed2Velocity</span>(speed)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> xvel <span class="jass-op">=</span> vel <span class="jass-op">*</span> <span class="jass-common-j-native">Cos</span>(angle <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> yvel <span class="jass-op">=</span> vel <span class="jass-op">*</span> <span class="jass-common-j-native">Sin</span>(angle <span class="jass-op">*</span> <span class="jass-const">bj_DEGTORAD</span>)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagVelocity</span>(tt, xvel, yvel)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagTextBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">string</span> s, <span class="jass-type">real</span> size <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> textHeight <span class="jass-op">=</span> <span class="jass-blizzard-j-function">TextTagSize2Height</span>(size)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagText</span>(tt, s, textHeight)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagPosBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> zOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagPos</span>(tt, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), zOffset)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagPosUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> zOffset <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagPosUnit</span>(tt, whichUnit, zOffset)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagSuspendedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagSuspended</span>(tt, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagPermanentBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagPermanent</span>(tt, flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagAgeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">real</span> age <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagAge</span>(tt, age)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagLifespanBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">real</span> lifespan <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagLifespan</span>(tt, lifespan)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetTextTagFadepointBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt, <span class="jass-type">real</span> fadepoint <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagFadepoint</span>(tt, fadepoint)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateTextTagLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> s, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> zOffset, <span class="jass-type">real</span> size, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">texttag</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTextTag</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTextTag</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetTextTagTextBJ</span>(<span class="jass-const">bj_lastCreatedTextTag</span>, s, size)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetTextTagPosBJ</span>(<span class="jass-const">bj_lastCreatedTextTag</span>, loc, zOffset)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetTextTagColorBJ</span>(<span class="jass-const">bj_lastCreatedTextTag</span>, red, green, blue, transparency)

    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTextTag</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CreateTextTagUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> s, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">real</span> zOffset, <span class="jass-type">real</span> size, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> transparency <span class="jass-keyword">returns</span> <span class="jass-type">texttag</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedTextTag</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTextTag</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetTextTagTextBJ</span>(<span class="jass-const">bj_lastCreatedTextTag</span>, s, size)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetTextTagPosUnitBJ</span>(<span class="jass-const">bj_lastCreatedTextTag</span>, whichUnit, zOffset)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetTextTagColorBJ</span>(<span class="jass-const">bj_lastCreatedTextTag</span>, red, green, blue, transparency)

    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTextTag</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DestroyTextTagBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">texttag</span> tt <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTextTag</span>(tt)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowTextTagForceBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">texttag</span> tt, <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTextTagVisibility</span>(tt, show)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedTextTag</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">texttag</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedTextTag</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Cinematic Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseGameOn</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>(<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PauseGameOff</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseGame</span>(<span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUserControlForceOn</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserControl</span>(<span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUserControlForceOff</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserControl</span>(<span class="jass-const">false</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowInterfaceForceOn</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce, <span class="jass-type">real</span> fadeDuration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowInterface</span>(<span class="jass-const">true</span>, fadeDuration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowInterfaceForceOff</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce, <span class="jass-type">real</span> fadeDuration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowInterface</span>(<span class="jass-const">false</span>, fadeDuration)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PingMinimapForForce</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PingMinimap</span>(x, y, duration)
        <span class="jass-comment">//call StartSound(bj_pingMinimapSound)</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PingMinimapLocForForce</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PingMinimapForForce</span>(whichForce, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), duration)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PingMinimapForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> whichPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PingMinimap</span>(x, y, duration)
        <span class="jass-comment">//call StartSound(bj_pingMinimapSound)</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PingMinimapLocForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PingMinimapForPlayer</span>(whichPlayer, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), duration)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PingMinimapForForceEx</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">real</span> duration, <span class="jass-type">integer</span> style, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> red255   <span class="jass-op">=</span> <span class="jass-blizzard-j-function">PercentTo255</span>(red)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> green255 <span class="jass-op">=</span> <span class="jass-blizzard-j-function">PercentTo255</span>(green)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> blue255  <span class="jass-op">=</span> <span class="jass-blizzard-j-function">PercentTo255</span>(blue)

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), whichForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

        <span class="jass-comment">// Prevent 100% red simple and flashy pings, as they become "attack" pings.</span>
        <span class="jass-keyword">if</span> (red255 <span class="jass-op">==</span> <span class="jass-number">255</span>) <span class="jass-keyword">and</span> (green255 <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">and</span> (blue255 <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> red255 <span class="jass-op">=</span> <span class="jass-number">254</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">if</span> (style <span class="jass-op">==</span> <span class="jass-const">bj_MINIMAPPINGSTYLE_SIMPLE</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PingMinimapEx</span>(x, y, duration, red255, green255, blue255, <span class="jass-const">false</span>)
        <span class="jass-keyword">elseif</span> (style <span class="jass-op">==</span> <span class="jass-const">bj_MINIMAPPINGSTYLE_FLASHY</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PingMinimapEx</span>(x, y, duration, red255, green255, blue255, <span class="jass-const">true</span>)
        <span class="jass-keyword">elseif</span> (style <span class="jass-op">==</span> <span class="jass-const">bj_MINIMAPPINGSTYLE_ATTACK</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PingMinimapEx</span>(x, y, duration, <span class="jass-number">255</span>, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">false</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Unrecognized ping style - ignore the request.</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">//call StartSound(bj_pingMinimapSound)</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PingMinimapLocForForceEx</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> whichForce, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> duration, <span class="jass-type">integer</span> style, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PingMinimapForForceEx</span>(whichForce, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), duration, style, red, green, blue)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnableWorldFogBoundaryBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enable, <span class="jass-type">force</span> f <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), f)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableWorldFogBoundary</span>(enable)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnableOcclusionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> enable, <span class="jass-type">force</span> f <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), f)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableOcclusion</span>(enable)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Cinematic Transmission Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// If cancelled, stop the sound and end the cinematic scene.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CancelCineSceneBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">StopSoundBJ</span>(<span class="jass-const">bj_cineSceneLastSound</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndCinematicScene</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Init a trigger to listen for END_CINEMATIC events and respond to them if</span>
<span class="jass-comment">// a cinematic scene is in progress.  For performance reasons, this should</span>
<span class="jass-comment">// only be called once a cinematic scene has been started, so that maps</span>
<span class="jass-comment">// lacking such scenes do not bother to register for these events.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TryInitCinematicBehaviorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">if</span> (<span class="jass-const">bj_cineSceneBeingSkipped</span> <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_cineSceneBeingSkipped</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(<span class="jass-const">bj_cineSceneBeingSkipped</span>, <span class="jass-common-j-native">Player</span>(index), <span class="jass-const">EVENT_PLAYER_END_CINEMATIC</span>)
            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
        <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_cineSceneBeingSkipped</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CancelCineSceneBJ</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCinematicSceneBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">integer</span> portraitUnitId, <span class="jass-type">playercolor</span> color, <span class="jass-type">string</span> speakerTitle, <span class="jass-type">string</span> text, <span class="jass-type">real</span> sceneDuration, <span class="jass-type">real</span> voiceoverDuration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineSceneLastSound</span> <span class="jass-op">=</span> soundHandle
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PlaySoundBJ</span>(soundHandle)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCinematicScene</span>(portraitUnitId, color, speakerTitle, text, sceneDuration, voiceoverDuration)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetTransmissionDuration</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">integer</span> timeType, <span class="jass-type">real</span> timeVal <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> duration

    <span class="jass-keyword">if</span> (timeType <span class="jass-op">==</span> <span class="jass-const">bj_TIMETYPE_ADD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> duration <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetSoundDurationBJ</span>(soundHandle) <span class="jass-op">+</span> timeVal
    <span class="jass-keyword">elseif</span> (timeType <span class="jass-op">==</span> <span class="jass-const">bj_TIMETYPE_SET</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> duration <span class="jass-op">=</span> timeVal
    <span class="jass-keyword">elseif</span> (timeType <span class="jass-op">==</span> <span class="jass-const">bj_TIMETYPE_SUB</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> duration <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetSoundDurationBJ</span>(soundHandle) <span class="jass-op">-</span> timeVal
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized timeType - ignore timeVal.</span>
        <span class="jass-keyword">set</span> duration <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetSoundDurationBJ</span>(soundHandle)
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Make sure we have a non-negative duration.</span>
    <span class="jass-keyword">if</span> (duration <span class="jass-op">&lt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> duration <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> duration
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WaitTransmissionDuration</span> <span class="jass-keyword">takes</span> <span class="jass-type">sound</span> soundHandle, <span class="jass-type">integer</span> timeType, <span class="jass-type">real</span> timeVal <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (timeType <span class="jass-op">==</span> <span class="jass-const">bj_TIMETYPE_SET</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If we have a static duration wait, just perform the wait.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(timeVal)

    <span class="jass-keyword">elseif</span> (soundHandle <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the sound does not exist, perform a default length wait.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(<span class="jass-const">bj_NOTHING_SOUND_DURATION</span>)

    <span class="jass-keyword">elseif</span> (timeType <span class="jass-op">==</span> <span class="jass-const">bj_TIMETYPE_SUB</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the transmission is cutting off the sound, wait for the sound</span>
        <span class="jass-comment">// to be mostly finished.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">WaitForSoundBJ</span>(soundHandle, timeVal)

    <span class="jass-keyword">elseif</span> (timeType <span class="jass-op">==</span> <span class="jass-const">bj_TIMETYPE_ADD</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the transmission is extending beyond the sound's length, wait</span>
        <span class="jass-comment">// for it to finish, and then wait the additional time.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">WaitForSoundBJ</span>(soundHandle, <span class="jass-number">0</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerSleepAction</span>(timeVal)

    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized timeType - ignore.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DoTransmissionBasicsXYBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId, <span class="jass-type">playercolor</span> color, <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">sound</span> soundHandle, <span class="jass-type">string</span> unitName, <span class="jass-type">string</span> message, <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCinematicSceneBJ</span>(soundHandle, unitId, color, unitName, message, duration <span class="jass-op">+</span> <span class="jass-const">bj_TRANSMISSION_PORT_HANGTIME</span>, duration)

    <span class="jass-keyword">if</span> (unitId <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PingMinimap</span>(x, y, <span class="jass-const">bj_TRANSMISSION_PING_TIME</span>)
        <span class="jass-comment">//call SetCameraQuickPosition(x, y)</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Display a text message to a Player Group with an accompanying sound,</span>
<span class="jass-comment">// portrait, speech indicator, and all that good stuff.</span>
<span class="jass-comment">//   - Query duration of sound</span>
<span class="jass-comment">//   - Play sound</span>
<span class="jass-comment">//   - Display text message for duration</span>
<span class="jass-comment">//   - Display animating portrait for duration</span>
<span class="jass-comment">//   - Display a speech indicator for the unit</span>
<span class="jass-comment">//   - Ping the minimap</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TransmissionFromUnitWithNameBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> toForce, <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> unitName, <span class="jass-type">sound</span> soundHandle, <span class="jass-type">string</span> message, <span class="jass-type">integer</span> timeType, <span class="jass-type">real</span> timeVal, <span class="jass-type">boolean</span> wait <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TryInitCinematicBehaviorBJ</span>()

    <span class="jass-comment">// Ensure that the time value is non-negative.</span>
    <span class="jass-keyword">set</span> timeVal <span class="jass-op">=</span> <span class="jass-blizzard-j-function">RMaxBJ</span>(timeVal, <span class="jass-number">0</span>)

    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastTransmissionDuration</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetTransmissionDuration</span>(soundHandle, timeType, timeVal)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastPlayedSound</span> <span class="jass-op">=</span> soundHandle

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), toForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

        <span class="jass-keyword">if</span> (whichUnit <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
            <span class="jass-comment">// If the unit reference is invalid, send the transmission from the center of the map with no portrait.</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">DoTransmissionBasicsXYBJ</span>(<span class="jass-number">0</span>, <span class="jass-const">PLAYER_COLOR_RED</span>, <span class="jass-number">0</span>, <span class="jass-number">0</span>, soundHandle, unitName, message, <span class="jass-const">bj_lastTransmissionDuration</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">DoTransmissionBasicsXYBJ</span>(<span class="jass-common-j-native">GetUnitTypeId</span>(whichUnit), <span class="jass-common-j-native">GetPlayerColor</span>(<span class="jass-common-j-native">GetOwningPlayer</span>(whichUnit)), <span class="jass-common-j-native">GetUnitX</span>(whichUnit), <span class="jass-common-j-native">GetUnitY</span>(whichUnit), soundHandle, unitName, message, <span class="jass-const">bj_lastTransmissionDuration</span>)
            <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-common-j-native">IsUnitHidden</span>(whichUnit)) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitAddIndicator</span>(whichUnit, <span class="jass-const">bj_TRANSMISSION_IND_RED</span>, <span class="jass-const">bj_TRANSMISSION_IND_BLUE</span>, <span class="jass-const">bj_TRANSMISSION_IND_GREEN</span>, <span class="jass-const">bj_TRANSMISSION_IND_ALPHA</span>)
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> wait <span class="jass-keyword">and</span> (<span class="jass-const">bj_lastTransmissionDuration</span> <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// call TriggerSleepAction(bj_lastTransmissionDuration)</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">WaitTransmissionDuration</span>(soundHandle, timeType, timeVal)
    <span class="jass-keyword">endif</span>

<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// This operates like TransmissionFromUnitWithNameBJ, but for a unit type</span>
<span class="jass-comment">// rather than a unit instance.  As such, no speech indicator is employed.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TransmissionFromUnitTypeWithNameBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">force</span> toForce, <span class="jass-type">player</span> fromPlayer, <span class="jass-type">integer</span> unitId, <span class="jass-type">string</span> unitName, <span class="jass-type">location</span> loc, <span class="jass-type">sound</span> soundHandle, <span class="jass-type">string</span> message, <span class="jass-type">integer</span> timeType, <span class="jass-type">real</span> timeVal, <span class="jass-type">boolean</span> wait <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TryInitCinematicBehaviorBJ</span>()

    <span class="jass-comment">// Ensure that the time value is non-negative.</span>
    <span class="jass-keyword">set</span> timeVal <span class="jass-op">=</span> <span class="jass-blizzard-j-function">RMaxBJ</span>(timeVal, <span class="jass-number">0</span>)

    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastTransmissionDuration</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetTransmissionDuration</span>(soundHandle, timeType, timeVal)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastPlayedSound</span> <span class="jass-op">=</span> soundHandle

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), toForce)) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">DoTransmissionBasicsXYBJ</span>(unitId, <span class="jass-common-j-native">GetPlayerColor</span>(fromPlayer), <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), soundHandle, unitName, message, <span class="jass-const">bj_lastTransmissionDuration</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> wait <span class="jass-keyword">and</span> (<span class="jass-const">bj_lastTransmissionDuration</span> <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// call TriggerSleepAction(bj_lastTransmissionDuration)</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">WaitTransmissionDuration</span>(soundHandle, timeType, timeVal)
    <span class="jass-keyword">endif</span>

<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastTransmissionDurationBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastTransmissionDuration</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ForceCinematicSubtitlesBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceCinematicSubtitles</span>(flag)
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Cinematic Mode Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Makes many common UI settings changes at once, for use when beginning and</span>
<span class="jass-comment">// ending cinematic sequences.  Note that some affects apply to all players,</span>
<span class="jass-comment">// such as game speed.  This is unavoidable.</span>
<span class="jass-comment">//   - Clear the screen of text messages</span>
<span class="jass-comment">//   - Hide interface UI (letterbox mode)</span>
<span class="jass-comment">//   - Hide game messages (ally under attack, etc.)</span>
<span class="jass-comment">//   - Disable user control</span>
<span class="jass-comment">//   - Disable occlusion</span>
<span class="jass-comment">//   - Set game speed (for all players)</span>
<span class="jass-comment">//   - Lock game speed (for all players)</span>
<span class="jass-comment">//   - Disable black mask (for all players)</span>
<span class="jass-comment">//   - Disable fog of war (for all players)</span>
<span class="jass-comment">//   - Disable world boundary fog (for all players)</span>
<span class="jass-comment">//   - Dim non-speech sound channels</span>
<span class="jass-comment">//   - End any outstanding music themes</span>
<span class="jass-comment">//   - Fix the random seed to a set value</span>
<span class="jass-comment">//   - Reset the camera smoothing factor</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CinematicModeExBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> cineMode, <span class="jass-type">force</span> forForce, <span class="jass-type">real</span> interfaceFadeTime <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// If the game hasn't started yet, perform interface fades immediately</span>
    <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_gameStarted</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> interfaceFadeTime <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (cineMode) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Save the UI state so that we can restore it later.</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_cineModeAlreadyIn</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModeAlreadyIn</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorSpeed</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetGameSpeed</span>()
            <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorFogSetting</span> <span class="jass-op">=</span> <span class="jass-common-j-native">IsFogEnabled</span>()
            <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorMaskSetting</span> <span class="jass-op">=</span> <span class="jass-common-j-native">IsFogMaskEnabled</span>()
            <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorDawnDusk</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">IsDawnDuskEnabled</span>()
            <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModeSavedSeed</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">0</span>, <span class="jass-number">1000000</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// Perform local changes</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), forForce)) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ClearTextMessages</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowInterface</span>(<span class="jass-const">false</span>, interfaceFadeTime)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserControl</span>(<span class="jass-const">false</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableOcclusion</span>(<span class="jass-const">false</span>)
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCineModeVolumeGroupsBJ</span>()
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// Perform global changes</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameSpeed</span>(<span class="jass-const">bj_CINEMODE_GAMESPEED</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMapFlag</span>(<span class="jass-const">MAP_LOCK_SPEED</span>, <span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogMaskEnable</span>(<span class="jass-const">false</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogEnable</span>(<span class="jass-const">false</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableWorldFogBoundary</span>(<span class="jass-const">false</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">EnableDawnDusk</span>(<span class="jass-const">false</span>)

        <span class="jass-comment">// Use a fixed random seed, so that cinematics play consistently.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetRandomSeed</span>(<span class="jass-number">0</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModeAlreadyIn</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

        <span class="jass-comment">// Perform local changes</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerInForce</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), forForce)) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ShowInterface</span>(<span class="jass-const">true</span>, interfaceFadeTime)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserControl</span>(<span class="jass-const">true</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableOcclusion</span>(<span class="jass-const">true</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">VolumeGroupReset</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">EndThematicMusic</span>()
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CameraResetSmoothingFactorBJ</span>()
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// Perform global changes</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMapFlag</span>(<span class="jass-const">MAP_LOCK_SPEED</span>, <span class="jass-const">false</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetGameSpeed</span>(<span class="jass-const">bj_cineModePriorSpeed</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogMaskEnable</span>(<span class="jass-const">bj_cineModePriorMaskSetting</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">FogEnable</span>(<span class="jass-const">bj_cineModePriorFogSetting</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableWorldFogBoundary</span>(<span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">EnableDawnDusk</span>(<span class="jass-const">bj_cineModePriorDawnDusk</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetRandomSeed</span>(<span class="jass-const">bj_cineModeSavedSeed</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CinematicModeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> cineMode, <span class="jass-type">force</span> forForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CinematicModeExBJ</span>(cineMode, forForce, <span class="jass-const">bj_CINEMODE_INTERFACEFADE</span>)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Cinematic Filter Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DisplayCineFilterBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> flag <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayCineFilter</span>(flag)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CinematicFadeCommonBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> duration, <span class="jass-type">string</span> tex, <span class="jass-type">real</span> startTrans, <span class="jass-type">real</span> endTrans <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (duration <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the fade is instant, use the same starting and ending values,</span>
        <span class="jass-comment">// so that we effectively do a set rather than a fade.</span>
        <span class="jass-keyword">set</span> startTrans <span class="jass-op">=</span> endTrans
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserUI</span>(<span class="jass-const">false</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterTexture</span>(tex)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterBlendMode</span>(<span class="jass-const">BLEND_MODE_BLEND</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterTexMapFlags</span>(<span class="jass-const">TEXMAP_FLAG_NONE</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterStartUV</span>(<span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">1</span>, <span class="jass-number">1</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterEndUV</span>(<span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">1</span>, <span class="jass-number">1</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterStartColor</span>(<span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100</span><span class="jass-op">-</span>startTrans))
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterEndColor</span>(<span class="jass-blizzard-j-function">PercentTo255</span>(red), <span class="jass-blizzard-j-function">PercentTo255</span>(green), <span class="jass-blizzard-j-function">PercentTo255</span>(blue), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100</span><span class="jass-op">-</span>endTrans))
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterDuration</span>(duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayCineFilter</span>(<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FinishCinematicFadeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(<span class="jass-const">bj_cineFadeFinishTimer</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeFinishTimer</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayCineFilter</span>(<span class="jass-const">false</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">EnableUserUI</span>(<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FinishCinematicFadeAfterBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Create a timer to end the cinematic fade.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeFinishTimer</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_cineFadeFinishTimer</span>, duration, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FinishCinematicFadeBJ</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ContinueCinematicFadeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(<span class="jass-const">bj_cineFadeContinueTimer</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueTimer</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CinematicFadeCommonBJ</span>(<span class="jass-const">bj_cineFadeContinueRed</span>, <span class="jass-const">bj_cineFadeContinueGreen</span>, <span class="jass-const">bj_cineFadeContinueBlue</span>, <span class="jass-const">bj_cineFadeContinueDuration</span>, <span class="jass-const">bj_cineFadeContinueTex</span>, <span class="jass-const">bj_cineFadeContinueTrans</span>, <span class="jass-number">100</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ContinueCinematicFadeAfterBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> trans, <span class="jass-type">string</span> tex <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueRed</span> <span class="jass-op">=</span> red
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueGreen</span> <span class="jass-op">=</span> green
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueBlue</span> <span class="jass-op">=</span> blue
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueTrans</span> <span class="jass-op">=</span> trans
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueDuration</span> <span class="jass-op">=</span> duration
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueTex</span> <span class="jass-op">=</span> tex

    <span class="jass-comment">// Create a timer to continue the cinematic fade.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineFadeContinueTimer</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_cineFadeContinueTimer</span>, duration, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ContinueCinematicFadeBJ</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AbortCinematicFadeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_cineFadeContinueTimer</span> <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(<span class="jass-const">bj_cineFadeContinueTimer</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (<span class="jass-const">bj_cineFadeFinishTimer</span> <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(<span class="jass-const">bj_cineFadeFinishTimer</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CinematicFadeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> fadetype, <span class="jass-type">real</span> duration, <span class="jass-type">string</span> tex, <span class="jass-type">real</span> red, <span class="jass-type">real</span> green, <span class="jass-type">real</span> blue, <span class="jass-type">real</span> trans <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (fadetype <span class="jass-op">==</span> <span class="jass-const">bj_CINEFADETYPE_FADEOUT</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Fade out to the requested color.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AbortCinematicFadeBJ</span>()
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CinematicFadeCommonBJ</span>(red, green, blue, duration, tex, <span class="jass-number">100</span>, trans)
    <span class="jass-keyword">elseif</span> (fadetype <span class="jass-op">==</span> <span class="jass-const">bj_CINEFADETYPE_FADEIN</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Fade in from the requested color.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AbortCinematicFadeBJ</span>()
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CinematicFadeCommonBJ</span>(red, green, blue, duration, tex, trans, <span class="jass-number">100</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">FinishCinematicFadeAfterBJ</span>(duration)
    <span class="jass-keyword">elseif</span> (fadetype <span class="jass-op">==</span> <span class="jass-const">bj_CINEFADETYPE_FADEOUTIN</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Fade out to the requested color, and then fade back in from it.</span>
        <span class="jass-keyword">if</span> (duration <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AbortCinematicFadeBJ</span>()
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CinematicFadeCommonBJ</span>(red, green, blue, duration <span class="jass-op">*</span> <span class="jass-number">0.5</span>, tex, <span class="jass-number">100</span>, trans)
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ContinueCinematicFadeAfterBJ</span>(duration <span class="jass-op">*</span> <span class="jass-number">0.5</span>, red, green, blue, trans, tex)
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">FinishCinematicFadeAfterBJ</span>(duration)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized fadetype - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CinematicFilterGenericBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> duration, <span class="jass-type">blendmode</span> bmode, <span class="jass-type">string</span> tex, <span class="jass-type">real</span> red0, <span class="jass-type">real</span> green0, <span class="jass-type">real</span> blue0, <span class="jass-type">real</span> trans0, <span class="jass-type">real</span> red1, <span class="jass-type">real</span> green1, <span class="jass-type">real</span> blue1, <span class="jass-type">real</span> trans1 <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AbortCinematicFadeBJ</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterTexture</span>(tex)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterBlendMode</span>(bmode)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterTexMapFlags</span>(<span class="jass-const">TEXMAP_FLAG_NONE</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterStartUV</span>(<span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">1</span>, <span class="jass-number">1</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterEndUV</span>(<span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-number">1</span>, <span class="jass-number">1</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterStartColor</span>(<span class="jass-blizzard-j-function">PercentTo255</span>(red0), <span class="jass-blizzard-j-function">PercentTo255</span>(green0), <span class="jass-blizzard-j-function">PercentTo255</span>(blue0), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100</span><span class="jass-op">-</span>trans0))
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterEndColor</span>(<span class="jass-blizzard-j-function">PercentTo255</span>(red1), <span class="jass-blizzard-j-function">PercentTo255</span>(green1), <span class="jass-blizzard-j-function">PercentTo255</span>(blue1), <span class="jass-blizzard-j-function">PercentTo255</span>(<span class="jass-number">100</span><span class="jass-op">-</span>trans1))
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCineFilterDuration</span>(duration)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayCineFilter</span>(<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Rescuable Unit Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Rescues a unit for a player.  This performs the default rescue behavior,</span>
<span class="jass-comment">// including a rescue sound, flashing selection circle, ownership change,</span>
<span class="jass-comment">// and optionally a unit color change.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RescueUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">player</span> rescuer, <span class="jass-type">boolean</span> changeColor <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">IsUnitDeadBJ</span>(whichUnit) <span class="jass-keyword">or</span> (<span class="jass-common-j-native">GetOwningPlayer</span>(whichUnit) <span class="jass-op">==</span> rescuer) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_rescueSound</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitOwner</span>(whichUnit, rescuer, changeColor)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitAddIndicator</span>(whichUnit, <span class="jass-number">0</span>, <span class="jass-number">255</span>, <span class="jass-number">0</span>, <span class="jass-number">255</span>)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PingMinimapForPlayer</span>(rescuer, <span class="jass-common-j-native">GetUnitX</span>(whichUnit), <span class="jass-common-j-native">GetUnitY</span>(whichUnit), <span class="jass-const">bj_RESCUE_PING_TIME</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerActionUnitRescuedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> theUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetTriggerUnit</span>()

    <span class="jass-keyword">if</span> <span class="jass-common-j-native">IsUnitType</span>(theUnit, <span class="jass-const">UNIT_TYPE_STRUCTURE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RescueUnitBJ</span>(theUnit, <span class="jass-common-j-native">GetOwningPlayer</span>(<span class="jass-common-j-native">GetRescuer</span>()), <span class="jass-const">bj_rescueChangeColorBldg</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RescueUnitBJ</span>(theUnit, <span class="jass-common-j-native">GetOwningPlayer</span>(<span class="jass-common-j-native">GetRescuer</span>()), <span class="jass-const">bj_rescueChangeColorUnit</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Attempt to init triggers for default rescue behavior.  For performance</span>
<span class="jass-comment">// reasons, this should only be attempted if a player is set to Rescuable,</span>
<span class="jass-comment">// or if a specific unit is thus flagged.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TryInitRescuableTriggersBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">if</span> (<span class="jass-const">bj_rescueUnitBehavior</span> <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_rescueUnitBehavior</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(<span class="jass-const">bj_rescueUnitBehavior</span>, <span class="jass-common-j-native">Player</span>(index), <span class="jass-const">EVENT_PLAYER_UNIT_RESCUED</span>, <span class="jass-type">null</span>)
            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
        <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_rescueUnitBehavior</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TriggerActionUnitRescuedBJ</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Determines whether or not rescued units automatically change color upon</span>
<span class="jass-comment">// being rescued.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetRescueUnitColorChangeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> changeColor <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_rescueChangeColorUnit</span> <span class="jass-op">=</span> changeColor
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Determines whether or not rescued buildings automatically change color</span>
<span class="jass-comment">// upon being rescued.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetRescueBuildingColorChangeBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> changeColor <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_rescueChangeColorBldg</span> <span class="jass-op">=</span> changeColor
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitRescuableToForceBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TryInitRescuableTriggersBJ</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitRescuable</span>(<span class="jass-const">bj_makeUnitRescuableUnit</span>, <span class="jass-common-j-native">GetEnumPlayer</span>(), <span class="jass-const">bj_makeUnitRescuableFlag</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitRescuableToForceBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">boolean</span> isRescuable, <span class="jass-type">force</span> whichForce <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Flag the unit as rescuable/unrescuable for the appropriate players.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_makeUnitRescuableUnit</span> <span class="jass-op">=</span> whichUnit
    <span class="jass-keyword">set</span> <span class="jass-const">bj_makeUnitRescuableFlag</span> <span class="jass-op">=</span> isRescuable
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(whichForce, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MakeUnitRescuableToForceBJEnum</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitRescuableBehaviorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-comment">// If at least one player slot is "Rescuable"-controlled, init the</span>
        <span class="jass-comment">// rescue behavior triggers.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(<span class="jass-common-j-native">Player</span>(index)) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_RESCUABLE</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TryInitRescuableTriggersBJ</span>()
            <span class="jass-keyword">return</span>
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Research and Upgrade Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerTechResearchedSwap</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> techid, <span class="jass-type">integer</span> levels, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechResearched</span>(whichPlayer, techid, levels)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerTechMaxAllowedSwap</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> techid, <span class="jass-type">integer</span> maximum, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(whichPlayer, techid, maximum)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerMaxHeroesAllowed</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> maximum, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(whichPlayer, <span class="jass-number">'HERO'</span>, maximum)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerTechCountSimple</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> techid, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerTechCount</span>(whichPlayer, techid, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerTechMaxAllowedSwap</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> techid, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerTechMaxAllowed</span>(whichPlayer, techid)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerAbilityAvailableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> avail, <span class="jass-type">integer</span> abilid, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerAbilityAvailable</span>(whichPlayer, abilid, avail)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Campaign Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCampaignMenuRaceBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> campaignNumber <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_T</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRace</span>(<span class="jass-const">RACE_OTHER</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_H</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRace</span>(<span class="jass-const">RACE_HUMAN</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_U</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRace</span>(<span class="jass-const">RACE_UNDEAD</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_O</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRace</span>(<span class="jass-const">RACE_ORC</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_N</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRace</span>(<span class="jass-const">RACE_NIGHTELF</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRaceEx</span>(<span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XH</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRaceEx</span>(<span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XU</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRaceEx</span>(<span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span>)
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XO</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignMenuRaceEx</span>(<span class="jass-const">bj_CAMPAIGN_OFFSET_XO</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized campaign - ignore the request</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Converts a single campaign mission designation into campaign and mission</span>
<span class="jass-comment">// numbers.  The 1000's digit is considered the campaign index, and the 1's</span>
<span class="jass-comment">// digit is considered the mission index within that campaign.  This is done</span>
<span class="jass-comment">// so that the trigger for this can use a single drop-down to list all of</span>
<span class="jass-comment">// the campaign missions.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetMissionAvailableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> available, <span class="jass-type">integer</span> missionIndex <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> campaignNumber <span class="jass-op">=</span> missionIndex <span class="jass-op">/</span> <span class="jass-number">1000</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> missionNumber <span class="jass-op">=</span> missionIndex <span class="jass-op">-</span> campaignNumber <span class="jass-op">*</span> <span class="jass-number">1000</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMissionAvailable</span>(campaignNumber, missionNumber, available)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCampaignAvailableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> available, <span class="jass-type">integer</span> campaignNumber <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> campaignOffset

    <span class="jass-keyword">if</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_H</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTutorialCleared</span>(<span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> campaignOffset <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span>
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XH</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> campaignOffset <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XH</span>
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XU</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> campaignOffset <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span>
    <span class="jass-keyword">elseif</span> (campaignNumber <span class="jass-op">==</span> <span class="jass-const">bj_CAMPAIGN_INDEX_XO</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> campaignOffset <span class="jass-op">=</span> <span class="jass-const">bj_CAMPAIGN_OFFSET_XO</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> campaignOffset <span class="jass-op">=</span> campaignNumber
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCampaignAvailable</span>(campaignOffset, available)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCampaignMenuRaceBJ</span>(campaignNumber)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceCampaignSelectScreen</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetCinematicAvailableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> available, <span class="jass-type">integer</span> cinematicIndex <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> ( cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_TOP</span> ) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetOpCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_T</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"TutorialOp"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_HOP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetOpCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_H</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"HumanOp"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_HED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_H</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"HumanEd"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_OOP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetOpCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_O</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"OrcOp"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_OED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_O</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"OrcEd"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_UOP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_U</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"UndeadOp"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_UED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_U</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"UndeadEd"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_NOP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_N</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"NightElfOp"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_NED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_INDEX_N</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"NightElfEd"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_XOP</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetOpCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_OFFSET_XN</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"IntroX"</span> )
    <span class="jass-keyword">elseif</span> (cinematicIndex <span class="jass-op">==</span> <span class="jass-const">bj_CINEMATICINDEX_XED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetEdCinematicAvailable</span>( <span class="jass-const">bj_CAMPAIGN_OFFSET_XU</span>, available )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">PlayCinematic</span>( <span class="jass-string">"OutroX"</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized cinematic - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitGameCacheBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> campaignFile <span class="jass-keyword">returns</span> <span class="jass-type">gamecache</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastCreatedGameCache</span> <span class="jass-op">=</span> <span class="jass-common-j-native">InitGameCache</span>(campaignFile)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedGameCache</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SaveGameCacheBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">SaveGameCache</span>(cache)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastCreatedGameCacheBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">gamecache</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastCreatedGameCache</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StoreRealBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> value, <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StoreReal</span>(cache, missionKey, key, value)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StoreIntegerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> value, <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StoreInteger</span>(cache, missionKey, key, value)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StoreBooleanBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> value, <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">StoreBoolean</span>(cache, missionKey, key, value)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StoreStringBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> value, <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">StoreString</span>(cache, missionKey, key, value)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StoreUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">StoreUnit</span>(cache, missionKey, key, whichUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetStoredRealBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-comment">//call SyncStoredReal(cache, missionKey, key)</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetStoredReal</span>(cache, missionKey, key)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetStoredIntegerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-comment">//call SyncStoredInteger(cache, missionKey, key)</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetStoredInteger</span>(cache, missionKey, key)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetStoredBooleanBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-comment">//call SyncStoredBoolean(cache, missionKey, key)</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetStoredBoolean</span>(cache, missionKey, key)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetStoredStringBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">local</span> <span class="jass-type">string</span> s

    <span class="jass-comment">//call SyncStoredString(cache, missionKey, key)</span>
    <span class="jass-keyword">set</span> s <span class="jass-op">=</span> <span class="jass-common-j-native">GetStoredString</span>(cache, missionKey, key)
    <span class="jass-keyword">if</span> (s <span class="jass-op">==</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-string">""</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> s
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RestoreUnitLocFacingAngleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache, <span class="jass-type">player</span> forWhichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> facing <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-comment">//call SyncStoredUnit(cache, missionKey, key)</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastLoadedUnit</span> <span class="jass-op">=</span> <span class="jass-common-j-native">RestoreUnit</span>(cache, missionKey, key, forWhichPlayer, <span class="jass-common-j-native">GetLocationX</span>(loc), <span class="jass-common-j-native">GetLocationY</span>(loc), facing)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastLoadedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RestoreUnitLocFacingPointBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache, <span class="jass-type">player</span> forWhichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">location</span> lookAt <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-comment">//call SyncStoredUnit(cache, missionKey, key)</span>
    <span class="jass-keyword">return</span> <span class="jass-blizzard-j-function">RestoreUnitLocFacingAngleBJ</span>(key, missionKey, cache, forWhichPlayer, loc, <span class="jass-blizzard-j-function">AngleBetweenPoints</span>(loc, lookAt))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastRestoredUnitBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastLoadedUnit</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FlushGameCacheBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlushGameCache</span>(cache)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FlushStoredMissionBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">FlushStoredMission</span>(cache, missionKey)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">HaveStoredValue</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> key, <span class="jass-type">integer</span> valueType, <span class="jass-type">string</span> missionKey, <span class="jass-type">gamecache</span> cache <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">if</span> (valueType <span class="jass-op">==</span> <span class="jass-const">bj_GAMECACHE_BOOLEAN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">HaveStoredBoolean</span>(cache, missionKey, key)
    <span class="jass-keyword">elseif</span> (valueType <span class="jass-op">==</span> <span class="jass-const">bj_GAMECACHE_INTEGER</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">HaveStoredInteger</span>(cache, missionKey, key)
    <span class="jass-keyword">elseif</span> (valueType <span class="jass-op">==</span> <span class="jass-const">bj_GAMECACHE_REAL</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">HaveStoredReal</span>(cache, missionKey, key)
    <span class="jass-keyword">elseif</span> (valueType <span class="jass-op">==</span> <span class="jass-const">bj_GAMECACHE_UNIT</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">HaveStoredUnit</span>(cache, missionKey, key)
    <span class="jass-keyword">elseif</span> (valueType <span class="jass-op">==</span> <span class="jass-const">bj_GAMECACHE_STRING</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">HaveStoredString</span>(cache, missionKey, key)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized value type - ignore the request.</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ShowCustomCampaignButton</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> show, <span class="jass-type">integer</span> whichButton <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetCustomCampaignButtonVisible</span>(whichButton <span class="jass-op">-</span> <span class="jass-number">1</span>, show)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsCustomCampaignButtonVisibile</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> whichButton <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetCustomCampaignButtonVisible</span>(whichButton <span class="jass-op">-</span> <span class="jass-number">1</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LoadGameBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> loadFileName, <span class="jass-type">boolean</span> doScoreScreen <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LoadGame</span>(loadFileName, doScoreScreen)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SaveAndChangeLevelBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> saveFileName, <span class="jass-type">string</span> newLevel, <span class="jass-type">boolean</span> doScoreScreen <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SaveGame</span>(saveFileName)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ChangeLevel</span>(newLevel, doScoreScreen)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SaveAndLoadGameBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> saveFileName, <span class="jass-type">string</span> loadFileName, <span class="jass-type">boolean</span> doScoreScreen <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SaveGame</span>(saveFileName)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">LoadGame</span>(loadFileName, doScoreScreen)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RenameSaveDirectoryBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> sourceDirName, <span class="jass-type">string</span> destDirName <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">RenameSaveDirectory</span>(sourceDirName, destDirName)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemoveSaveDirectoryBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> sourceDirName <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">RemoveSaveDirectory</span>(sourceDirName)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CopySaveGameBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">string</span> sourceSaveName, <span class="jass-type">string</span> destSaveName <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">CopySaveGame</span>(sourceSaveName, destSaveName)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Miscellaneous Utility Functions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerStartLocationX</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetStartLocationX</span>(<span class="jass-common-j-native">GetPlayerStartLocation</span>(whichPlayer))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerStartLocationY</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetStartLocationY</span>(<span class="jass-common-j-native">GetPlayerStartLocation</span>(whichPlayer))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerStartLocationLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetStartLocationLoc</span>(<span class="jass-common-j-native">GetPlayerStartLocation</span>(whichPlayer))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRectCenter</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> whichRect <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(<span class="jass-common-j-native">GetRectCenterX</span>(whichRect), <span class="jass-common-j-native">GetRectCenterY</span>(whichRect))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsPlayerSlotState</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playerslotstate</span> whichState <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerSlotState</span>(whichPlayer) <span class="jass-op">==</span> whichState
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetFadeFromSeconds</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> seconds <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">if</span> (seconds <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-number">128</span> <span class="jass-op">/</span> seconds
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> <span class="jass-number">10000</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AdjustPlayerStateSimpleBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playerstate</span> whichPlayerState, <span class="jass-type">integer</span> delta <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, whichPlayerState, <span class="jass-common-j-native">GetPlayerState</span>(whichPlayer, whichPlayerState) <span class="jass-op">+</span> delta)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AdjustPlayerStateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> delta, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playerstate</span> whichPlayerState <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// If the change was positive, apply the difference to the player's</span>
    <span class="jass-comment">// gathered resources property as well.</span>
    <span class="jass-keyword">if</span> (delta <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> (whichPlayerState <span class="jass-op">==</span> <span class="jass-const">PLAYER_STATE_RESOURCE_GOLD</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AdjustPlayerStateSimpleBJ</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_GOLD_GATHERED</span>, delta)
        <span class="jass-keyword">elseif</span> (whichPlayerState <span class="jass-op">==</span> <span class="jass-const">PLAYER_STATE_RESOURCE_LUMBER</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AdjustPlayerStateSimpleBJ</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_LUMBER_GATHERED</span>, delta)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AdjustPlayerStateSimpleBJ</span>(whichPlayer, whichPlayerState, delta)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerStateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playerstate</span> whichPlayerState, <span class="jass-type">integer</span> value <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> oldValue <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerState</span>(whichPlayer, whichPlayerState)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">AdjustPlayerStateBJ</span>(value <span class="jass-op">-</span> oldValue, whichPlayer, whichPlayerState)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerFlagBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">playerstate</span> whichPlayerFlag, <span class="jass-type">boolean</span> flag, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, whichPlayerFlag, <span class="jass-blizzard-j-function">IntegerTertiaryOp</span>(flag, <span class="jass-number">1</span>, <span class="jass-number">0</span>))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerTaxRateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> rate, <span class="jass-type">playerstate</span> whichResource, <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTaxRate</span>(sourcePlayer, otherPlayer, whichResource, rate)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetPlayerTaxRateBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">playerstate</span> whichResource, <span class="jass-type">player</span> sourcePlayer, <span class="jass-type">player</span> otherPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerTaxRate</span>(sourcePlayer, otherPlayer, whichResource)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsPlayerFlagSetBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">playerstate</span> whichPlayerFlag, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerState</span>(whichPlayer, whichPlayerFlag) <span class="jass-op">==</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">AddResourceAmountBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> delta, <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddResourceAmount</span>(whichUnit, delta)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetConvertedPlayerId</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetPlayerId</span>(whichPlayer) <span class="jass-op">+</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ConvertedPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> convertedPlayerId <span class="jass-keyword">returns</span> <span class="jass-type">player</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Player</span>(convertedPlayerId <span class="jass-op">-</span> <span class="jass-number">1</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRectWidthBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetRectMaxX</span>(r) <span class="jass-op">-</span> <span class="jass-common-j-native">GetRectMinX</span>(r)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetRectHeightBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetRectMaxY</span>(r) <span class="jass-op">-</span> <span class="jass-common-j-native">GetRectMinY</span>(r)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Replaces a gold mine with a blighted gold mine for the given player.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">BlightGoldMineForPlayerBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> goldMine, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>    mineX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>    mineY
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> mineGold
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>    newMine

    <span class="jass-comment">// Make sure we're replacing a Gold Mine and not some other type of unit.</span>
    <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetUnitTypeId</span>(goldMine) <span class="jass-op">!=</span> <span class="jass-number">'ngol'</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Save the Gold Mine's properties and remove it.</span>
    <span class="jass-keyword">set</span> mineX    <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitX</span>(goldMine)
    <span class="jass-keyword">set</span> mineY    <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitY</span>(goldMine)
    <span class="jass-keyword">set</span> mineGold <span class="jass-op">=</span> <span class="jass-common-j-native">GetResourceAmount</span>(goldMine)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveUnit</span>(goldMine)

    <span class="jass-comment">// Create a Haunted Gold Mine to replace the Gold Mine.</span>
    <span class="jass-keyword">set</span> newMine <span class="jass-op">=</span> <span class="jass-common-j-native">CreateBlightedGoldmine</span>(whichPlayer, mineX, mineY, <span class="jass-const">bj_UNIT_FACING</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetResourceAmount</span>(newMine, mineGold)
    <span class="jass-keyword">return</span> newMine
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">BlightGoldMineForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> goldMine, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastHauntedGoldMine</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">BlightGoldMineForPlayerBJ</span>(goldMine, whichPlayer)
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastHauntedGoldMine</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetLastHauntedGoldMine</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">return</span> <span class="jass-const">bj_lastHauntedGoldMine</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IsPointBlightedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> where <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsPointBlighted</span>(<span class="jass-common-j-native">GetLocationX</span>(where), <span class="jass-common-j-native">GetLocationY</span>(where))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerColorBJEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitColor</span>(<span class="jass-common-j-native">GetEnumUnit</span>(), <span class="jass-const">bj_setPlayerTargetColor</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerColorBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">playercolor</span> color, <span class="jass-type">boolean</span> changeExisting <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerColor</span>(whichPlayer, color)
    <span class="jass-keyword">if</span> changeExisting <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_setPlayerTargetColor</span> <span class="jass-op">=</span> color
        <span class="jass-keyword">set</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfPlayer</span>(g, whichPlayer, <span class="jass-type">null</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerColorBJEnum</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerUnitAvailableBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> unitId, <span class="jass-type">boolean</span> allowed, <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> allowed <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(whichPlayer, unitId, <span class="jass-op">-</span><span class="jass-number">1</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(whichPlayer, unitId, <span class="jass-number">0</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LockGameSpeedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMapFlag</span>(<span class="jass-const">MAP_LOCK_SPEED</span>, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnlockGameSpeedBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetMapFlag</span>(<span class="jass-const">MAP_LOCK_SPEED</span>, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueTargetOrderBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> order, <span class="jass-type">widget</span> targetWidget <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueTargetOrder</span>( whichUnit, order, targetWidget )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssuePointOrderLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> order, <span class="jass-type">location</span> whichLocation <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssuePointOrderLoc</span>( whichUnit, order, whichLocation )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Two distinct trigger actions can't share the same function name, so this</span>
<span class="jass-comment">// dummy function simply mimics the behavior of an existing call.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueTargetDestructableOrder</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> order, <span class="jass-type">widget</span> targetWidget <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueTargetOrder</span>( whichUnit, order, targetWidget )
<span class="jass-keyword">endfunction</span>

<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueTargetItemOrder</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> order, <span class="jass-type">widget</span> targetWidget <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueTargetOrder</span>( whichUnit, order, targetWidget )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueImmediateOrderBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">string</span> order <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IssueImmediateOrder</span>( whichUnit, order )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupTargetOrderBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup, <span class="jass-type">string</span> order, <span class="jass-type">widget</span> targetWidget <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GroupTargetOrder</span>( whichGroup, order, targetWidget )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupPointOrderLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup, <span class="jass-type">string</span> order, <span class="jass-type">location</span> whichLocation <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GroupPointOrderLoc</span>( whichGroup, order, whichLocation )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupImmediateOrderBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup, <span class="jass-type">string</span> order <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GroupImmediateOrder</span>( whichGroup, order )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Two distinct trigger actions can't share the same function name, so this</span>
<span class="jass-comment">// dummy function simply mimics the behavior of an existing call.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupTargetDestructableOrder</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup, <span class="jass-type">string</span> order, <span class="jass-type">widget</span> targetWidget <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GroupTargetOrder</span>( whichGroup, order, targetWidget )
<span class="jass-keyword">endfunction</span>

<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GroupTargetItemOrder</span> <span class="jass-keyword">takes</span> <span class="jass-type">group</span> whichGroup, <span class="jass-type">string</span> order, <span class="jass-type">widget</span> targetWidget <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GroupTargetOrder</span>( whichGroup, order, targetWidget )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetDyingDestructable</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">destructable</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetTriggerWidget</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Rally point setting</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitRallyPoint</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">location</span> targPos <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">IssuePointOrderLocBJ</span>(whichUnit, <span class="jass-string">"setrally"</span>, targPos)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitRallyUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">unit</span> targUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">IssueTargetOrder</span>(whichUnit, <span class="jass-string">"setrally"</span>, targUnit)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetUnitRallyDestructable</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit, <span class="jass-type">destructable</span> targDest <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">IssueTargetOrder</span>(whichUnit, <span class="jass-string">"setrally"</span>, targDest)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Utility function for use by editor-generated item drop table triggers.</span>
<span class="jass-comment">// This function is added as an action to all destructable drop triggers,</span>
<span class="jass-comment">// so that a widget drop may be differentiated from a unit drop.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SaveDyingWidget</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_lastDyingWidget</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetTriggerWidget</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetBlightRectBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> addBlight, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetBlightRect</span>(whichPlayer, r, addBlight)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetBlightRadiusLocBJ</span> <span class="jass-keyword">takes</span> <span class="jass-type">boolean</span> addBlight, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">real</span> radius <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetBlightLoc</span>(whichPlayer, loc, radius, addBlight)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetAbilityName</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> abilcode <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetObjectName</span>(abilcode)
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Visibility Settings</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingVisibility</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Start by setting the ToD.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetFloatGameState</span>(<span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">bj_MELEE_STARTING_TOD</span>)

    <span class="jass-comment">// call FogMaskEnable(true)</span>
    <span class="jass-comment">// call FogEnable(true)</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Starting Resources</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingResources</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">version</span> v
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> startingGold
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> startingLumber

    <span class="jass-keyword">set</span> v <span class="jass-op">=</span> <span class="jass-common-j-native">VersionGet</span>()
    <span class="jass-keyword">if</span> (v <span class="jass-op">==</span> <span class="jass-const">VERSION_REIGN_OF_CHAOS</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> startingGold <span class="jass-op">=</span> <span class="jass-const">bj_MELEE_STARTING_GOLD_V0</span>
        <span class="jass-keyword">set</span> startingLumber <span class="jass-op">=</span> <span class="jass-const">bj_MELEE_STARTING_LUMBER_V0</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> startingGold <span class="jass-op">=</span> <span class="jass-const">bj_MELEE_STARTING_GOLD_V1</span>
        <span class="jass-keyword">set</span> startingLumber <span class="jass-op">=</span> <span class="jass-const">bj_MELEE_STARTING_LUMBER_V1</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Set each player's starting resources.</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerSlotState</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(indexPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_GOLD</span>, startingGold)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(indexPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_LUMBER</span>, startingLumber)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Hero Limit</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">integer</span> techId, <span class="jass-type">integer</span> limit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> oldMax <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerTechMaxAllowed</span>(whichPlayer, techId)

    <span class="jass-comment">// A value of -1 is used to indicate no limit, so check for that as well.</span>
    <span class="jass-keyword">if</span> (oldMax <span class="jass-op">&lt;</span> <span class="jass-number">0</span> <span class="jass-keyword">or</span> oldMax <span class="jass-op">&gt;</span> limit) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(whichPlayer, techId, limit)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingHeroLimit</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-comment">// max heroes per player</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetPlayerMaxHeroesAllowed</span>(<span class="jass-const">bj_MELEE_HERO_LIMIT</span>, <span class="jass-common-j-native">Player</span>(index))

        <span class="jass-comment">// each player is restricted to a limit per hero type as well</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Hamg'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Hmkg'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Hpal'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Hblm'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)

        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Obla'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Ofar'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Otch'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Oshd'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)

        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Edem'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Ekee'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Emoo'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Ewar'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)

        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Udea'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Udre'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Ulic'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Ucrl'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)

        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Npbm'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Nbrn'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Nngs'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Nplh'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Nbst'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Nalc'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Ntin'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ReducePlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Nfir'</span>, <span class="jass-const">bj_MELEE_HERO_TYPE_LIMIT</span>)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Granted Hero Items</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTrainedUnitIsHeroBJFilter</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">IsUnitType</span>(<span class="jass-common-j-native">GetFilterUnit</span>(), <span class="jass-const">UNIT_TYPE_HERO</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// The first N heroes trained or hired for each player start off with a</span>
<span class="jass-comment">// standard set of items.  This is currently:</span>
<span class="jass-comment">//   - 1x Scroll of Town Portal</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToHero</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> whichUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> owner   <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerId</span>(<span class="jass-common-j-native">GetOwningPlayer</span>(whichUnit))

    <span class="jass-comment">// If we haven't twinked N heroes for this player yet, twink away.</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_meleeTwinkedHeroes</span>[owner] <span class="jass-op">&lt;</span> <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">UnitAddItemById</span>(whichUnit, <span class="jass-number">'stwp'</span>)
        <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeTwinkedHeroes</span>[owner] <span class="jass-op">=</span> <span class="jass-const">bj_meleeTwinkedHeroes</span>[owner] <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToTrainedHero</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToHero</span>(<span class="jass-common-j-native">GetTrainedUnit</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToHiredHero</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToHero</span>(<span class="jass-common-j-native">GetSoldUnit</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGrantHeroItems</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span> trig

    <span class="jass-comment">// Initialize the twinked hero counts.</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeTwinkedHeroes</span>[index] <span class="jass-op">=</span> <span class="jass-number">0</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Register for an event whenever a hero is trained, so that we can give</span>
    <span class="jass-comment">// him/her their starting items.</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, <span class="jass-common-j-native">Player</span>(index), <span class="jass-const">EVENT_PLAYER_UNIT_TRAIN_FINISH</span>, filterMeleeTrainedUnitIsHeroBJ)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToTrainedHero</span>)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Register for an event whenever a neutral hero is hired, so that we</span>
    <span class="jass-comment">// can give him/her their starting items.</span>
    <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, <span class="jass-common-j-native">Player</span>(<span class="jass-const">PLAYER_NEUTRAL_PASSIVE</span>), <span class="jass-const">EVENT_PLAYER_UNIT_SELL</span>, filterMeleeTrainedUnitIsHeroBJ)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToHiredHero</span>)

    <span class="jass-comment">// Flag that we are giving starting items to heroes, so that the melee</span>
    <span class="jass-comment">// starting units code can create them as necessary.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeGrantHeroItems</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Clear Start Locations</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeClearExcessUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>    theUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> owner   <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerId</span>(<span class="jass-common-j-native">GetOwningPlayer</span>(theUnit))

    <span class="jass-keyword">if</span> (owner <span class="jass-op">==</span> <span class="jass-const">PLAYER_NEUTRAL_AGGRESSIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Remove any Neutral Hostile units from the area.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveUnit</span>(<span class="jass-common-j-native">GetEnumUnit</span>())
    <span class="jass-keyword">elseif</span> (owner <span class="jass-op">==</span> <span class="jass-const">PLAYER_NEUTRAL_PASSIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Remove non-structure Neutral Passive units from the area.</span>
        <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> <span class="jass-common-j-native">IsUnitType</span>(theUnit, <span class="jass-const">UNIT_TYPE_STRUCTURE</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveUnit</span>(<span class="jass-common-j-native">GetEnumUnit</span>())
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeClearNearbyUnits</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> x, <span class="jass-type">real</span> y, <span class="jass-type">real</span> range <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> nearbyUnits

    <span class="jass-keyword">set</span> nearbyUnits <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRange</span>(nearbyUnits, x, y, range, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(nearbyUnits, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeClearExcessUnit</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(nearbyUnits)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeClearExcessUnits</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>    locX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>    locY
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)

        <span class="jass-comment">// If the player slot is being used, clear any nearby creeps.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerSlotState</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> locX <span class="jass-op">=</span> <span class="jass-common-j-native">GetStartLocationX</span>(<span class="jass-common-j-native">GetPlayerStartLocation</span>(indexPlayer))
            <span class="jass-keyword">set</span> locY <span class="jass-op">=</span> <span class="jass-common-j-native">GetStartLocationY</span>(<span class="jass-common-j-native">GetPlayerStartLocation</span>(indexPlayer))

            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeClearNearbyUnits</span>(locX, locY, <span class="jass-const">bj_MELEE_CLEAR_UNITS_RADIUS</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Starting Units</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeEnumFindNearestMine</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span> enumUnit <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumUnit</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> dist
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> unitLoc

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetUnitTypeId</span>(enumUnit) <span class="jass-op">==</span> <span class="jass-number">'ngol'</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> unitLoc <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitLoc</span>(enumUnit)
        <span class="jass-keyword">set</span> dist <span class="jass-op">=</span> <span class="jass-blizzard-j-function">DistanceBetweenPoints</span>(unitLoc, <span class="jass-const">bj_meleeNearestMineToLoc</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveLocation</span>(unitLoc)

        <span class="jass-comment">// If this is our first mine, or the closest thusfar, use it instead.</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_meleeNearestMineDist</span> <span class="jass-op">&lt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">or</span> (dist <span class="jass-op">&lt;</span> <span class="jass-const">bj_meleeNearestMineDist</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeNearestMine</span> <span class="jass-op">=</span> enumUnit
            <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeNearestMineDist</span> <span class="jass-op">=</span> dist
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeFindNearestMine</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> src, <span class="jass-type">real</span> range <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> nearbyMines

    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeNearestMine</span> <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeNearestMineDist</span> <span class="jass-op">=</span> <span class="jass-op">-</span><span class="jass-number">1</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeNearestMineToLoc</span> <span class="jass-op">=</span> src

    <span class="jass-keyword">set</span> nearbyMines <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsInRangeOfLoc</span>(nearbyMines, src, range, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(nearbyMines, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeEnumFindNearestMine</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(nearbyMines)

    <span class="jass-keyword">return</span> <span class="jass-const">bj_meleeNearestMine</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeRandomHeroLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> p, <span class="jass-type">integer</span> id1, <span class="jass-type">integer</span> id2, <span class="jass-type">integer</span> id3, <span class="jass-type">integer</span> id4, <span class="jass-type">location</span> loc <span class="jass-keyword">returns</span> <span class="jass-type">unit</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>    hero <span class="jass-op">=</span> <span class="jass-type">null</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> roll
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> pick
    <span class="jass-keyword">local</span> <span class="jass-type">version</span> v

    <span class="jass-comment">// The selection of heroes is dependant on the game version.</span>
    <span class="jass-keyword">set</span> v <span class="jass-op">=</span> <span class="jass-common-j-native">VersionGet</span>()
    <span class="jass-keyword">if</span> (v <span class="jass-op">==</span> <span class="jass-const">VERSION_REIGN_OF_CHAOS</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> roll <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-number">3</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> roll <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-number">4</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Translate the roll into a unitid.</span>
    <span class="jass-keyword">if</span> roll <span class="jass-op">==</span> <span class="jass-number">1</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> id1
    <span class="jass-keyword">elseif</span> roll <span class="jass-op">==</span> <span class="jass-number">2</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> id2
    <span class="jass-keyword">elseif</span> roll <span class="jass-op">==</span> <span class="jass-number">3</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> id3
    <span class="jass-keyword">elseif</span> roll <span class="jass-op">==</span> <span class="jass-number">4</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> id4
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized id index - pick the first hero in the list.</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> id1
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Create the hero.</span>
    <span class="jass-keyword">set</span> hero <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(p, pick, loc, <span class="jass-const">bj_UNIT_FACING</span>)
    <span class="jass-keyword">if</span> <span class="jass-const">bj_meleeGrantHeroItems</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeGrantItemsToHero</span>(hero)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">return</span> hero
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns a location which is (distance) away from (src) in the direction of (targ).</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> src, <span class="jass-type">location</span> targ, <span class="jass-type">real</span> distance, <span class="jass-type">real</span> deltaAngle <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> srcX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(src)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> srcY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(src)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> direction <span class="jass-op">=</span> <span class="jass-common-j-native">Atan2</span>(<span class="jass-common-j-native">GetLocationY</span>(targ) <span class="jass-op">-</span> srcY, <span class="jass-common-j-native">GetLocationX</span>(targ) <span class="jass-op">-</span> srcX) <span class="jass-op">+</span> deltaAngle
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(srcX <span class="jass-op">+</span> distance <span class="jass-op">*</span> <span class="jass-common-j-native">Cos</span>(direction), srcY <span class="jass-op">+</span> distance <span class="jass-op">*</span> <span class="jass-common-j-native">Sin</span>(direction))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetNearestValueWithin</span> <span class="jass-keyword">takes</span> <span class="jass-type">real</span> val, <span class="jass-type">real</span> minVal, <span class="jass-type">real</span> maxVal <span class="jass-keyword">returns</span> <span class="jass-type">real</span>
    <span class="jass-keyword">if</span> (val <span class="jass-op">&lt;</span> minVal) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> minVal
    <span class="jass-keyword">elseif</span> (val <span class="jass-op">&gt;</span> maxVal) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> maxVal
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">return</span> val
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetLocWithinRect</span> <span class="jass-keyword">takes</span> <span class="jass-type">location</span> src, <span class="jass-type">rect</span> r <span class="jass-keyword">returns</span> <span class="jass-type">location</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> withinX <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetNearestValueWithin</span>(<span class="jass-common-j-native">GetLocationX</span>(src), <span class="jass-common-j-native">GetRectMinX</span>(r), <span class="jass-common-j-native">GetRectMaxX</span>(r))
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> withinY <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetNearestValueWithin</span>(<span class="jass-common-j-native">GetLocationY</span>(src), <span class="jass-common-j-native">GetRectMinY</span>(r), <span class="jass-common-j-native">GetRectMaxY</span>(r))
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">Location</span>(withinX, withinY)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Starting Units for Human Players</span>
<span class="jass-comment">//   - 1 Town Hall, placed at start location</span>
<span class="jass-comment">//   - 5 Peasants, placed between start location and nearest gold mine</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsHuman</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> startLoc, <span class="jass-type">boolean</span> doHeroes, <span class="jass-type">boolean</span> doCamera, <span class="jass-type">boolean</span> doPreload <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>  useRandomHero <span class="jass-op">=</span> <span class="jass-common-j-native">IsMapFlagSet</span>(<span class="jass-const">MAP_RANDOM_HERO</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     unitSpacing   <span class="jass-op">=</span> <span class="jass-number">64.00</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>     nearestMine
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> nearMineLoc
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> heroLoc
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonY
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>     townHall <span class="jass-op">=</span> <span class="jass-type">null</span>

    <span class="jass-keyword">if</span> (doPreload) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">Preloader</span>( <span class="jass-string">"scripts\\HumanMelee.pld"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> nearestMine <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeFindNearestMine</span>(startLoc, <span class="jass-const">bj_MELEE_MINE_SEARCH_RADIUS</span>)
    <span class="jass-keyword">if</span> (nearestMine <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Spawn Town Hall at the start location.</span>
        <span class="jass-keyword">set</span> townHall <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'htow'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Peasants near the mine.</span>
        <span class="jass-keyword">set</span> nearMineLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">320</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(nearMineLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(nearMineLoc)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.15</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.15</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.60</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">0.60</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Set random hero spawn point to be off to the side of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">384</span>, <span class="jass-number">45</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Spawn Town Hall at the start location.</span>
        <span class="jass-keyword">set</span> townHall <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'htow'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Peasants directly south of the town hall.</span>
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(startLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(startLoc) <span class="jass-op">-</span> <span class="jass-number">224.00</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'hpea'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Set random hero spawn point to be just south of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-common-j-native">Location</span>(peonX, peonY <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (townHall <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">UnitAddAbilityBJ</span>(<span class="jass-number">'Amic'</span>, townHall)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">UnitMakeAbilityPermanentBJ</span>(<span class="jass-const">true</span>, <span class="jass-number">'Amic'</span>, townHall)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doHeroes) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the "Random Hero" option is set, start the player with a random hero.</span>
        <span class="jass-comment">// Otherwise, give them a "free hero" token.</span>
        <span class="jass-keyword">if</span> useRandomHero <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeRandomHeroLoc</span>(whichPlayer, <span class="jass-number">'Hamg'</span>, <span class="jass-number">'Hmkg'</span>, <span class="jass-number">'Hpal'</span>, <span class="jass-number">'Hblm'</span>, heroLoc)
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_HERO_TOKENS</span>, <span class="jass-const">bj_MELEE_STARTING_HERO_TOKENS</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doCamera) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Center the camera on the initial Peasants.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraPositionForPlayer</span>(whichPlayer, peonX, peonY)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionForPlayer</span>(whichPlayer, peonX, peonY)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Starting Units for Orc Players</span>
<span class="jass-comment">//   - 1 Great Hall, placed at start location</span>
<span class="jass-comment">//   - 5 Peons, placed between start location and nearest gold mine</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsOrc</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> startLoc, <span class="jass-type">boolean</span> doHeroes, <span class="jass-type">boolean</span> doCamera, <span class="jass-type">boolean</span> doPreload <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>  useRandomHero <span class="jass-op">=</span> <span class="jass-common-j-native">IsMapFlagSet</span>(<span class="jass-const">MAP_RANDOM_HERO</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     unitSpacing   <span class="jass-op">=</span> <span class="jass-number">64.00</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>     nearestMine
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> nearMineLoc
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> heroLoc
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonY

    <span class="jass-keyword">if</span> (doPreload) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">Preloader</span>( <span class="jass-string">"scripts\\OrcMelee.pld"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> nearestMine <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeFindNearestMine</span>(startLoc, <span class="jass-const">bj_MELEE_MINE_SEARCH_RADIUS</span>)
    <span class="jass-keyword">if</span> (nearestMine <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Spawn Great Hall at the start location.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'ogre'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Peons near the mine.</span>
        <span class="jass-keyword">set</span> nearMineLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">320</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(nearMineLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(nearMineLoc)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.15</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.15</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.60</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">0.60</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Set random hero spawn point to be off to the side of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">384</span>, <span class="jass-number">45</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Spawn Great Hall at the start location.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'ogre'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Peons directly south of the town hall.</span>
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(startLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(startLoc) <span class="jass-op">-</span> <span class="jass-number">224.00</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'opeo'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Set random hero spawn point to be just south of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-common-j-native">Location</span>(peonX, peonY <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doHeroes) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the "Random Hero" option is set, start the player with a random hero.</span>
        <span class="jass-comment">// Otherwise, give them a "free hero" token.</span>
        <span class="jass-keyword">if</span> useRandomHero <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeRandomHeroLoc</span>(whichPlayer, <span class="jass-number">'Obla'</span>, <span class="jass-number">'Ofar'</span>, <span class="jass-number">'Otch'</span>, <span class="jass-number">'Oshd'</span>, heroLoc)
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_HERO_TOKENS</span>, <span class="jass-const">bj_MELEE_STARTING_HERO_TOKENS</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doCamera) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Center the camera on the initial Peons.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraPositionForPlayer</span>(whichPlayer, peonX, peonY)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionForPlayer</span>(whichPlayer, peonX, peonY)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Starting Units for Undead Players</span>
<span class="jass-comment">//   - 1 Necropolis, placed at start location</span>
<span class="jass-comment">//   - 1 Haunted Gold Mine, placed on nearest gold mine</span>
<span class="jass-comment">//   - 3 Acolytes, placed between start location and nearest gold mine</span>
<span class="jass-comment">//   - 1 Ghoul, placed between start location and nearest gold mine</span>
<span class="jass-comment">//   - Blight, centered on nearest gold mine, spread across a "large area"</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsUndead</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> startLoc, <span class="jass-type">boolean</span> doHeroes, <span class="jass-type">boolean</span> doCamera, <span class="jass-type">boolean</span> doPreload <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>  useRandomHero <span class="jass-op">=</span> <span class="jass-common-j-native">IsMapFlagSet</span>(<span class="jass-const">MAP_RANDOM_HERO</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     unitSpacing   <span class="jass-op">=</span> <span class="jass-number">64.00</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>     nearestMine
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> nearMineLoc
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> nearTownLoc
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> heroLoc
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonY
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     ghoulX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     ghoulY

    <span class="jass-keyword">if</span> (doPreload) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">Preloader</span>( <span class="jass-string">"scripts\\UndeadMelee.pld"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> nearestMine <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeFindNearestMine</span>(startLoc, <span class="jass-const">bj_MELEE_MINE_SEARCH_RADIUS</span>)
    <span class="jass-keyword">if</span> (nearestMine <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Spawn Necropolis at the start location.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'unpl'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Replace the nearest gold mine with a blighted version.</span>
        <span class="jass-keyword">set</span> nearestMine <span class="jass-op">=</span> <span class="jass-blizzard-j-function">BlightGoldMineForPlayerBJ</span>(nearestMine, whichPlayer)

        <span class="jass-comment">// Spawn Ghoul near the Necropolis.</span>
        <span class="jass-keyword">set</span> nearTownLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(startLoc, <span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), <span class="jass-number">288</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">set</span> ghoulX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(nearTownLoc)
        <span class="jass-keyword">set</span> ghoulY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(nearTownLoc)
        <span class="jass-keyword">set</span> <span class="jass-const">bj_ghoul</span>[<span class="jass-common-j-native">GetPlayerId</span>(whichPlayer)] <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ugho'</span>, ghoulX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, ghoulY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Acolytes near the mine.</span>
        <span class="jass-keyword">set</span> nearMineLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">320</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(nearMineLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(nearMineLoc)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'uaco'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.50</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'uaco'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.65</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">0.50</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'uaco'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">0.65</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">0.50</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Create a patch of blight around the gold mine.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetBlightLoc</span>(whichPlayer,nearMineLoc, <span class="jass-number">768</span>, <span class="jass-const">true</span>)

        <span class="jass-comment">// Set random hero spawn point to be off to the side of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">384</span>, <span class="jass-number">45</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Spawn Necropolis at the start location.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'unpl'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Acolytes and Ghoul directly south of the Necropolis.</span>
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(startLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(startLoc) <span class="jass-op">-</span> <span class="jass-number">224.00</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'uaco'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.50</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'uaco'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">0.50</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'uaco'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.50</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ugho'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.50</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Create a patch of blight around the start location.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetBlightLoc</span>(whichPlayer,startLoc, <span class="jass-number">768</span>, <span class="jass-const">true</span>)

        <span class="jass-comment">// Set random hero spawn point to be just south of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-common-j-native">Location</span>(peonX, peonY <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doHeroes) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the "Random Hero" option is set, start the player with a random hero.</span>
        <span class="jass-comment">// Otherwise, give them a "free hero" token.</span>
        <span class="jass-keyword">if</span> useRandomHero <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeRandomHeroLoc</span>(whichPlayer, <span class="jass-number">'Udea'</span>, <span class="jass-number">'Udre'</span>, <span class="jass-number">'Ulic'</span>, <span class="jass-number">'Ucrl'</span>, heroLoc)
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_HERO_TOKENS</span>, <span class="jass-const">bj_MELEE_STARTING_HERO_TOKENS</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doCamera) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Center the camera on the initial Acolytes.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraPositionForPlayer</span>(whichPlayer, peonX, peonY)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionForPlayer</span>(whichPlayer, peonX, peonY)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Starting Units for Night Elf Players</span>
<span class="jass-comment">//   - 1 Tree of Life, placed by nearest gold mine, already entangled</span>
<span class="jass-comment">//   - 5 Wisps, placed between Tree of Life and nearest gold mine</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsNightElf</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> startLoc, <span class="jass-type">boolean</span> doHeroes, <span class="jass-type">boolean</span> doCamera, <span class="jass-type">boolean</span> doPreload <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>  useRandomHero <span class="jass-op">=</span> <span class="jass-common-j-native">IsMapFlagSet</span>(<span class="jass-const">MAP_RANDOM_HERO</span>)
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     unitSpacing   <span class="jass-op">=</span> <span class="jass-number">64.00</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     minTreeDist   <span class="jass-op">=</span> <span class="jass-number">3.50</span> <span class="jass-op">*</span> <span class="jass-const">bj_CELLWIDTH</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     minWispDist   <span class="jass-op">=</span> <span class="jass-number">1.75</span> <span class="jass-op">*</span> <span class="jass-const">bj_CELLWIDTH</span>
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>     nearestMine
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> nearMineLoc
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> wispLoc
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> heroLoc
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>     peonY
    <span class="jass-keyword">local</span> <span class="jass-type">unit</span>     tree

    <span class="jass-keyword">if</span> (doPreload) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">Preloader</span>( <span class="jass-string">"scripts\\NightElfMelee.pld"</span> )
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> nearestMine <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeFindNearestMine</span>(startLoc, <span class="jass-const">bj_MELEE_MINE_SEARCH_RADIUS</span>)
    <span class="jass-keyword">if</span> (nearestMine <span class="jass-op">!=</span> <span class="jass-type">null</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Spawn Tree of Life near the mine and have it entangle the mine.</span>
        <span class="jass-comment">// Project the Tree's coordinates from the gold mine, and then snap</span>
        <span class="jass-comment">// the X and Y values to within minTreeDist of the Gold Mine.</span>
        <span class="jass-keyword">set</span> nearMineLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">650</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">set</span> nearMineLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetLocWithinRect</span>(nearMineLoc, <span class="jass-blizzard-j-function">GetRectFromCircleBJ</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), minTreeDist))
        <span class="jass-keyword">set</span> tree <span class="jass-op">=</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'etol'</span>, nearMineLoc, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">IssueTargetOrder</span>(tree, <span class="jass-string">"entangleinstant"</span>, nearestMine)

        <span class="jass-comment">// Spawn Wisps at the start location.</span>
        <span class="jass-keyword">set</span> wispLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">320</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">set</span> wispLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetLocWithinRect</span>(wispLoc, <span class="jass-blizzard-j-function">GetRectFromCircleBJ</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), minWispDist))
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(wispLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(wispLoc)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.15</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.15</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.58</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">0.58</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Set random hero spawn point to be off to the side of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetProjectedLoc</span>(<span class="jass-common-j-native">GetUnitLoc</span>(nearestMine), startLoc, <span class="jass-number">384</span>, <span class="jass-number">45</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Spawn Tree of Life at the start location.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnitAtLoc</span>(whichPlayer, <span class="jass-number">'etol'</span>, startLoc, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Spawn Wisps directly south of the town hall.</span>
        <span class="jass-keyword">set</span> peonX <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationX</span>(startLoc)
        <span class="jass-keyword">set</span> peonY <span class="jass-op">=</span> <span class="jass-common-j-native">GetLocationY</span>(startLoc) <span class="jass-op">-</span> <span class="jass-number">224.00</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">-</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">1.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'ewsp'</span>, peonX <span class="jass-op">+</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing, peonY <span class="jass-op">+</span> <span class="jass-number">0.00</span> <span class="jass-op">*</span> unitSpacing, <span class="jass-const">bj_UNIT_FACING</span>)

        <span class="jass-comment">// Set random hero spawn point to be just south of the start location.</span>
        <span class="jass-keyword">set</span> heroLoc <span class="jass-op">=</span> <span class="jass-common-j-native">Location</span>(peonX, peonY <span class="jass-op">-</span> <span class="jass-number">2.00</span> <span class="jass-op">*</span> unitSpacing)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doHeroes) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If the "Random Hero" option is set, start the player with a random hero.</span>
        <span class="jass-comment">// Otherwise, give them a "free hero" token.</span>
        <span class="jass-keyword">if</span> useRandomHero <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeRandomHeroLoc</span>(whichPlayer, <span class="jass-number">'Edem'</span>, <span class="jass-number">'Ekee'</span>, <span class="jass-number">'Emoo'</span>, <span class="jass-number">'Ewar'</span>, heroLoc)
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_HERO_TOKENS</span>, <span class="jass-const">bj_MELEE_STARTING_HERO_TOKENS</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doCamera) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Center the camera on the initial Wisps.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraPositionForPlayer</span>(whichPlayer, peonX, peonY)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionForPlayer</span>(whichPlayer, peonX, peonY)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Starting Units for Players Whose Race is Unknown</span>
<span class="jass-comment">//   - 12 Sheep, placed randomly around the start location</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsUnknownRace</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> startLoc, <span class="jass-type">boolean</span> doHeroes, <span class="jass-type">boolean</span> doCamera, <span class="jass-type">boolean</span> doPreload <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">if</span> (doPreload) <span class="jass-keyword">then</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CreateUnit</span>(whichPlayer, <span class="jass-number">'nshe'</span>, <span class="jass-common-j-native">GetLocationX</span>(startLoc) <span class="jass-op">+</span> <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-op">-</span><span class="jass-number">256</span>, <span class="jass-number">256</span>), <span class="jass-common-j-native">GetLocationY</span>(startLoc) <span class="jass-op">+</span> <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-op">-</span><span class="jass-number">256</span>, <span class="jass-number">256</span>), <span class="jass-common-j-native">GetRandomReal</span>(<span class="jass-number">0</span>, <span class="jass-number">360</span>))
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-number">12</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">if</span> (doHeroes) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Give them a "free hero" token, out of pity.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerState</span>(whichPlayer, <span class="jass-const">PLAYER_STATE_RESOURCE_HERO_TOKENS</span>, <span class="jass-const">bj_MELEE_STARTING_HERO_TOKENS</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (doCamera) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Center the camera on the initial sheep.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraPositionLocForPlayer</span>(whichPlayer, startLoc)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">SetCameraQuickPositionLocForPlayer</span>(whichPlayer, startLoc)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnits</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>  index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>   indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">location</span> indexStartLoc
    <span class="jass-keyword">local</span> <span class="jass-type">race</span>     indexRace

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">Preloader</span>( <span class="jass-string">"scripts\\SharedMelee.pld"</span> )

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerSlotState</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> indexStartLoc <span class="jass-op">=</span> <span class="jass-common-j-native">GetStartLocationLoc</span>(<span class="jass-common-j-native">GetPlayerStartLocation</span>(indexPlayer))
            <span class="jass-keyword">set</span> indexRace <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerRace</span>(indexPlayer)

            <span class="jass-comment">// Create initial race-specific starting units</span>
            <span class="jass-keyword">if</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_HUMAN</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsHuman</span>(indexPlayer, indexStartLoc, <span class="jass-const">true</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">elseif</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_ORC</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsOrc</span>(indexPlayer, indexStartLoc, <span class="jass-const">true</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">elseif</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_UNDEAD</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsUndead</span>(indexPlayer, indexStartLoc, <span class="jass-const">true</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">elseif</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_NIGHTELF</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsNightElf</span>(indexPlayer, indexStartLoc, <span class="jass-const">true</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">else</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsUnknownRace</span>(indexPlayer, indexStartLoc, <span class="jass-const">true</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsForPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">race</span> whichRace, <span class="jass-type">player</span> whichPlayer, <span class="jass-type">location</span> loc, <span class="jass-type">boolean</span> doHeroes <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Create initial race-specific starting units</span>
    <span class="jass-keyword">if</span> (whichRace <span class="jass-op">==</span> <span class="jass-const">RACE_HUMAN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsHuman</span>(whichPlayer, loc, doHeroes, <span class="jass-const">false</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">elseif</span> (whichRace <span class="jass-op">==</span> <span class="jass-const">RACE_ORC</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsOrc</span>(whichPlayer, loc, doHeroes, <span class="jass-const">false</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">elseif</span> (whichRace <span class="jass-op">==</span> <span class="jass-const">RACE_UNDEAD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsUndead</span>(whichPlayer, loc, doHeroes, <span class="jass-const">false</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">elseif</span> (whichRace <span class="jass-op">==</span> <span class="jass-const">RACE_NIGHTELF</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeStartingUnitsNightElf</span>(whichPlayer, loc, doHeroes, <span class="jass-const">false</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized race - ignore the request.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Starting AI Scripts</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PickMeleeAI</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> num, <span class="jass-type">string</span> s1, <span class="jass-type">string</span> s2, <span class="jass-type">string</span> s3 <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> pick

    <span class="jass-comment">// easy difficulty never uses any custom AI scripts</span>
    <span class="jass-comment">// that are designed to be a bit more challenging</span>
    <span class="jass-comment">//</span>
    <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetAIDifficulty</span>(num) <span class="jass-op">==</span> <span class="jass-const">AI_DIFFICULTY_NEWBIE</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartMeleeAI</span>(num,s1)
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> s2 <span class="jass-op">==</span> <span class="jass-type">null</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">elseif</span> s3 <span class="jass-op">==</span> <span class="jass-type">null</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-number">2</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> pick <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>,<span class="jass-number">3</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> pick <span class="jass-op">==</span> <span class="jass-number">1</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartMeleeAI</span>(num,s1)
    <span class="jass-keyword">elseif</span> pick <span class="jass-op">==</span> <span class="jass-number">2</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartMeleeAI</span>(num,s2)
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartMeleeAI</span>(num,s3)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeStartingAI</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">race</span>    indexRace

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerSlotState</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> indexRace <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerRace</span>(indexPlayer)
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_COMPUTER</span>) <span class="jass-keyword">then</span>
                <span class="jass-comment">// Run a race-specific melee AI script.</span>
                <span class="jass-keyword">if</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_HUMAN</span>) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PickMeleeAI</span>(indexPlayer, <span class="jass-string">"human.ai"</span>, <span class="jass-type">null</span>, <span class="jass-type">null</span>)
                <span class="jass-keyword">elseif</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_ORC</span>) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PickMeleeAI</span>(indexPlayer, <span class="jass-string">"orc.ai"</span>, <span class="jass-type">null</span>, <span class="jass-type">null</span>)
                <span class="jass-keyword">elseif</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_UNDEAD</span>) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PickMeleeAI</span>(indexPlayer, <span class="jass-string">"undead.ai"</span>, <span class="jass-type">null</span>, <span class="jass-type">null</span>)
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RecycleGuardPosition</span>(<span class="jass-const">bj_ghoul</span>[index])
                <span class="jass-keyword">elseif</span> (indexRace <span class="jass-op">==</span> <span class="jass-const">RACE_NIGHTELF</span>) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PickMeleeAI</span>(indexPlayer, <span class="jass-string">"elf.ai"</span>, <span class="jass-type">null</span>, <span class="jass-type">null</span>)
                <span class="jass-keyword">else</span>
                    <span class="jass-comment">// Unrecognized race.</span>
                <span class="jass-keyword">endif</span>
                <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ShareEverythingWithTeamAI</span>(indexPlayer)
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LockGuardPosition</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> targ <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetUnitCreepGuard</span>(targ,<span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Melee Template Victory / Defeat Conditions</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleePlayerIsOpponent</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> playerIndex, <span class="jass-type">integer</span> opponentIndex <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> thePlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> theOpponent <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(opponentIndex)

    <span class="jass-comment">// The player himself is not an opponent.</span>
    <span class="jass-keyword">if</span> (playerIndex <span class="jass-op">==</span> opponentIndex) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Unused player slots are not opponents.</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerSlotState</span>(theOpponent) <span class="jass-op">!=</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Players who are already defeated are not opponents.</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_meleeDefeated</span>[opponentIndex]) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Allied players with allied victory set are not opponents.</span>
    <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetPlayerAlliance</span>(thePlayer, theOpponent, <span class="jass-const">ALLIANCE_PASSIVE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">if</span> <span class="jass-common-j-native">GetPlayerAlliance</span>(theOpponent, thePlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerState</span>(thePlayer, <span class="jass-const">PLAYER_STATE_ALLIED_VICTORY</span>) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerState</span>(theOpponent, <span class="jass-const">PLAYER_STATE_ALLIED_VICTORY</span>) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">return</span> <span class="jass-const">false</span>
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">return</span> <span class="jass-const">true</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Count buildings currently owned by all allies, including the player themself.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetAllyStructureCount</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    buildingCount
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer

    <span class="jass-comment">// Count the number of buildings controlled by all not-yet-defeated co-allies.</span>
    <span class="jass-keyword">set</span> buildingCount <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)

        <span class="jass-comment">// uncomment to cause defeat even if you have control of ally structures, but yours have been nixed</span>
        <span class="jass-comment">//if (PlayersAreCoAllied(whichPlayer, indexPlayer) and not bj_meleeDefeated[playerIndex]) then</span>
        <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> buildingCount <span class="jass-op">=</span> buildingCount <span class="jass-op">+</span> <span class="jass-common-j-native">GetPlayerStructureCount</span>(indexPlayer, <span class="jass-const">true</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> buildingCount
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Count allies, excluding dead players and the player themself.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetAllyCount</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerCount
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer

    <span class="jass-comment">// Count the number of not-yet-defeated co-allies.</span>
    <span class="jass-keyword">set</span> playerCount <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer) <span class="jass-keyword">and</span> <span class="jass-keyword">not</span> <span class="jass-const">bj_meleeDefeated</span>[playerIndex] <span class="jass-keyword">and</span> (whichPlayer <span class="jass-op">!=</span> indexPlayer) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> playerCount <span class="jass-op">=</span> playerCount <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> playerCount
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Counts key structures owned by a player and his or her allies, including</span>
<span class="jass-comment">// structures currently upgrading or under construction.</span>
<span class="jass-comment">//</span>
<span class="jass-comment">// Key structures: Town Hall, Great Hall, Tree of Life, Necropolis</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetAllyKeyStructureCount</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    keyStructs

    <span class="jass-comment">// Count the number of buildings controlled by all not-yet-defeated co-allies.</span>
    <span class="jass-keyword">set</span> keyStructs <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> keyStructs <span class="jass-op">=</span> keyStructs <span class="jass-op">+</span> <span class="jass-common-j-native">GetPlayerTypedUnitCount</span>(indexPlayer, <span class="jass-string">"townhall"</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">set</span> keyStructs <span class="jass-op">=</span> keyStructs <span class="jass-op">+</span> <span class="jass-common-j-native">GetPlayerTypedUnitCount</span>(indexPlayer, <span class="jass-string">"greathall"</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">set</span> keyStructs <span class="jass-op">=</span> keyStructs <span class="jass-op">+</span> <span class="jass-common-j-native">GetPlayerTypedUnitCount</span>(indexPlayer, <span class="jass-string">"treeoflife"</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
            <span class="jass-keyword">set</span> keyStructs <span class="jass-op">=</span> keyStructs <span class="jass-op">+</span> <span class="jass-common-j-native">GetPlayerTypedUnitCount</span>(indexPlayer, <span class="jass-string">"necropolis"</span>, <span class="jass-const">true</span>, <span class="jass-const">true</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> keyStructs
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Enum: Draw out a specific player.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoDrawEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> thePlayer <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumPlayer</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CachePlayerHeroData</span>(thePlayer)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span>(thePlayer, <span class="jass-const">PLAYER_GAME_RESULT_TIE</span>, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Enum: Victory out a specific player.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoVictoryEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> thePlayer <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumPlayer</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerId</span>(thePlayer)

    <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_meleeVictoried</span>[playerIndex]) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeVictoried</span>[playerIndex] <span class="jass-op">=</span> <span class="jass-const">true</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CachePlayerHeroData</span>(thePlayer)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span>(thePlayer, <span class="jass-const">PLAYER_GAME_RESULT_VICTORY</span>, <span class="jass-const">false</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Defeat out a specific player.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoDefeat</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeDefeated</span>[<span class="jass-common-j-native">GetPlayerId</span>(whichPlayer)] <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span>(whichPlayer, <span class="jass-const">PLAYER_GAME_RESULT_DEFEAT</span>, <span class="jass-const">false</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Enum: Defeat out a specific player.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoDefeatEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> thePlayer <span class="jass-op">=</span> <span class="jass-common-j-native">GetEnumPlayer</span>()

    <span class="jass-comment">// needs to happen before ownership change</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CachePlayerHeroData</span>(thePlayer)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForTeam</span>(thePlayer)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeDoDefeat</span>(thePlayer)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// A specific player left the game.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoLeave</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetIntegerGameState</span>(<span class="jass-const">GAME_STATE_DISCONNECTED</span>) <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">GameOverDialogBJ</span>( whichPlayer, <span class="jass-const">true</span> )
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeDefeated</span>[<span class="jass-common-j-native">GetPlayerId</span>(whichPlayer)] <span class="jass-op">=</span> <span class="jass-const">true</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span>(whichPlayer, <span class="jass-const">PLAYER_GAME_RESULT_DEFEAT</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Remove all observers</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeRemoveObservers</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer

    <span class="jass-comment">// Give all observers the game over dialog</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)

        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerObserver</span>(indexPlayer)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span>(indexPlayer, <span class="jass-const">PLAYER_GAME_RESULT_NEUTRAL</span>, <span class="jass-const">false</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Test all players to determine if a team has won.  For a team to win, all</span>
<span class="jass-comment">// remaining (read: undefeated) players need to be co-allied with all other</span>
<span class="jass-comment">// remaining players.  If even one player is not allied towards another,</span>
<span class="jass-comment">// everyone must be denied victory.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCheckForVictors</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">force</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    opponentIndex
    <span class="jass-keyword">local</span> <span class="jass-type">force</span>      opponentlessPlayers <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>    gameOver <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-comment">// Check to see if any players have opponents remaining.</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_meleeDefeated</span>[playerIndex]) <span class="jass-keyword">then</span>
            <span class="jass-comment">// Determine whether or not this player has any remaining opponents.</span>
            <span class="jass-keyword">set</span> opponentIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-comment">// If anyone has an opponent, noone can be victorious yet.</span>
                <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">MeleePlayerIsOpponent</span>(playerIndex, opponentIndex) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">return</span> <span class="jass-common-j-native">CreateForce</span>()
                <span class="jass-keyword">endif</span>

                <span class="jass-keyword">set</span> opponentIndex <span class="jass-op">=</span> opponentIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> opponentIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
            <span class="jass-keyword">endloop</span>

            <span class="jass-comment">// Keep track of each opponentless player so that we can give</span>
            <span class="jass-comment">// them a victory later.</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(opponentlessPlayers, <span class="jass-common-j-native">Player</span>(playerIndex))
            <span class="jass-keyword">set</span> gameOver <span class="jass-op">=</span> <span class="jass-const">true</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Set the game over global flag</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeGameOver</span> <span class="jass-op">=</span> gameOver

    <span class="jass-keyword">return</span> opponentlessPlayers
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Test each player to determine if anyone has been defeated.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCheckForLosersAndVictors</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">force</span>      defeatedPlayers <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">force</span>      victoriousPlayers
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>    gameOver <span class="jass-op">=</span> <span class="jass-const">false</span>

    <span class="jass-comment">// If the game is already over, do nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_meleeGameOver</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// If the game was disconnected then it is over, in this case we</span>
    <span class="jass-comment">// don't want to report results for anyone as they will most likely</span>
    <span class="jass-comment">// conflict with the actual game results</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetIntegerGameState</span>(<span class="jass-const">GAME_STATE_DISCONNECTED</span>) <span class="jass-op">!=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeGameOver</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Check each player to see if he or she has been defeated yet.</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)

        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_meleeDefeated</span>[playerIndex] <span class="jass-keyword">and</span> <span class="jass-keyword">not</span> <span class="jass-const">bj_meleeVictoried</span>[playerIndex]) <span class="jass-keyword">then</span>
            <span class="jass-comment">//call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 60, "Player"+I2S(playerIndex)+" has "+I2S(MeleeGetAllyStructureCount(indexPlayer))+" ally buildings.")</span>
            <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">MeleeGetAllyStructureCount</span>(indexPlayer) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>

                <span class="jass-comment">// Keep track of each defeated player so that we can give</span>
                <span class="jass-comment">// them a defeat later.</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(defeatedPlayers, <span class="jass-common-j-native">Player</span>(playerIndex))

                <span class="jass-comment">// Set their defeated flag now so MeleeCheckForVictors</span>
                <span class="jass-comment">// can detect victors.</span>
                <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeDefeated</span>[playerIndex] <span class="jass-op">=</span> <span class="jass-const">true</span>
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Now that the defeated flags are set, check if there are any victors</span>
    <span class="jass-keyword">set</span> victoriousPlayers <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeCheckForVictors</span>()

    <span class="jass-comment">// Defeat all defeated players</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(defeatedPlayers, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoDefeatEnum</span>)

    <span class="jass-comment">// Give victory to all victorious players</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(victoriousPlayers, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoVictoryEnum</span>)

    <span class="jass-comment">// If the game is over we should remove all observers</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_meleeGameOver</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeRemoveObservers</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns a race-specific "build X or be revealed" message.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetCrippledWarningMessage</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">local</span> <span class="jass-type">race</span> r <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerRace</span>(whichPlayer)

    <span class="jass-keyword">if</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_HUMAN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_WARNING_HUMAN"</span>)
    <span class="jass-keyword">elseif</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_ORC</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_WARNING_ORC"</span>)
    <span class="jass-keyword">elseif</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_NIGHTELF</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_WARNING_NIGHTELF"</span>)
    <span class="jass-keyword">elseif</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_UNDEAD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_WARNING_UNDEAD"</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized Race</span>
        <span class="jass-keyword">return</span> <span class="jass-string">""</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns a race-specific "build X" label for cripple timers.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetCrippledTimerMessage</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">local</span> <span class="jass-type">race</span> r <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerRace</span>(whichPlayer)

    <span class="jass-keyword">if</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_HUMAN</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_TIMER_HUMAN"</span>)
    <span class="jass-keyword">elseif</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_ORC</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_TIMER_ORC"</span>)
    <span class="jass-keyword">elseif</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_NIGHTELF</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_TIMER_NIGHTELF"</span>)
    <span class="jass-keyword">elseif</span> (r <span class="jass-op">==</span> <span class="jass-const">RACE_UNDEAD</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_TIMER_UNDEAD"</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized Race</span>
        <span class="jass-keyword">return</span> <span class="jass-string">""</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Returns a race-specific "build X" label for cripple timers.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeGetCrippledRevealedMessage</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">string</span>
    <span class="jass-keyword">return</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_REVEALING_PREFIX"</span>) <span class="jass-op">+</span> <span class="jass-common-j-native">GetPlayerName</span>(whichPlayer) <span class="jass-op">+</span> <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_REVEALING_POSTFIX"</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeExposePlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">boolean</span> expose <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">force</span>   toExposeTo <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CripplePlayer</span>( whichPlayer, toExposeTo, <span class="jass-const">false</span> )

    <span class="jass-keyword">set</span> <span class="jass-const">bj_playerIsExposed</span>[<span class="jass-common-j-native">GetPlayerId</span>(whichPlayer)] <span class="jass-op">=</span> expose
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(whichPlayer, indexPlayer)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>( toExposeTo, indexPlayer )
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CripplePlayer</span>( whichPlayer, toExposeTo, expose )
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyForce</span>(toExposeTo)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeExposeAllPlayers</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex2
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer2
    <span class="jass-keyword">local</span> <span class="jass-type">force</span>   toExposeTo <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()

    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)

        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceClear</span>( toExposeTo )
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CripplePlayer</span>( indexPlayer, toExposeTo, <span class="jass-const">false</span> )

        <span class="jass-keyword">set</span> playerIndex2 <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">set</span> indexPlayer2 <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex2)

            <span class="jass-keyword">if</span> playerIndex <span class="jass-op">!=</span> playerIndex2 <span class="jass-keyword">then</span>
                <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(indexPlayer, indexPlayer2)) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>( toExposeTo, indexPlayer2 )
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endif</span>

            <span class="jass-keyword">set</span> playerIndex2 <span class="jass-op">=</span> playerIndex2 <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> playerIndex2 <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
        <span class="jass-keyword">endloop</span>

        <span class="jass-keyword">call</span> <span class="jass-common-j-native">CripplePlayer</span>( indexPlayer, toExposeTo, <span class="jass-const">true</span> )

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyForce</span>( toExposeTo )
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCrippledPlayerTimeout</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">timer</span> expiredTimer <span class="jass-op">=</span> <span class="jass-common-j-native">GetExpiredTimer</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  exposedPlayer

    <span class="jass-comment">// Determine which player's timer expired.</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_crippledTimer</span>[playerIndex] <span class="jass-op">==</span> expiredTimer) <span class="jass-keyword">then</span>
            <span class="jass-keyword">exitwhen</span> <span class="jass-const">true</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">if</span> (playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">set</span> exposedPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> exposedPlayer) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

        <span class="jass-comment">// Hide the timer window for this player.</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(<span class="jass-const">bj_crippledTimerWindows</span>[playerIndex], <span class="jass-const">false</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Display a text message to all players, explaining the exposure.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(<span class="jass-common-j-native">GetLocalPlayer</span>(), <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_MELEE_CRIPPLE_MSG_DURATION</span>, <span class="jass-blizzard-j-function">MeleeGetCrippledRevealedMessage</span>(exposedPlayer))

    <span class="jass-comment">// Expose the player.</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeExposePlayer</span>(exposedPlayer, <span class="jass-const">true</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleePlayerIsCrippled</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> allyStructures    <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetAllyStructureCount</span>(whichPlayer)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> allyKeyStructures <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleeGetAllyKeyStructureCount</span>(whichPlayer)

    <span class="jass-comment">// Dead teams are not considered to be crippled.</span>
    <span class="jass-keyword">return</span> (allyStructures <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">and</span> (allyKeyStructures <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Test each player to determine if anyone has become crippled.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCheckForCrippledPlayers</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">force</span>      crippledPlayers <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>    isNowCrippled
    <span class="jass-keyword">local</span> <span class="jass-type">race</span>       indexRace

    <span class="jass-comment">// The "finish soon" exposure of all players overrides any "crippled" exposure</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_finishSoonAllExposed</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Check each player to see if he or she has been crippled or uncrippled.</span>
    <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
        <span class="jass-keyword">set</span> isNowCrippled <span class="jass-op">=</span> <span class="jass-blizzard-j-function">MeleePlayerIsCrippled</span>(indexPlayer)

        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_playerIsCrippled</span>[playerIndex] <span class="jass-keyword">and</span> isNowCrippled) <span class="jass-keyword">then</span>

            <span class="jass-comment">// Player became crippled; start their cripple timer.</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_playerIsCrippled</span>[playerIndex] <span class="jass-op">=</span> <span class="jass-const">true</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_crippledTimer</span>[playerIndex], <span class="jass-const">bj_MELEE_CRIPPLE_TIMEOUT</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCrippledPlayerTimeout</span>)

            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> indexPlayer) <span class="jass-keyword">then</span>
                <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

                <span class="jass-comment">// Show the timer window.</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(<span class="jass-const">bj_crippledTimerWindows</span>[playerIndex], <span class="jass-const">true</span>)

                <span class="jass-comment">// Display a warning message.</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(indexPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_MELEE_CRIPPLE_MSG_DURATION</span>, <span class="jass-blizzard-j-function">MeleeGetCrippledWarningMessage</span>(indexPlayer))
            <span class="jass-keyword">endif</span>

        <span class="jass-keyword">elseif</span> (<span class="jass-const">bj_playerIsCrippled</span>[playerIndex] <span class="jass-keyword">and</span> <span class="jass-keyword">not</span> isNowCrippled) <span class="jass-keyword">then</span>

            <span class="jass-comment">// Player became uncrippled; stop their cripple timer.</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_playerIsCrippled</span>[playerIndex] <span class="jass-op">=</span> <span class="jass-const">false</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseTimer</span>(<span class="jass-const">bj_crippledTimer</span>[playerIndex])

            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> indexPlayer) <span class="jass-keyword">then</span>
                <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

                <span class="jass-comment">// Hide the timer window for this player.</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(<span class="jass-const">bj_crippledTimerWindows</span>[playerIndex], <span class="jass-const">false</span>)

                <span class="jass-comment">// Display a confirmation message if the player's team is still alive.</span>
                <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">MeleeGetAllyStructureCount</span>(indexPlayer) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">if</span> (<span class="jass-const">bj_playerIsExposed</span>[playerIndex]) <span class="jass-keyword">then</span>
                        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(indexPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_MELEE_CRIPPLE_MSG_DURATION</span>, <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_UNREVEALED"</span>))
                    <span class="jass-keyword">else</span>
                        <span class="jass-keyword">call</span> <span class="jass-common-j-native">DisplayTimedTextToPlayer</span>(indexPlayer, <span class="jass-number">0</span>, <span class="jass-number">0</span>, <span class="jass-const">bj_MELEE_CRIPPLE_MSG_DURATION</span>, <span class="jass-common-j-native">GetLocalizedString</span>(<span class="jass-string">"CRIPPLE_UNCRIPPLED"</span>))
                    <span class="jass-keyword">endif</span>
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endif</span>

            <span class="jass-comment">// If the player granted shared vision, deny that vision now.</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeExposePlayer</span>(indexPlayer, <span class="jass-const">false</span>)

        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Determine if the lost unit should result in any defeats or victories.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCheckLostUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> lostUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> lostUnitOwner <span class="jass-op">=</span> <span class="jass-common-j-native">GetOwningPlayer</span>(lostUnit)

    <span class="jass-comment">// We only need to check for mortality if this was the last building.</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerStructureCount</span>(lostUnitOwner, <span class="jass-const">true</span>) <span class="jass-op">&lt;=</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForLosersAndVictors</span>()
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Check if the lost unit has crippled or uncrippled the player.</span>
    <span class="jass-comment">// (A team with 0 units is dead, and thus considered uncrippled.)</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForCrippledPlayers</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Determine if the gained unit should result in any defeats, victories,</span>
<span class="jass-comment">// or cripple-status changes.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeCheckAddedUnit</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> addedUnit <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> addedUnitOwner <span class="jass-op">=</span> <span class="jass-common-j-native">GetOwningPlayer</span>(addedUnit)

    <span class="jass-comment">// If the player was crippled, this unit may have uncrippled him/her.</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_playerIsCrippled</span>[<span class="jass-common-j-native">GetPlayerId</span>(addedUnitOwner)]) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForCrippledPlayers</span>()
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionConstructCancel</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckLostUnit</span>(<span class="jass-common-j-native">GetCancelledStructure</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionUnitDeath</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsUnitType</span>(<span class="jass-common-j-native">GetDyingUnit</span>(), <span class="jass-const">UNIT_TYPE_STRUCTURE</span>)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckLostUnit</span>(<span class="jass-common-j-native">GetDyingUnit</span>())
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionUnitConstructionStart</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckAddedUnit</span>(<span class="jass-common-j-native">GetConstructingStructure</span>())
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionPlayerDefeated</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> thePlayer <span class="jass-op">=</span> <span class="jass-common-j-native">GetTriggerPlayer</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CachePlayerHeroData</span>(thePlayer)

    <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">MeleeGetAllyCount</span>(thePlayer) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If at least one ally is still alive and kicking, share units with</span>
        <span class="jass-comment">// them and proceed with death.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ShareEverythingWithTeam</span>(thePlayer)
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_meleeDefeated</span>[<span class="jass-common-j-native">GetPlayerId</span>(thePlayer)]) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeDoDefeat</span>(thePlayer)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// If no living allies remain, swap all units and buildings over to</span>
        <span class="jass-comment">// neutral_passive and proceed with death.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForTeam</span>(thePlayer)
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_meleeDefeated</span>[<span class="jass-common-j-native">GetPlayerId</span>(thePlayer)]) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeDoDefeat</span>(thePlayer)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForLosersAndVictors</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionPlayerLeft</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">player</span> thePlayer <span class="jass-op">=</span> <span class="jass-common-j-native">GetTriggerPlayer</span>()

    <span class="jass-comment">// Just show game over for observers when they leave</span>
    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerObserver</span>(thePlayer)) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">RemovePlayerPreserveUnitsBJ</span>(thePlayer, <span class="jass-const">PLAYER_GAME_RESULT_NEUTRAL</span>, <span class="jass-const">false</span>)
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">CachePlayerHeroData</span>(thePlayer)

    <span class="jass-comment">// This is the same as defeat except the player generates the message</span>
    <span class="jass-comment">// "player left the game" as opposed to "player was defeated".</span>

    <span class="jass-keyword">if</span> (<span class="jass-blizzard-j-function">MeleeGetAllyCount</span>(thePlayer) <span class="jass-op">&gt;</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// If at least one ally is still alive and kicking, share units with</span>
        <span class="jass-comment">// them and proceed with death.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ShareEverythingWithTeam</span>(thePlayer)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeDoLeave</span>(thePlayer)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// If no living allies remain, swap all units and buildings over to</span>
        <span class="jass-comment">// neutral_passive and proceed with death.</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MakeUnitsPassiveForTeam</span>(thePlayer)
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeDoLeave</span>(thePlayer)
    <span class="jass-keyword">endif</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForLosersAndVictors</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionAllianceChange</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForLosersAndVictors</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeCheckForCrippledPlayers</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerTournamentFinishSoon</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Note: We may get this trigger multiple times</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    playerIndex
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">real</span>       timeRemaining <span class="jass-op">=</span> <span class="jass-common-j-native">GetTournamentFinishSoonTimeRemaining</span>()

    <span class="jass-keyword">if</span> <span class="jass-keyword">not</span> <span class="jass-const">bj_finishSoonAllExposed</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_finishSoonAllExposed</span> <span class="jass-op">=</span> <span class="jass-const">true</span>

        <span class="jass-comment">// Reset all crippled players and their timers, and hide the local crippled timer dialog</span>
        <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(playerIndex)
            <span class="jass-keyword">if</span> <span class="jass-const">bj_playerIsCrippled</span>[playerIndex] <span class="jass-keyword">then</span>
                <span class="jass-comment">// Uncripple the player</span>
                <span class="jass-keyword">set</span> <span class="jass-const">bj_playerIsCrippled</span>[playerIndex] <span class="jass-op">=</span> <span class="jass-const">false</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">PauseTimer</span>(<span class="jass-const">bj_crippledTimer</span>[playerIndex])

                <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetLocalPlayer</span>() <span class="jass-op">==</span> indexPlayer) <span class="jass-keyword">then</span>
                    <span class="jass-comment">// Use only local code (no net traffic) within this block to avoid desyncs.</span>

                    <span class="jass-comment">// Hide the timer window.</span>
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(<span class="jass-const">bj_crippledTimerWindows</span>[playerIndex], <span class="jass-const">false</span>)
                <span class="jass-keyword">endif</span>

            <span class="jass-keyword">endif</span>
            <span class="jass-keyword">set</span> playerIndex <span class="jass-op">=</span> playerIndex <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> playerIndex <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
        <span class="jass-keyword">endloop</span>

        <span class="jass-comment">// Expose all players</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeExposeAllPlayers</span>()
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Show the "finish soon" timer dialog and set the real time remaining</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogDisplay</span>(<span class="jass-const">bj_finishSoonTimerDialog</span>, <span class="jass-const">true</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetRealTimeRemaining</span>(<span class="jass-const">bj_finishSoonTimerDialog</span>, timeRemaining)
<span class="jass-keyword">endfunction</span>


<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeWasUserPlayer</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer <span class="jass-keyword">returns</span> <span class="jass-type">boolean</span>
    <span class="jass-keyword">local</span> <span class="jass-type">playerslotstate</span> slotState

    <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(whichPlayer) <span class="jass-op">!=</span> <span class="jass-const">MAP_CONTROL_USER</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-const">false</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> slotState <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerSlotState</span>(whichPlayer)

    <span class="jass-keyword">return</span> (slotState <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span> <span class="jass-keyword">or</span> slotState <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_LEFT</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTournamentFinishNowRuleA</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> multiplier <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> <span class="jass-keyword">array</span> playerScore
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> <span class="jass-keyword">array</span> teamScore
    <span class="jass-keyword">local</span> <span class="jass-type">force</span> <span class="jass-keyword">array</span>   teamForce
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>       teamCount
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>       index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>        indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>       index2
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>        indexPlayer2
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>       bestTeam
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>       bestScore
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span>       draw

    <span class="jass-comment">// Compute individual player scores</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
        <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">MeleeWasUserPlayer</span>(indexPlayer) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> playerScore[index] <span class="jass-op">=</span> <span class="jass-common-j-native">GetTournamentScore</span>(indexPlayer)
            <span class="jass-keyword">if</span> playerScore[index] <span class="jass-op">&lt;=</span> <span class="jass-number">0</span> <span class="jass-keyword">then</span>
                <span class="jass-keyword">set</span> playerScore[index] <span class="jass-op">=</span> <span class="jass-number">1</span>
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">set</span> playerScore[index] <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Compute team scores and team forces</span>
    <span class="jass-keyword">set</span> teamCount <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">if</span> playerScore[index] <span class="jass-op">!=</span> <span class="jass-number">0</span> <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)

            <span class="jass-keyword">set</span> teamScore[teamCount] <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">set</span> teamForce[teamCount] <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()

            <span class="jass-keyword">set</span> index2 <span class="jass-op">=</span> index
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">if</span> playerScore[index2] <span class="jass-op">!=</span> <span class="jass-number">0</span> <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> indexPlayer2 <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index2)

                    <span class="jass-keyword">if</span> <span class="jass-blizzard-j-function">PlayersAreCoAllied</span>(indexPlayer, indexPlayer2) <span class="jass-keyword">then</span>
                        <span class="jass-keyword">set</span> teamScore[teamCount] <span class="jass-op">=</span> teamScore[teamCount] <span class="jass-op">+</span> playerScore[index2]
                        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(teamForce[teamCount], indexPlayer2)
                        <span class="jass-keyword">set</span> playerScore[index2] <span class="jass-op">=</span> <span class="jass-number">0</span>
                    <span class="jass-keyword">endif</span>
                <span class="jass-keyword">endif</span>

                <span class="jass-keyword">set</span> index2 <span class="jass-op">=</span> index2 <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> index2 <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
            <span class="jass-keyword">endloop</span>

            <span class="jass-keyword">set</span> teamCount <span class="jass-op">=</span> teamCount <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// The game is now over</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeGameOver</span> <span class="jass-op">=</span> <span class="jass-const">true</span>

    <span class="jass-comment">// There should always be at least one team, but continue to work if not</span>
    <span class="jass-keyword">if</span> teamCount <span class="jass-op">!=</span> <span class="jass-number">0</span> <span class="jass-keyword">then</span>

        <span class="jass-comment">// Find best team score</span>
        <span class="jass-keyword">set</span> bestTeam <span class="jass-op">=</span> <span class="jass-op">-</span><span class="jass-number">1</span>
        <span class="jass-keyword">set</span> bestScore <span class="jass-op">=</span> <span class="jass-op">-</span><span class="jass-number">1</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">if</span> teamScore[index] <span class="jass-op">&gt;</span> bestScore <span class="jass-keyword">then</span>
                <span class="jass-keyword">set</span> bestTeam <span class="jass-op">=</span> index
                <span class="jass-keyword">set</span> bestScore <span class="jass-op">=</span> teamScore[index]
            <span class="jass-keyword">endif</span>

            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> teamCount
        <span class="jass-keyword">endloop</span>

        <span class="jass-comment">// Check whether the best team's score is 'multiplier' times better than</span>
        <span class="jass-comment">// every other team. In the case of multiplier == 1 and exactly equal team</span>
        <span class="jass-comment">// scores, the first team (which was randomly chosen by the server) will win.</span>
        <span class="jass-keyword">set</span> draw <span class="jass-op">=</span> <span class="jass-const">false</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">if</span> index <span class="jass-op">!=</span> bestTeam <span class="jass-keyword">then</span>
                <span class="jass-keyword">if</span> bestScore <span class="jass-op">&lt;</span> (multiplier <span class="jass-op">*</span> teamScore[index]) <span class="jass-keyword">then</span>
                    <span class="jass-keyword">set</span> draw <span class="jass-op">=</span> <span class="jass-const">true</span>
                <span class="jass-keyword">endif</span>
            <span class="jass-keyword">endif</span>

            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> teamCount
        <span class="jass-keyword">endloop</span>

        <span class="jass-keyword">if</span> draw <span class="jass-keyword">then</span>
            <span class="jass-comment">// Give draw to all players on all teams</span>
            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(teamForce[index], <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoDrawEnum</span>)

                <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> teamCount
            <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">else</span>
            <span class="jass-comment">// Give defeat to all players on teams other than the best team</span>
            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">loop</span>
                <span class="jass-keyword">if</span> index <span class="jass-op">!=</span> bestTeam <span class="jass-keyword">then</span>
                    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(teamForce[index], <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoDefeatEnum</span>)
                <span class="jass-keyword">endif</span>

                <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
                <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> teamCount
            <span class="jass-keyword">endloop</span>

            <span class="jass-comment">// Give victory to all players on the best team</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForForce</span>(teamForce[bestTeam], <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeDoVictoryEnum</span>)
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endif</span>

<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerTournamentFinishNow</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> rule <span class="jass-op">=</span> <span class="jass-common-j-native">GetTournamentFinishNowRule</span>()

    <span class="jass-comment">// If the game is already over, do nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_meleeGameOver</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">if</span> (rule <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Finals games</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeTournamentFinishNowRuleA</span>(<span class="jass-number">1</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Preliminary games</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeTournamentFinishNowRuleA</span>(<span class="jass-number">3</span>)
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Since the game is over we should remove all observers</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeRemoveObservers</span>()

<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeInitVictoryDefeat</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">trigger</span>    trig
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>    index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>     indexPlayer

    <span class="jass-comment">// Create a timer window for the "finish soon" timeout period, it has no timer</span>
    <span class="jass-comment">// because it is driven by real time (outside of the game state to avoid desyncs)</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_finishSoonTimerDialog</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimerDialog</span>(<span class="jass-type">null</span>)

    <span class="jass-comment">// Set a trigger to fire when we receive a "finish soon" game event</span>
    <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameEvent</span>(trig, <span class="jass-const">EVENT_GAME_TOURNAMENT_FINISH_SOON</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerTournamentFinishSoon</span>)

    <span class="jass-comment">// Set a trigger to fire when we receive a "finish now" game event</span>
    <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameEvent</span>(trig, <span class="jass-const">EVENT_GAME_TOURNAMENT_FINISH_NOW</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerTournamentFinishNow</span>)

    <span class="jass-comment">// Set up each player's mortality code.</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)

        <span class="jass-comment">// Make sure this player slot is playing.</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerSlotState</span>(indexPlayer) <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeDefeated</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeVictoried</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>

            <span class="jass-comment">// Create a timer and timer window in case the player is crippled.</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_playerIsCrippled</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_playerIsExposed</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_crippledTimer</span>[index] <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
            <span class="jass-keyword">set</span> <span class="jass-const">bj_crippledTimerWindows</span>[index] <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimerDialog</span>(<span class="jass-const">bj_crippledTimer</span>[index])
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerDialogSetTitle</span>(<span class="jass-const">bj_crippledTimerWindows</span>[index], <span class="jass-blizzard-j-function">MeleeGetCrippledTimerMessage</span>(indexPlayer))

            <span class="jass-comment">// Set a trigger to fire whenever a building is cancelled for this player.</span>
            <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, indexPlayer, <span class="jass-const">EVENT_PLAYER_UNIT_CONSTRUCT_CANCEL</span>, <span class="jass-type">null</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionConstructCancel</span>)

            <span class="jass-comment">// Set a trigger to fire whenever a unit dies for this player.</span>
            <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, indexPlayer, <span class="jass-const">EVENT_PLAYER_UNIT_DEATH</span>, <span class="jass-type">null</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionUnitDeath</span>)

            <span class="jass-comment">// Set a trigger to fire whenever a unit begins construction for this player</span>
            <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(trig, indexPlayer, <span class="jass-const">EVENT_PLAYER_UNIT_CONSTRUCT_START</span>, <span class="jass-type">null</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionUnitConstructionStart</span>)

            <span class="jass-comment">// Set a trigger to fire whenever this player defeats-out</span>
            <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, indexPlayer, <span class="jass-const">EVENT_PLAYER_DEFEAT</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionPlayerDefeated</span>)

            <span class="jass-comment">// Set a trigger to fire whenever this player leaves</span>
            <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, indexPlayer, <span class="jass-const">EVENT_PLAYER_LEAVE</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionPlayerLeft</span>)

            <span class="jass-comment">// Set a trigger to fire whenever this player changes his/her alliances.</span>
            <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerAllianceChange</span>(trig, indexPlayer, <span class="jass-const">ALLIANCE_PASSIVE</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerStateEvent</span>(trig, indexPlayer, <span class="jass-const">PLAYER_STATE_ALLIED_VICTORY</span>, <span class="jass-const">EQUAL</span>, <span class="jass-number">1</span>)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionAllianceChange</span>)
        <span class="jass-keyword">else</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeDefeated</span>[index] <span class="jass-op">=</span> <span class="jass-const">true</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_meleeVictoried</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>

            <span class="jass-comment">// Handle leave events for observers</span>
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">IsPlayerObserver</span>(indexPlayer)) <span class="jass-keyword">then</span>
                <span class="jass-comment">// Set a trigger to fire whenever this player leaves</span>
                <span class="jass-keyword">set</span> trig <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerEvent</span>(trig, indexPlayer, <span class="jass-const">EVENT_PLAYER_LEAVE</span>)
                <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(trig, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionPlayerLeft</span>)
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Test for victory / defeat at startup, in case the user has already won / lost.</span>
    <span class="jass-comment">// Allow for a short time to pass first, so that the map can finish loading.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-common-j-native">CreateTimer</span>(), <span class="jass-number">2.0</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTriggerActionAllianceChange</span>)
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Player Slot Availability</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">CheckInitPlayerSlotAvailability</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-const">bj_slotControlReady</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
        <span class="jass-keyword">loop</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_slotControlUsed</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>
            <span class="jass-keyword">set</span> <span class="jass-const">bj_slotControl</span>[index] <span class="jass-op">=</span> <span class="jass-const">MAP_CONTROL_USER</span>
            <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
        <span class="jass-keyword">endloop</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_slotControlReady</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetPlayerSlotAvailable</span> <span class="jass-keyword">takes</span> <span class="jass-type">player</span> whichPlayer, <span class="jass-type">mapcontrol</span> control <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> playerIndex <span class="jass-op">=</span> <span class="jass-common-j-native">GetPlayerId</span>(whichPlayer)

    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CheckInitPlayerSlotAvailability</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_slotControlUsed</span>[playerIndex] <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_slotControl</span>[playerIndex] <span class="jass-op">=</span> control
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Generic Template Player-slot Initialization</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> teamCount <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">player</span>  indexPlayer
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> team

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTeams</span>(teamCount)

    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">CheckInitPlayerSlotAvailability</span>()
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> team <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_slotControlUsed</span>[index]) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> indexPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Player</span>(index)
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTeam</span>( indexPlayer, team )
            <span class="jass-keyword">set</span> team <span class="jass-op">=</span> team <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">if</span> (team <span class="jass-op">&gt;=</span> teamCount) <span class="jass-keyword">then</span>
                <span class="jass-keyword">set</span> team <span class="jass-op">=</span> <span class="jass-number">0</span>
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeInitPlayerSlots</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span>(<span class="jass-const">bj_MAX_PLAYERS</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">FFAInitPlayerSlots</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span>(<span class="jass-const">bj_MAX_PLAYERS</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">OneOnOneInitPlayerSlots</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Limit the game to 2 players.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetTeams</span>(<span class="jass-number">2</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayers</span>(<span class="jass-number">2</span>)
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span>(<span class="jass-number">2</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitGenericPlayerSlots</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">gametype</span> gType <span class="jass-op">=</span> <span class="jass-common-j-native">GetGameTypeSelected</span>()

    <span class="jass-keyword">if</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_MELEE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">MeleeInitPlayerSlots</span>()
    <span class="jass-keyword">elseif</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_FFA</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">FFAInitPlayerSlots</span>()
    <span class="jass-keyword">elseif</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_USE_MAP_SETTINGS</span>) <span class="jass-keyword">then</span>
        <span class="jass-comment">// Do nothing; the map-specific script handles this.</span>
    <span class="jass-keyword">elseif</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_ONE_ON_ONE</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">OneOnOneInitPlayerSlots</span>()
    <span class="jass-keyword">elseif</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_TWO_TEAM_PLAY</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span>(<span class="jass-number">2</span>)
    <span class="jass-keyword">elseif</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_THREE_TEAM_PLAY</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span>(<span class="jass-number">3</span>)
    <span class="jass-keyword">elseif</span> (gType <span class="jass-op">==</span> <span class="jass-const">GAME_TYPE_FOUR_TEAM_PLAY</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">TeamInitPlayerSlots</span>(<span class="jass-number">4</span>)
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Unrecognized Game Type</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Blizzard.j Initialization</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsDawn</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_useDawnDuskSounds</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_dawnSound</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsDusk</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">if</span> <span class="jass-const">bj_useDawnDuskSounds</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_duskSound</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsDay</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> ToD <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetTimeOfDay</span>()

    <span class="jass-keyword">if</span> (ToD <span class="jass-op">&gt;=</span> <span class="jass-const">bj_TOD_DAWN</span> <span class="jass-keyword">and</span> ToD <span class="jass-op">&lt;</span> <span class="jass-const">bj_TOD_DUSK</span>) <span class="jass-keyword">and</span> <span class="jass-keyword">not</span> <span class="jass-const">bj_dncIsDaytime</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_dncIsDaytime</span> <span class="jass-op">=</span> <span class="jass-const">true</span>

        <span class="jass-comment">// change ambient sounds</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopSound</span>(<span class="jass-const">bj_nightAmbientSound</span>, <span class="jass-const">false</span>, <span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_dayAmbientSound</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsNight</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> ToD <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetTimeOfDay</span>()

    <span class="jass-keyword">if</span> (ToD <span class="jass-op">&lt;</span> <span class="jass-const">bj_TOD_DAWN</span> <span class="jass-keyword">or</span> ToD <span class="jass-op">&gt;=</span> <span class="jass-const">bj_TOD_DUSK</span>) <span class="jass-keyword">and</span> <span class="jass-const">bj_dncIsDaytime</span> <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_dncIsDaytime</span> <span class="jass-op">=</span> <span class="jass-const">false</span>

        <span class="jass-comment">// change ambient sounds</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StopSound</span>(<span class="jass-const">bj_dayAmbientSound</span>, <span class="jass-const">false</span>, <span class="jass-const">true</span>)
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">StartSound</span>(<span class="jass-const">bj_nightAmbientSound</span>)
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitDNCSounds</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Create sounds to be played at dawn and dusk.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_dawnSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"RoosterSound"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_duskSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"WolfSound"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)

    <span class="jass-comment">// Set up triggers to respond to dawn and dusk.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_dncSoundsDawn</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(<span class="jass-const">bj_dncSoundsDawn</span>, <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">EQUAL</span>, <span class="jass-const">bj_TOD_DAWN</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_dncSoundsDawn</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsDawn</span>)

    <span class="jass-keyword">set</span> <span class="jass-const">bj_dncSoundsDusk</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(<span class="jass-const">bj_dncSoundsDusk</span>, <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">EQUAL</span>, <span class="jass-const">bj_TOD_DUSK</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_dncSoundsDusk</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsDusk</span>)

    <span class="jass-comment">// Set up triggers to respond to changes from day to night or vice-versa.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_dncSoundsDay</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(<span class="jass-const">bj_dncSoundsDay</span>,   <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">GREATER_THAN_OR_EQUAL</span>, <span class="jass-const">bj_TOD_DAWN</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(<span class="jass-const">bj_dncSoundsDay</span>,   <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">LESS_THAN</span>,             <span class="jass-const">bj_TOD_DUSK</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_dncSoundsDay</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsDay</span>)

    <span class="jass-keyword">set</span> <span class="jass-const">bj_dncSoundsNight</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(<span class="jass-const">bj_dncSoundsNight</span>, <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">LESS_THAN</span>,             <span class="jass-const">bj_TOD_DAWN</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterGameStateEvent</span>(<span class="jass-const">bj_dncSoundsNight</span>, <span class="jass-const">GAME_STATE_TIME_OF_DAY</span>, <span class="jass-const">GREATER_THAN_OR_EQUAL</span>, <span class="jass-const">bj_TOD_DUSK</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_dncSoundsNight</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">SetDNCSoundsNight</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitBlizzardGlobals</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> userControlledPlayers
    <span class="jass-keyword">local</span> <span class="jass-type">version</span> v

    <span class="jass-comment">// Init filter function vars</span>
    <span class="jass-keyword">set</span> filterIssueHauntOrderAtLocBJ <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">IssueHauntOrderAtLocBJFilter</span>)
    <span class="jass-keyword">set</span> filterEnumDestructablesInCircleBJ <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">EnumDestructablesInCircleBJFilter</span>)
    <span class="jass-keyword">set</span> filterGetUnitsInRectOfPlayer <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsInRectOfPlayerFilter</span>)
    <span class="jass-keyword">set</span> filterGetUnitsOfTypeIdAll <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfTypeIdAllFilter</span>)
    <span class="jass-keyword">set</span> filterGetUnitsOfPlayerAndTypeId <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">GetUnitsOfPlayerAndTypeIdFilter</span>)
    <span class="jass-keyword">set</span> filterMeleeTrainedUnitIsHeroBJ <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MeleeTrainedUnitIsHeroBJFilter</span>)
    <span class="jass-keyword">set</span> filterLivingPlayerUnitsOfTypeId <span class="jass-op">=</span> <span class="jass-common-j-native">Filter</span>(<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">LivingPlayerUnitsOfTypeIdFilter</span>)

    <span class="jass-comment">// Init force presets</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYER_SLOTS</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_FORCE_PLAYER</span>[index] <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceAddPlayer</span>(<span class="jass-const">bj_FORCE_PLAYER</span>[index], <span class="jass-common-j-native">Player</span>(index))
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">set</span> <span class="jass-const">bj_FORCE_ALL_PLAYERS</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateForce</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForceEnumPlayers</span>(<span class="jass-const">bj_FORCE_ALL_PLAYERS</span>, <span class="jass-type">null</span>)

    <span class="jass-comment">// Init Cinematic Mode history</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorSpeed</span> <span class="jass-op">=</span> <span class="jass-common-j-native">GetGameSpeed</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorFogSetting</span> <span class="jass-op">=</span> <span class="jass-common-j-native">IsFogEnabled</span>()
    <span class="jass-keyword">set</span> <span class="jass-const">bj_cineModePriorMaskSetting</span> <span class="jass-op">=</span> <span class="jass-common-j-native">IsFogMaskEnabled</span>()

    <span class="jass-comment">// Init Trigger Queue</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_MAX_QUEUED_TRIGGERS</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTriggers</span>[index] <span class="jass-op">=</span> <span class="jass-type">null</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecUseConds</span>[index] <span class="jass-op">=</span> <span class="jass-const">false</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Init singleplayer check</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-keyword">set</span> userControlledPlayers <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">&gt;=</span> <span class="jass-const">bj_MAX_PLAYERS</span>
        <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetPlayerController</span>(<span class="jass-common-j-native">Player</span>(index)) <span class="jass-op">==</span> <span class="jass-const">MAP_CONTROL_USER</span> <span class="jass-keyword">and</span> <span class="jass-common-j-native">GetPlayerSlotState</span>(<span class="jass-common-j-native">Player</span>(index)) <span class="jass-op">==</span> <span class="jass-const">PLAYER_SLOT_STATE_PLAYING</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> userControlledPlayers <span class="jass-op">=</span> userControlledPlayers <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_isSinglePlayer</span> <span class="jass-op">=</span> (userControlledPlayers <span class="jass-op">==</span> <span class="jass-number">1</span>)

    <span class="jass-comment">// Init sounds</span>
    <span class="jass-comment">//set bj_pingMinimapSound = CreateSoundFromLabel("AutoCastButtonClick", false, false, false, 10000, 10000)</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_rescueSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"Rescue"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questDiscoveredSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"QuestNew"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questUpdatedSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"QuestUpdate"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questCompletedSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"QuestCompleted"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questFailedSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"QuestFailed"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questHintSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"Hint"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questSecretSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"SecretFound"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questItemAcquiredSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"ItemReward"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_questWarningSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"Warning"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_victoryDialogSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"QuestCompleted"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)
    <span class="jass-keyword">set</span> <span class="jass-const">bj_defeatDialogSound</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateSoundFromLabel</span>(<span class="jass-string">"QuestFailed"</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-const">false</span>, <span class="jass-number">10000</span>, <span class="jass-number">10000</span>)

    <span class="jass-comment">// Init corpse creation triggers.</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">DelayedSuspendDecayCreate</span>()

    <span class="jass-comment">// Init version-specific data</span>
    <span class="jass-keyword">set</span> v <span class="jass-op">=</span> <span class="jass-common-j-native">VersionGet</span>()
    <span class="jass-keyword">if</span> (v <span class="jass-op">==</span> <span class="jass-const">VERSION_REIGN_OF_CHAOS</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES</span> <span class="jass-op">=</span> <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES_V0</span>
    <span class="jass-keyword">else</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES</span> <span class="jass-op">=</span> <span class="jass-const">bj_MELEE_MAX_TWINKED_HEROES_V1</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitQueuedTriggers</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_queuedExecTimeout</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterTimerExpireEvent</span>(<span class="jass-const">bj_queuedExecTimeout</span>, <span class="jass-const">bj_queuedExecTimeoutTimer</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_queuedExecTimeout</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">QueuedTriggerDoneBJ</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitMapRects</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_mapInitialPlayableArea</span> <span class="jass-op">=</span> <span class="jass-common-j-native">Rect</span>(<span class="jass-common-j-native">GetCameraBoundMinX</span>()<span class="jass-op">-</span><span class="jass-common-j-native">GetCameraMargin</span>(<span class="jass-const">CAMERA_MARGIN_LEFT</span>), <span class="jass-common-j-native">GetCameraBoundMinY</span>()<span class="jass-op">-</span><span class="jass-common-j-native">GetCameraMargin</span>(<span class="jass-const">CAMERA_MARGIN_BOTTOM</span>), <span class="jass-common-j-native">GetCameraBoundMaxX</span>()<span class="jass-op">+</span><span class="jass-common-j-native">GetCameraMargin</span>(<span class="jass-const">CAMERA_MARGIN_RIGHT</span>), <span class="jass-common-j-native">GetCameraBoundMaxY</span>()<span class="jass-op">+</span><span class="jass-common-j-native">GetCameraMargin</span>(<span class="jass-const">CAMERA_MARGIN_TOP</span>))
    <span class="jass-keyword">set</span> <span class="jass-const">bj_mapInitialCameraBounds</span> <span class="jass-op">=</span> <span class="jass-blizzard-j-function">GetCurrentCameraBoundsMapRectBJ</span>()
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitSummonableCaps</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index

    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-comment">// upgraded units</span>
        <span class="jass-comment">// Note: Only do this if the corresponding upgrade is not yet researched</span>
        <span class="jass-comment">// Barrage - Siege Engines</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-common-j-native">GetPlayerTechResearched</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Rhrt'</span>, <span class="jass-const">true</span>)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'hrtt'</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// Berserker Upgrade - Troll Berserkers</span>
        <span class="jass-keyword">if</span> (<span class="jass-keyword">not</span> <span class="jass-common-j-native">GetPlayerTechResearched</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'Robk'</span>, <span class="jass-const">true</span>)) <span class="jass-keyword">then</span>
            <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'otbk'</span>, <span class="jass-number">0</span>)
        <span class="jass-keyword">endif</span>

        <span class="jass-comment">// max skeletons per player</span>
        <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetPlayerTechMaxAllowed</span>(<span class="jass-common-j-native">Player</span>(index), <span class="jass-number">'uske'</span>, <span class="jass-const">bj_MAX_SKELETONS</span>)

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_MAX_PLAYERS</span>
    <span class="jass-keyword">endloop</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Update the per-class stock limits.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UpdateStockAvailability</span> <span class="jass-keyword">takes</span> <span class="jass-type">item</span> whichItem <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">itemtype</span> iType  <span class="jass-op">=</span> <span class="jass-common-j-native">GetItemType</span>(whichItem)
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>  iLevel <span class="jass-op">=</span> <span class="jass-common-j-native">GetItemLevel</span>(whichItem)

    <span class="jass-comment">// Update allowed type/level combinations.</span>
    <span class="jass-keyword">if</span> (iType <span class="jass-op">==</span> <span class="jass-const">ITEM_TYPE_PERMANENT</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_stockAllowedPermanent</span>[iLevel] <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">elseif</span> (iType <span class="jass-op">==</span> <span class="jass-const">ITEM_TYPE_CHARGED</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_stockAllowedCharged</span>[iLevel] <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">elseif</span> (iType <span class="jass-op">==</span> <span class="jass-const">ITEM_TYPE_ARTIFACT</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_stockAllowedArtifact</span>[iLevel] <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">else</span>
        <span class="jass-comment">// Not interested in this item type - ignore the item.</span>
    <span class="jass-keyword">endif</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Find a sellable item of the given type and level, and then add it.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UpdateEachStockBuildingEnum</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> iteration <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> pickedItemId

    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> pickedItemId <span class="jass-op">=</span> <span class="jass-common-j-native">ChooseRandomItemEx</span>(<span class="jass-const">bj_stockPickedItemType</span>, <span class="jass-const">bj_stockPickedItemLevel</span>)
        <span class="jass-keyword">exitwhen</span> <span class="jass-common-j-native">IsItemIdSellable</span>(pickedItemId)

        <span class="jass-comment">// If we get hung up on an entire class/level combo of unsellable</span>
        <span class="jass-comment">// items, or a very unlucky series of random numbers, give up.</span>
        <span class="jass-keyword">set</span> iteration <span class="jass-op">=</span> iteration <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">if</span> (iteration <span class="jass-op">&gt;</span> <span class="jass-const">bj_STOCK_MAX_ITERATIONS</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">return</span>
        <span class="jass-keyword">endif</span>
    <span class="jass-keyword">endloop</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">AddItemToStock</span>(<span class="jass-common-j-native">GetEnumUnit</span>(), pickedItemId, <span class="jass-number">1</span>, <span class="jass-number">1</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UpdateEachStockBuilding</span> <span class="jass-keyword">takes</span> <span class="jass-type">itemtype</span> iType, <span class="jass-type">integer</span> iLevel <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">group</span> g

    <span class="jass-keyword">set</span> <span class="jass-const">bj_stockPickedItemType</span> <span class="jass-op">=</span> iType
    <span class="jass-keyword">set</span> <span class="jass-const">bj_stockPickedItemLevel</span> <span class="jass-op">=</span> iLevel

    <span class="jass-keyword">set</span> g <span class="jass-op">=</span> <span class="jass-common-j-native">CreateGroup</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">GroupEnumUnitsOfType</span>(g, <span class="jass-string">"marketplace"</span>, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">ForGroup</span>(g, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UpdateEachStockBuildingEnum</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyGroup</span>(g)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Update stock inventory.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PerformStockUpdates</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>  pickedItemId
    <span class="jass-keyword">local</span> <span class="jass-type">itemtype</span> pickedItemType
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>  pickedItemLevel <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>  allowedCombinations <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span>  iLevel

    <span class="jass-comment">// Give each type/level combination a chance of being picked.</span>
    <span class="jass-keyword">set</span> iLevel <span class="jass-op">=</span> <span class="jass-number">1</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_stockAllowedPermanent</span>[iLevel]) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> allowedCombinations <span class="jass-op">=</span> allowedCombinations <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>, allowedCombinations) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">set</span> pickedItemType <span class="jass-op">=</span> <span class="jass-const">ITEM_TYPE_PERMANENT</span>
                <span class="jass-keyword">set</span> pickedItemLevel <span class="jass-op">=</span> iLevel
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_stockAllowedCharged</span>[iLevel]) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> allowedCombinations <span class="jass-op">=</span> allowedCombinations <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>, allowedCombinations) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">set</span> pickedItemType <span class="jass-op">=</span> <span class="jass-const">ITEM_TYPE_CHARGED</span>
                <span class="jass-keyword">set</span> pickedItemLevel <span class="jass-op">=</span> iLevel
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>
        <span class="jass-keyword">if</span> (<span class="jass-const">bj_stockAllowedArtifact</span>[iLevel]) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> allowedCombinations <span class="jass-op">=</span> allowedCombinations <span class="jass-op">+</span> <span class="jass-number">1</span>
            <span class="jass-keyword">if</span> (<span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>, allowedCombinations) <span class="jass-op">==</span> <span class="jass-number">1</span>) <span class="jass-keyword">then</span>
                <span class="jass-keyword">set</span> pickedItemType <span class="jass-op">=</span> <span class="jass-const">ITEM_TYPE_ARTIFACT</span>
                <span class="jass-keyword">set</span> pickedItemLevel <span class="jass-op">=</span> iLevel
            <span class="jass-keyword">endif</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> iLevel <span class="jass-op">=</span> iLevel <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> iLevel <span class="jass-op">&gt;</span> <span class="jass-const">bj_MAX_ITEM_LEVEL</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Make sure we found a valid item type to add.</span>
    <span class="jass-keyword">if</span> (allowedCombinations <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">UpdateEachStockBuilding</span>(pickedItemType, pickedItemLevel)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-comment">// Perform the first update, and then arrange future updates.</span>
<span class="jass-comment">//</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StartStockUpdates</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">PerformStockUpdates</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_stockUpdateTimer</span>, <span class="jass-const">bj_STOCK_RESTOCK_INTERVAL</span>, <span class="jass-const">true</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">PerformStockUpdates</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemovePurchasedItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">RemoveItemFromStock</span>(<span class="jass-common-j-native">GetSellingUnit</span>(), <span class="jass-common-j-native">GetItemTypeId</span>(<span class="jass-common-j-native">GetSoldItem</span>()))
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitNeutralBuildings</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> iLevel

    <span class="jass-comment">// Chart of allowed stock items.</span>
    <span class="jass-keyword">set</span> iLevel <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_stockAllowedPermanent</span>[iLevel] <span class="jass-op">=</span> <span class="jass-const">false</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_stockAllowedCharged</span>[iLevel] <span class="jass-op">=</span> <span class="jass-const">false</span>
        <span class="jass-keyword">set</span> <span class="jass-const">bj_stockAllowedArtifact</span>[iLevel] <span class="jass-op">=</span> <span class="jass-const">false</span>
        <span class="jass-keyword">set</span> iLevel <span class="jass-op">=</span> iLevel <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> iLevel <span class="jass-op">&gt;</span> <span class="jass-const">bj_MAX_ITEM_LEVEL</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Limit stock inventory slots.</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetAllItemTypeSlots</span>(<span class="jass-const">bj_MAX_STOCK_ITEM_SLOTS</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetAllUnitTypeSlots</span>(<span class="jass-const">bj_MAX_STOCK_UNIT_SLOTS</span>)

    <span class="jass-comment">// Arrange the first update.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_stockUpdateTimer</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_stockUpdateTimer</span>, <span class="jass-const">bj_STOCK_RESTOCK_INITIAL_DELAY</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">StartStockUpdates</span>)

    <span class="jass-comment">// Set up a trigger to fire whenever an item is sold.</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_stockItemPurchased</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTrigger</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerRegisterPlayerUnitEvent</span>(<span class="jass-const">bj_stockItemPurchased</span>, <span class="jass-common-j-native">Player</span>(<span class="jass-const">PLAYER_NEUTRAL_PASSIVE</span>), <span class="jass-const">EVENT_PLAYER_UNIT_SELL_ITEM</span>, <span class="jass-type">null</span>)
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TriggerAddAction</span>(<span class="jass-const">bj_stockItemPurchased</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RemovePurchasedItem</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MarkGameStarted</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_gameStarted</span> <span class="jass-op">=</span> <span class="jass-const">true</span>
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">DestroyTimer</span>(<span class="jass-const">bj_gameStartedTimer</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">DetectGameStarted</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_gameStartedTimer</span> <span class="jass-op">=</span> <span class="jass-common-j-native">CreateTimer</span>()
    <span class="jass-keyword">call</span> <span class="jass-common-j-native">TimerStart</span>(<span class="jass-const">bj_gameStartedTimer</span>, <span class="jass-const">bj_GAME_STARTED_THRESHOLD</span>, <span class="jass-const">false</span>, <span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">MarkGameStarted</span>)
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">InitBlizzard</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-comment">// Set up the Neutral Victim player slot, to torture the abandoned units</span>
    <span class="jass-comment">// of defeated players.  Since some triggers expect this player slot to</span>
    <span class="jass-comment">// exist, this is performed for all maps.</span>
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">ConfigureNeutralVictim</span>()

    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitBlizzardGlobals</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitQueuedTriggers</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitRescuableBehaviorBJ</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitDNCSounds</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitMapRects</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitSummonableCaps</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">InitNeutralBuildings</span>()
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">DetectGameStarted</span>()
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Random distribution</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Used to select a random object from a given distribution of chances</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  - RandomDistReset clears the distribution list</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  - RandomDistAddItem adds a new object to the distribution list</span>
<span class="jass-comment">//*    with a given identifier and an integer chance to be chosen</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  - RandomDistChoose will use the current distribution list to choose</span>
<span class="jass-comment">//*    one of the objects randomly based on the chance distribution</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Note that the chances are effectively normalized by their sum,</span>
<span class="jass-comment">//*  so only the relative values of each chance are important</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDistReset</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randDistCount</span> <span class="jass-op">=</span> <span class="jass-number">0</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDistAddItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">integer</span> inID, <span class="jass-type">integer</span> inChance <span class="jass-keyword">returns</span> <span class="jass-type">nothing</span>
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randDistID</span>[<span class="jass-const">bj_randDistCount</span>] <span class="jass-op">=</span> inID
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randDistChance</span>[<span class="jass-const">bj_randDistCount</span>] <span class="jass-op">=</span> inChance
    <span class="jass-keyword">set</span> <span class="jass-const">bj_randDistCount</span> <span class="jass-op">=</span> <span class="jass-const">bj_randDistCount</span> <span class="jass-op">+</span> <span class="jass-number">1</span>
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">RandomDistChoose</span> <span class="jass-keyword">takes</span> <span class="jass-type">nothing</span> <span class="jass-keyword">returns</span> <span class="jass-type">integer</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> sum <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> chance <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> index
    <span class="jass-keyword">local</span> <span class="jass-type">integer</span> foundID <span class="jass-op">=</span> <span class="jass-op">-</span><span class="jass-number">1</span>
    <span class="jass-keyword">local</span> <span class="jass-type">boolean</span> done

    <span class="jass-comment">// No items?</span>
    <span class="jass-keyword">if</span> (<span class="jass-const">bj_randDistCount</span> <span class="jass-op">==</span> <span class="jass-number">0</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-op">-</span><span class="jass-number">1</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-comment">// Find sum of all chances</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> sum <span class="jass-op">=</span> sum <span class="jass-op">+</span> <span class="jass-const">bj_randDistChance</span>[index]

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">exitwhen</span> index <span class="jass-op">==</span> <span class="jass-const">bj_randDistCount</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-comment">// Choose random number within the total range</span>
    <span class="jass-keyword">set</span> chance <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomInt</span>(<span class="jass-number">1</span>, sum)

    <span class="jass-comment">// Find ID which corresponds to this chance</span>
    <span class="jass-keyword">set</span> index <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> sum <span class="jass-op">=</span> <span class="jass-number">0</span>
    <span class="jass-keyword">set</span> done <span class="jass-op">=</span> <span class="jass-const">false</span>
    <span class="jass-keyword">loop</span>
        <span class="jass-keyword">set</span> sum <span class="jass-op">=</span> sum <span class="jass-op">+</span> <span class="jass-const">bj_randDistChance</span>[index]

        <span class="jass-keyword">if</span> (chance <span class="jass-op">&lt;=</span> sum) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> foundID <span class="jass-op">=</span> <span class="jass-const">bj_randDistID</span>[index]
            <span class="jass-keyword">set</span> done <span class="jass-op">=</span> <span class="jass-const">true</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">set</span> index <span class="jass-op">=</span> index <span class="jass-op">+</span> <span class="jass-number">1</span>
        <span class="jass-keyword">if</span> (index <span class="jass-op">==</span> <span class="jass-const">bj_randDistCount</span>) <span class="jass-keyword">then</span>
            <span class="jass-keyword">set</span> done <span class="jass-op">=</span> <span class="jass-const">true</span>
        <span class="jass-keyword">endif</span>

        <span class="jass-keyword">exitwhen</span> done <span class="jass-op">==</span> <span class="jass-const">true</span>
    <span class="jass-keyword">endloop</span>

    <span class="jass-keyword">return</span> foundID
<span class="jass-keyword">endfunction</span>



<span class="jass-comment">//***************************************************************************</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Drop item</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Makes the given unit drop the given item</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//*  Note: This could potentially cause problems if the unit is standing</span>
<span class="jass-comment">//*        right on the edge of an unpathable area and happens to drop the</span>
<span class="jass-comment">//*        item into the unpathable area where nobody can get it...</span>
<span class="jass-comment">//*</span>
<span class="jass-comment">//***************************************************************************</span>

<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">UnitDropItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">unit</span> inUnit, <span class="jass-type">integer</span> inItemID <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> x
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> y
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> radius <span class="jass-op">=</span> <span class="jass-number">32</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> unitX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> unitY
    <span class="jass-keyword">local</span> <span class="jass-type">item</span> droppedItem

    <span class="jass-keyword">if</span> (inItemID <span class="jass-op">==</span> <span class="jass-op">-</span><span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> unitX <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitX</span>(inUnit)
    <span class="jass-keyword">set</span> unitY <span class="jass-op">=</span> <span class="jass-common-j-native">GetUnitY</span>(inUnit)

    <span class="jass-keyword">set</span> x <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomReal</span>(unitX <span class="jass-op">-</span> radius, unitX <span class="jass-op">+</span> radius)
    <span class="jass-keyword">set</span> y <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomReal</span>(unitY <span class="jass-op">-</span> radius, unitY <span class="jass-op">+</span> radius)

    <span class="jass-keyword">set</span> droppedItem <span class="jass-op">=</span> <span class="jass-common-j-native">CreateItem</span>(inItemID, x, y)

    <span class="jass-keyword">call</span> <span class="jass-common-j-native">SetItemDropID</span>(droppedItem, <span class="jass-common-j-native">GetUnitTypeId</span>(inUnit))
    <span class="jass-keyword">call</span> <span class="jass-blizzard-j-function">UpdateStockAvailability</span>(droppedItem)

    <span class="jass-keyword">return</span> droppedItem
<span class="jass-keyword">endfunction</span>

<span class="jass-comment">//===========================================================================</span>
<span class="jass-keyword">function</span> <span class="jass-blizzard-j-function">WidgetDropItem</span> <span class="jass-keyword">takes</span> <span class="jass-type">widget</span> inWidget, <span class="jass-type">integer</span> inItemID <span class="jass-keyword">returns</span> <span class="jass-type">item</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> x
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> y
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> radius <span class="jass-op">=</span> <span class="jass-number">32</span>
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> widgetX
    <span class="jass-keyword">local</span> <span class="jass-type">real</span> widgetY

    <span class="jass-keyword">if</span> (inItemID <span class="jass-op">==</span> <span class="jass-op">-</span><span class="jass-number">1</span>) <span class="jass-keyword">then</span>
        <span class="jass-keyword">return</span> <span class="jass-type">null</span>
    <span class="jass-keyword">endif</span>

    <span class="jass-keyword">set</span> widgetX <span class="jass-op">=</span> <span class="jass-common-j-native">GetWidgetX</span>(inWidget)
    <span class="jass-keyword">set</span> widgetY <span class="jass-op">=</span> <span class="jass-common-j-native">GetWidgetY</span>(inWidget)

    <span class="jass-keyword">set</span> x <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomReal</span>(widgetX <span class="jass-op">-</span> radius, widgetX <span class="jass-op">+</span> radius)
    <span class="jass-keyword">set</span> y <span class="jass-op">=</span> <span class="jass-common-j-native">GetRandomReal</span>(widgetY <span class="jass-op">-</span> radius, widgetY <span class="jass-op">+</span> radius)

    <span class="jass-keyword">return</span> <span class="jass-common-j-native">CreateItem</span>(inItemID, x, y)
<span class="jass-keyword">endfunction</span>
</pre>
</body>

</html>